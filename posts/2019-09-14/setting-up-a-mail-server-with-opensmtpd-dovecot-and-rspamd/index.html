<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en-US"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Setting up a mail server with OpenSMTPD, Dovecot and Rspamd &#183; poolp.org</title>
<meta name=title content="Setting up a mail server with OpenSMTPD, Dovecot and Rspamd &#183; poolp.org"><link rel=canonical href=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/><link type=text/css rel=stylesheet href=/css/main.bundle.min.aae4ab0954fc7f7114dd14fabe5a76a6cf645fd2fabe5cef37d61d1fd5d62e9e65e2793e72c6cc5d3da9792419995b3533cbbdc333bc3897f31f77d72a4a27f7.css integrity="sha512-quSrCVT8f3EU3RT6vlp2ps9kX9L6vlzvN9YdH9XWLp5l4nk+csbMXT2peSQZmVs1M8u9wzO8OJfzH3fXKkon9w=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.cab249ec2f87c8efdec1594e650838fcb9837dff59bf06c71a79fe5e0a7a0f19fcca05399fe094d181e68eb57354ed0b2328cfe53accab2b24257f0beda841a9.js integrity="sha512-yrJJ7C+HyO/ewVlOZQg4/LmDff9ZvwbHGnn+Xgp6Dxn8ygU5n+CU0YHmjrVzVO0LIyjP5TrMqyskJX8L7ahBqQ==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/"><meta property="og:site_name" content="poolp.org"><meta property="og:title" content="Setting up a mail server with OpenSMTPD, Dovecot and Rspamd"><meta property="og:description" content="TL;DR: - NO TL;DR: this time, I spent hours writing, you should spend minutes reading. - OK... I explain in WAY TOO MUCH details how to setup a mail server EDIT (2019-10-26) # OpenSMTPD 6."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-14T05:37:00+00:00"><meta property="article:modified_time" content="2019-09-14T05:37:00+00:00"><meta property="og:image" content="https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/feature.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/feature.jpg"><meta name=twitter:title content="Setting up a mail server with OpenSMTPD, Dovecot and Rspamd"><meta name=twitter:description content="TL;DR: - NO TL;DR: this time, I spent hours writing, you should spend minutes reading. - OK... I explain in WAY TOO MUCH details how to setup a mail server EDIT (2019-10-26) # OpenSMTPD 6."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Setting up a mail server with OpenSMTPD, Dovecot and Rspamd","headline":"Setting up a mail server with OpenSMTPD, Dovecot and Rspamd","abstract":"TL;DR: - NO TL;DR: this time, I spent hours writing, you should spend minutes reading. - OK... I explain in WAY TOO MUCH details how to setup a mail server EDIT (2019-10-26) # OpenSMTPD 6.","inLanguage":"en-US","url":"https:\/\/poolp.org\/posts\/2019-09-14\/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd\/","author":{"@type":"Person","name":""},"copyrightYear":"2019","dateCreated":"2019-09-14T05:37:00\u002b00:00","datePublished":"2019-09-14T05:37:00\u002b00:00","dateModified":"2019-09-14T05:37:00\u002b00:00","mainEntityOfPage":"true","wordCount":"7943"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/custom.css><script>for(var elements=document.querySelectorAll(".discord-dialog__close-button, .discord-dialog"),i=0;i<elements.length;i++)elements[i].addEventListener("click",function(){toggle(".discord-dialog")})</script><style>@import "https://fonts.cdnfonts.com/css/whitney-2";.discord-dialog *,.discord-dialog :after,.discord-dialog :before{box-sizing:inherit}.discord-dialog a{text-decoration:none}@keyframes discord-dialog__transition{0%{opacity:0;transform:translateY(16px)}100%{opacity:1;transform:translateY(0)}}.discord-dialog{-webkit-tap-highlight-color:transparent;box-sizing:border-box;display:none;z-index:2147483647;position:fixed;max-width:288px;right:0;bottom:0;margin:18px;border-radius:10px;font-family:Whitney,sans-serif;background:#2e3136;color:#72767d;box-shadow:0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12),0 8px 10px -5px rgba(0,0,0,.4);transition:opacity .3s cubic-bezier(.25,.8,.25,1),transform .3s cubic-bezier(.25,.8,.25,1);animation:discord-dialog__transition .2s}.discord-dialog--active{display:block}.discord-dialog__container{font-size:14px;line-height:1.2;color:#99aab5;padding:8px 28px 28px}.discord-dialog__logo{display:none;width:auto;margin-top:5px;height:24px}.discord-dialog__logo path{fill:#fff}.discord-dialog__close-button{position:absolute;right:0;padding:16px;cursor:pointer}.discord-dialog__close-button svg{height:20px;width:20px}.discord-dialog__close-button svg path{fill:#ccc}.discord-dialog__close-button:hover{opacity:.8}.discord-dialog__close-button:active{opacity:.4}.discord-dialog__footer{padding:10px 20px}.discord-dialog__guild-icon{border-radius:50%;width:64px;display:block;height:auto;margin:16px 0}.discord-dialog__guild{font-size:24px;line-height:30px;margin-bottom:12px;font-weight:700;color:#fff}.discord-dialog__btn{background:#7289da;color:#fff;text-align:center;display:block;border-radius:1px;margin:8px;font-size:16px;line-height:24px;border-radius:3px;text-align:center;padding:12px 16px;position:relative;top:-6px;box-shadow:0 2px 4px rgba(0,0,0,.3);transition:box-shadow .3s cubic-bezier(.25,.8,.25,1),background .3s cubic-bezier(.25,.8,.25,1)}.discord-dialog__btn:hover{background:#8095de}.discord-dialog__btn:active{background:#677bc4}.discord-dialog__explainer{display:block;margin:2px 8px;color:#7289da;font-size:12px;text-align:right;top:-6px}.discord-dialog__explainer:hover{opacity:.8}.discord-dialog__explainer:active{opacity:.6}.discord-button{-webkit-tap-highlight-color:transparent;box-sizing:border-box;box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);position:fixed;bottom:0;right:0;z-index:50;margin:23.5px;padding:15.5px;border-radius:50%;background:#7289da;cursor:pointer;transition:box-shadow .3s cubic-bezier(.25,.8,.25,1),background .3s cubic-bezier(.25,.8,.25,1);display:flex;text-align:center;align-items:center;justify-content:center}.discord-button svg{height:28px;width:28px;transition:background .3s cubic-bezier(.25,.8,.25,1)}.discord-button svg path{fill:#fff}.discord-button:hover{box-shadow:0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23)}.discord-button:hover svg{opacity:.6}.discord-button:active{box-shadow:0 10px 20px rgba(0,0,0,.19),0 6px 6px rgba(0,0,0,.23)}.discord-button:active svg{opacity:.4}</style><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>poolp.org</span>
<img src=/img/poolp_bing.png width=512 height=512 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=poolp.org></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-bold text-gray-500 hover:text-gray-900">poolp.org</a><div class="text-sm text-neutral-700 dark:text-neutral-400"><br>Code, build and run.</div></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=https://github.com/poolpOrg/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Github</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=https://github.com/poolpOrg/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Github</p></a></li></ul><hr><ul class="flex mt-4 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li class=mb-1><a href=/categories/technology/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title>Technology</p></a></li><li class=mb-1><a href=/categories/music/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title>Music</p></a></li><li class=mb-1><a href=/categories/personal/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title>Personal</p></a></li></ul></div></label></div></div><div class="main-menu flex pb-3 flex-col items-end justify-between md:justify-start space-x-3" style=margin-top:-15px><div class="hidden md:flex items-center space-x-5"><a href=/categories/technology/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title>Technology</p></a><a href=/categories/music/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title>Music</p></a><a href=/categories/personal/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title>Personal</p></a></div></div></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom" style=background-image:url(/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/feature_hu15557216275166649763.jpg)></div><br><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">Message to
<u><b><a href=https://github.com/sponsors/poolpOrg>github</a></b></u> and
<u><b><a href=https://www.patreon.com/gilles>patreon</a></b></u> sponsors:
<b>THANK YOU ❤️</b></span></div><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>poolp.org</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/>Setting up a mail server with OpenSMTPD, Dovecot and Rspamd</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Setting up a mail server with OpenSMTPD, Dovecot and Rspamd</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2019-09-14T05:37:00+00:00>14 September 2019</time><span class="px-2 text-primary-500">&#183;</span><span>7943 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">38 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/poolpOrg/poolp.org/tree/master/content/posts/2019-09-14/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentcolor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/technology/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Technology</span></span></span></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/img/gilles_hu8275017791684824193.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://poolp.org//authors/gilles class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Gilles Chehade</a><div class="text-sm text-neutral-700 dark:text-neutral-400">I&rsquo;m not a cat.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:gilles@poolp.org target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/poolpOrg target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/gilleschehade target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://social.poolp.org/@gilles target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.youtube.com/gilleschehade target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitch.tv/poolporg target=_blank aria-label=Twitch rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M391.17 103.47H352.54v109.7h38.63zM285 103H246.37V212.75H285zM120.83.0 24.31 91.42V420.58H140.14V512l96.53-91.42h77.25L487.69 256V0zM449.07 237.75l-77.22 73.12H294.61l-67.6 64v-64H140.14V36.58H449.07z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">If you like reading articles on this website,
<b>please ❤️</b> consider <b>sharing on social networks</b> to help increase visibility:
<b>this helps buy time for new articles and projects</b> !<section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;text=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;resubmit=true&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;description=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;quote=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;subject=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;resubmit=true&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;resubmit=true&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title aria-label><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section></span></div><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#edit-2019-10-26>EDIT (2019-10-26)</a></li><li><a href=#edit-2019-12-15>EDIT (2019-12-15)</a></li><li><a href=#wow-that-was-unexpected>Wow, that was unexpected</a></li><li><a href=#this-is-for-techies-and-sysadmins><a name=begintech></a>This is for techies and sysadmins</a></li><li><a href=#ehlo-hypnocat>EHLO hypno.cat</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#the-technical-stack>The technical stack</a></li><li><a href=#making-myself-reachable>Making myself reachable</a></li><li><a href=#making-myself-look-all-fine-and-dandy>Making myself look all fine and dandy</a></li><li><a href=#advertise-which-machines-are-allowed-to-send-mail-on-behalf-of-my-domain>Advertise which machines are allowed to send mail on behalf of my domain</a></li><li><a href=#prove-that-i-actually-authorized-the-message>Prove that I actually authorized the message</a></li><li><a href=#instructing-hosts-what-to-do-with-spf-and-dkim-failures-with-dmarc>Instructing hosts what to do with SPF and DKIM failures with DMARC</a></li><li><a href=#getting-yourself-a-certificate-for-tls>Getting yourself a certificate for TLS</a></li><li><a href=#installing-and-configuring-rspamd>Installing and configuring Rspamd</a></li><li><a href=#optional-only-accept-mail-in-certain-languages>Optional: Only accept mail in certain languages</a></li><li><a href=#enable-and-start-redis-and-rspamd>Enable and start redis and rspamd</a></li><li><a href=#configuring-opensmtpd>Configuring OpenSMTPD</a></li><li><a href=#a-few-words-about-senderscore>A few words about SenderScore</a></li><li><a href=#installing-and-configuring-dovecot>Installing and configuring Dovecot</a></li><li><a href=#teaching-dovecot-to-train-rspamd>Teaching Dovecot to train Rspamd</a></li><li><a href=#testing-it-all>Testing it all</a></li><li><a href=#yay-were-done>Yay, we&rsquo;re done</a></li><li><a href=#so-what-should-you-do-next->So what should you do next ?</a></li><li><a href=#are-we-done->Are we done ?</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#edit-2019-10-26>EDIT (2019-10-26)</a></li><li><a href=#edit-2019-12-15>EDIT (2019-12-15)</a></li><li><a href=#wow-that-was-unexpected>Wow, that was unexpected</a></li><li><a href=#this-is-for-techies-and-sysadmins><a name=begintech></a>This is for techies and sysadmins</a></li><li><a href=#ehlo-hypnocat>EHLO hypno.cat</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#the-technical-stack>The technical stack</a></li><li><a href=#making-myself-reachable>Making myself reachable</a></li><li><a href=#making-myself-look-all-fine-and-dandy>Making myself look all fine and dandy</a></li><li><a href=#advertise-which-machines-are-allowed-to-send-mail-on-behalf-of-my-domain>Advertise which machines are allowed to send mail on behalf of my domain</a></li><li><a href=#prove-that-i-actually-authorized-the-message>Prove that I actually authorized the message</a></li><li><a href=#instructing-hosts-what-to-do-with-spf-and-dkim-failures-with-dmarc>Instructing hosts what to do with SPF and DKIM failures with DMARC</a></li><li><a href=#getting-yourself-a-certificate-for-tls>Getting yourself a certificate for TLS</a></li><li><a href=#installing-and-configuring-rspamd>Installing and configuring Rspamd</a></li><li><a href=#optional-only-accept-mail-in-certain-languages>Optional: Only accept mail in certain languages</a></li><li><a href=#enable-and-start-redis-and-rspamd>Enable and start redis and rspamd</a></li><li><a href=#configuring-opensmtpd>Configuring OpenSMTPD</a></li><li><a href=#a-few-words-about-senderscore>A few words about SenderScore</a></li><li><a href=#installing-and-configuring-dovecot>Installing and configuring Dovecot</a></li><li><a href=#teaching-dovecot-to-train-rspamd>Teaching Dovecot to train Rspamd</a></li><li><a href=#testing-it-all>Testing it all</a></li><li><a href=#yay-were-done>Yay, we&rsquo;re done</a></li><li><a href=#so-what-should-you-do-next->So what should you do next ?</a></li><li><a href=#are-we-done->Are we done ?</a></li></ul></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})()</script></div></div><div class="min-w-0 min-h-0 max-w-prose"><blockquote><b>TL;DR:</b><br><pre><code>- NO TL;DR: this time, I spent hours writing, you should spend minutes reading.
- OK... I explain in WAY TOO MUCH details how to setup a mail server
</code></pre></blockquote><h2 class="relative group">EDIT (2019-10-26)<div id=edit-2019-10-26 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#edit-2019-10-26 aria-label=Anchor>#</a></span></h2><p><a href=https://www.mail-archive.com/misc@opensmtpd.org/msg04725.html target=_blank>OpenSMTPD 6.6.0 was released today</a>,
the article was updated to reflect that it applies to the current release and no longer a development version.</p><h2 class="relative group">EDIT (2019-12-15)<div id=edit-2019-12-15 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#edit-2019-12-15 aria-label=Anchor>#</a></span></h2><p>I have refactored the article to remove the political aspect behind self-hosting,
which is now <a href=/posts/2019-12-15/decentralised-smtp-is-for-the-greater-good/>a standalone article</a>,
as well as a blurb on reputation since this will become part of a serie of articles.</p><h2 class="relative group">Wow, that was unexpected<div id=wow-that-was-unexpected class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#wow-that-was-unexpected aria-label=Anchor>#</a></span></h2><p>In <a href=https://poolp.org/posts/2019-08-30/you-should-not-run-your-mail-server-because-mail-is-hard/ target=_blank>a previous article</a>,
I explained why I think the &ldquo;mail is hard&rdquo; myth is unfounded and why I think people shouldn&rsquo;t be discouraged from running their own mail services.
I didn&rsquo;t know this article would gather so much attention,
reaching <strong>over 75k reads in three days</strong> (currently past 85k) when my next most read article reached 15k reads&mldr;
in over a year.</p><p>I wish I had a soundcloud.
<a href=https://patreon.com/gilles target=_blank>I have a patreon though</a>.
I also wish I had entered more into details and not covered things so superficially.</p><p><strong>This article is DENSE</strong> but this is because I will hold hands at an absurd level,
removing all my blabber will only leave very few technical parts.</p><h2 class="relative group"><a name=begintech></a>This is for techies and sysadmins<div id=this-is-for-techies-and-sysadmins class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#this-is-for-techies-and-sysadmins aria-label=Anchor>#</a></span></h2><p>Self-hosting mail requires a minimum of knowledge and dedication,
it is not a two-clicks thing,
you need to have some basic knowledge and you have to be willing to pour some time into it.
If you&rsquo;ve never touched a DNS zone or if you think that taking an hour to setup something is hard,
then <strong>this will not be easy</strong> and I don&rsquo;t recommend you do it unless you <strong>WANT</strong> to learn a ton of stuff.</p><p>If you&rsquo;re a sysadmin who is familiar with sysadmin work,
then most of the sysadmin work you already do is considerably harder than setting up a mail instrastructure.
I&rsquo;ll reiterate it for you: <strong>mail is not hard</strong>.</p><h2 class="relative group">EHLO hypno.cat<div id=ehlo-hypnocat class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ehlo-hypnocat aria-label=Anchor>#</a></span></h2><p>For this article,
we will setup a mail server for <a href=https://hypno.cat target=_blank>hypno.cat</a>,
a small website for my thriving (hypothetical) hypnotherapist activity.
I registered the website years ago because I liked the name,
but never done anything with it beyond hosting an <strong>awesome</strong> animated file.</p><center><img src=2019-09-01-newdomain.png></center><p>Google, Bing and Yahoo have somehow known about it for years and indexed that front page,
so they won&rsquo;t consider it as a domain that was just bought by a spammer to start sending mail,
however it is virtually unknown to anyone on the internet because it has no content,
doesn&rsquo;t link to anywhere,
isn&rsquo;t linked from anywhere,
and has never sent or received mails from or to anyone.
It is an important detail because it shows how the age of a domain has a huge impact on your reputation.</p><p>I&rsquo;m going to set it up for real as I write the article,
from the moment I have booted a brand new VPS to the moment I have received mail back and forth to my Gmail account.
I have chosen that one because it is over-represented in the population and this explains why people complained the most about delivery issues there.
I personally think that Outlook is worse in terms of interoperability,
but lets keep that for a future article maybe.</p><p>The mail services for <a href=https://hypno.cat target=_blank>hypno.cat</a> are going to provide TLS-secured incoming and outgoing e-mail.
They are also going to allow me to submit messages from my smartphone&rsquo;s IMAP client,
the Gmail application,
so my users don&rsquo;t feel much of a change in habits.
I could just as easily provide a webmail,
with <a href=https://www.rainloop.net/ target=_blank>Rainloop</a> or <a href=https://www.roundcube.net/ target=_blank>Roundcube</a>,
or setup <a href=https://www.thunderbird.net/ target=_blank>Thunderbird</a> or <a href=http://mutt.org target=_blank>mutt</a>.
Any IMAP client will work just fine so I will not cover this part,
there are many alternatives and plenty of tutorials on how to set them up already.
There&rsquo;s even techniques to help mail clients auto-discover their configuration,
you can figure that out by yourselves.</p><p>My outgoing mail will pass the basic checks at Gmail,
namely SPF, DKIM and DMARC,
which are more than enough to get your mail through.
We could do <strong>a lot more</strong>,
but the goal here is to find the proper balance between doing enough work to look good and remaining simple.</p><p>Incoming mail will be filtered to reduce the volume of spam,
either by killing obvious bad senders at session time when they are detected,
or by providing classification so Spam is in a dedicated folder to avoid cluttering the Inbox.
I could stop here,
since that would already be a fairly nice setup,
but I&rsquo;ll also throw in a bit of configuration to teach Dovecot how to train spam detection through moving mail from
the Inbox to Spam and the other way around.
That part is slighly more complex because it relies on Sieve which is not the best piece of engineering,
feel free to discard if you don&rsquo;t care,
I did without it for over ten years.
It&rsquo;s a nice-to-have, not a must-have.</p><h2 class="relative group">Requirements<div id=requirements class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#requirements aria-label=Anchor>#</a></span></h2><p>The very first requirement is to figure out where you are going to run your mail server.</p><p>With widepsread permanent connections through DSL or FTTH,
a home connection may be tempting but it is not a good idea as the IP address spaces of ISP are often blacklisted or suffer from a bad reputation to start with.
In addition,
many ISP prevent outgoing SMTP traffic to avoid compromised desktops from becoming spamming bots.
I find the best option to be renting a dedicated server or a VPS from a hosting company after making sure that SMTP traffic is allowed there.</p><p>I have rented my dedicated servers at <a href=https://www.online.net/ target=_blank>online.net</a> for the last twelve years and am very happy with them.
You&rsquo;ll even find on this blog <a href=https://poolp.org/posts/2018-01-29/install-openbsd-on-dedibox-with-full-disk-encryption/ target=_blank>instructions to run OpenBSD</a> on their servers as they don&rsquo;t support it natively.
They do not filter SMTP,
which is good because you can run an SMTP service right away,
however the IP addresses may have been previously used by bad senders and you will want to test them.
If the IP that is automatically allocated to you isn&rsquo;t good,
you can still order an additional one and pick it in a different range after <a href=https://mxtoolbox.com/blacklists.aspx target=_blank>checking that it isn&rsquo;t in a blacklist</a>,
or that it <a href=https://www.senderscore.org target=_blank>doesn&rsquo;t have a bad reputation already</a>.</p><p>Alternatively,
for the purpose of creating my own commercial mail services,
I started building an infrastructure on <a href="https://www.vultr.com/?ref=6831037" target=_blank>vultr.com</a> (that&rsquo;s a referal link).
I haven&rsquo;t been there for long so I might still change my mind, but <strong>so far</strong> I&rsquo;m very happy with it.
They filter SMTP by default so you have to open a ticket to explain what you intend to do with mail.
When I explained that I didn&rsquo;t intend to become an ESP but rather provide hosting services,
they were helpful and unfiltered the same day.</p><p>It does not matter much where you decide to run your mail server,
but what you need to check is that:</p><ul><li>the host doesn&rsquo;t have a history of hosting spammers and allows you to do SMTP</li><li>you have an IP address that is dedicated to your mail</li><li>you have control of the reverse DNS for that IP address</li><li>your IP address isn&rsquo;t already in blacklists</li></ul><p>As long as these requirements are met,
you should be fine.</p><p>It is a good plan to prepare for incidents and this is done by using a backup mail server to take over when the primary one is down. I won&rsquo;t cover this as it&rsquo;s not complex, just a matter of an additional DNS record and an additional mail server routing traffic to the primary one, you&rsquo;ll figure this out by yourselves.
<strong>HOWEVER</strong>,
a lot of people mentioned that you can get blacklisted and lose mail,
so I think now is the right time to recommend that <strong>you don&rsquo;t host your different mail servers at the same place</strong>.
You don&rsquo;t want the two of them to go down if there&rsquo;s a power or network shortage in your datacenter,
and you also want to ensure that if your IP range gets blacklisted as collateral damage from an evil neighbor,
the IP of your backup mail server is &ldquo;far enough&rdquo; to not be blacklisted too.
This way,
should your primary mail server be temporarily blocked from sending,
it can reroute traffic through the backup mail server until the issue is solved.</p><p>I have endured collateral damage on my own setup only once during the last ten years.
It was annoying for sure because incidents are never fun,
but I rerouted traffic to my secondary server to unbreak traffic,
filled the form to delist my IP while providing proof that I was a legitimate sender,
rerouted traffic back when issue was resolved.
It was nowhere near the big deal people make out of it.</p><p><strong>No stress for people who plan ahead</strong>.</p><h2 class="relative group">The technical stack<div id=the-technical-stack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-technical-stack aria-label=Anchor>#</a></span></h2><p>I will spin a new VPS at <a href="https://www.vultr.com/?ref=6831037" target=_blank>vultr.com</a> (that&rsquo;s still a referal link),
install the latest <a href=https://www.openbsd.org target=_blank>OpenBSD</a>
<a href=https://ftp.eu.openbsd.org/pub/OpenBSD/snapshots/amd64/ target=_blank>snapshot</a> because that&rsquo;s how I roll (this will not be covered in this article),
and build my mail system on top of it.
I will assume OpenBSD throughout the rest of my writing but besides system-specific commands to install packages the configuration should be similar from a system to another.
If you&rsquo;re tall enough to run a mail server,
you should be tall enough to adapt pathnames accordingly or &mldr; just use OpenBSD already !</p><center><img src=https://opensmtpd.org/images/opensmtpd.png></center><p>For the SMTP layer,
which is in charge of exchanging messages between hosts disregarding what users will use to access their mail,
I will be using the <a href=https://www.OpenSMTPD.org/ target=_blank>OpenSMTPD</a> software.
It is the default SMTP daemon for the OpenBSD operating system and has a portable version which is <a href=https://github.com/OpenSMTPD/OpenSMTPD target=_blank>available on Github</a> with instructions on how to build.
These instructions are for the <strong>6.6.0 version</strong> or later,
they <strong>will not work</strong> on earlier versions.</p><center><img src=https://www.dovecot.org/wp-content/uploads/2021/09/dovecot_logo.png></center><p>For the IMAP layer,
which will allow users to retrieve messages they received and access them from their smartphones or webmails,
I will use the latest version of <a href=https://www.dovecot.org target=_blank>Dovecot</a>.
I will also use the Dovecot-Pigeonhole package,
which will allow us to train the antispam solution into learning Ham from Spam.
If you intend to only use a console client over ssh,
such as <code>mutt</code> for example,
you can skip that part as OpenSMTPD can deliver in a local mailbox that mails clients can access directly.
In this article,
we setup IMAP because we acually want to read mails from a smartphone as that&rsquo;s what the regular people do.</p><center><img src=https://camo.githubusercontent.com/ea57696ebeee9a4a6668347acf7ebd8ef8f74ee7/68747470733a2f2f727370616d642e636f6d2f696d672f727370616d645f6c6f676f5f626c61636b2e706e67></center><p>Finally,
for the spam filtering layer,
I will use the excellent <a href=https://www.rspamd.com target=_blank>Rspamd</a> daemon which is far more than <em>just</em> an antispam solution.
It provides state of the art spam filtering methods,
but also provides antivirus integration,
dkim signing,
and a ton of modules which you can chose to use or not to fine tune your setup.
In this article,
we&rsquo;ll simply use it for its DKIM-signing and spam filtering features which is the bare minimum we need.</p><h2 class="relative group">Making myself reachable<div id=making-myself-reachable class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#making-myself-reachable aria-label=Anchor>#</a></span></h2><p>SMTP is very tighly coupled with DNS and other hosts rely on DNS lookups to find out which machine handle mail for your domain.
This is done through the lookup of MX (Mail eXchanger) records,
so the most minimal thing to do for SMTP to work is to declare an MX record for your domain.
For <code>hypno.cat</code>,
the zone contains the following:</p><pre tabindex=0><code>;; an A (and AAAA record for IPv6) record is declared to name your mail server

mail.hypno.cat  A       217.69.8.253
mail.hypno.cat  AAAA    2001:19f0:6801:867:5400:01ff:fee7:7af7


;; an MX record is declared to let the world know that mail.hypno.cat handles mail for hypno.cat
;; 0 is the highest preference, if we had a backup MX we&#39;d set a higher number on it,
;; let&#39;s keep that for later, shall we ?

hypno.cat.      MX 0    mail.hypno.cat.
;;hypno.cat.    MX 10   mail-backup.hypno.cat.
</code></pre><p>I can verify that everything is fine using the <code>host</code> and <code>dig</code> utilities to check that the mail server name resolves and that the MX lookup returns the mail server name:</p><pre tabindex=0><code>$ host mail.hypno.cat
mail.hypno.cat has address 217.69.8.253
mail.hypno.cat has IPv6 address 2001:19f0:6801:867:5400:1ff:fee7:7af7

$ dig -t MX hypno.cat +short
0 mail.hypno.cat.
</code></pre><p>At this point and with these DNS records,
other mail servers can already lookup which MX is responsible for <code>hypno.cat</code>,
and contact it when they want to send mail to any address for that domain.</p><h2 class="relative group">Making myself look all fine and dandy<div id=making-myself-look-all-fine-and-dandy class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#making-myself-look-all-fine-and-dandy aria-label=Anchor>#</a></span></h2><p>That&rsquo;s not enough because nowadays you <strong>MUST</strong> have a reverse DNS (rDNS) <strong>AND</strong> Forward-Confirmed rDNS (FCrDNS).</p><p>There&rsquo;s a reason for that.
A large number of the hosts spamming the world are compromised machines,
with a large share of them being home computers behind residential connections.
Many of these residential connections don&rsquo;t have rDNS,
don&rsquo;t have FCrDNS,
or have an rDNS that matches a dynamically allocated IP pattern (ie: <code>123.123.123.123.dyn.adsl.example.com</code>).
Because they are individually compromised machines,
and not regular servers under the spammers control,
rDNS and FCrDNS can&rsquo;t be configured to look nice&mldr;
so it became a proof-of-work to configure your rDNS and FCrDNS correctly while ensuring that it doesn&rsquo;t look like a dynamically allocated IP pattern.
In some of the Big Mailer Corps guidelines this is explicitely stated,
for others you just discover that the hard way.
Either way,
it&rsquo;s a BARE MINIMUM,
make sure that your hostname looks like a REAL mail server (ie: <code>mail.hypno.cat</code>, not <code>www.hypno.cat</code>).</p><p>rDNS is usually out of your control because it&rsquo;s managed in a somewhat special &ldquo;arpa&rdquo; zone owned by the IP address owner.
ISP usually don&rsquo;t let you configure it but server providers can&rsquo;t realistically expect their customers not to,
so they generally provide a small form somewhere in their control panels to let you provide the rDNS you want for the IP address they allocated you:</p><center><img src=2019-09-01-vultr-rdns.png></center><p>If I setup my rDNS to be the same as the forward records I configured above, then I automatically pass the FCrDNS test.
This can be easily verified by looking up the rDNS for an IP address:</p><pre tabindex=0><code>$ host 217.69.8.253   
253.8.69.217.in-addr.arpa domain name pointer mail.hypno.cat.
$ host 2001:19f0:6801:867:5400:1ff:fee7:7af7
7.f.a.7.7.e.e.f.f.f.1.0.0.0.4.5.7.6.8.0.1.0.8.6.0.f.9.1.1.0.0.2.ip6.arpa domain name pointer mail.hypno.cat.
</code></pre><p>Then looking up the IP address for that rDNS:</p><pre tabindex=0><code>$ host mail.hypno.cat
mail.hypno.cat has address 217.69.8.253
mail.hypno.cat has IPv6 address 2001:19f0:6801:867:5400:1ff:fee7:7af7
</code></pre><p>If they match both ways, then everything&rsquo;s fine.</p><h2 class="relative group">Advertise which machines are allowed to send mail on behalf of my domain<div id=advertise-which-machines-are-allowed-to-send-mail-on-behalf-of-my-domain class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#advertise-which-machines-are-allowed-to-send-mail-on-behalf-of-my-domain aria-label=Anchor>#</a></span></h2><p>SPF is a mechanism which makes it possible for destination mail servers to determine if a machine was allowed to send mail on behalf of a domain.</p><p>How it works is very simple,
basically you add a DNS record to the zone for your domain stating which servers will emit mails.
When a destination mail server receives mail with a sender from your domain,
it checks if the IP address of the server submitting the e-mail is part of the whitelist.</p><p>SPF is not mandatory but it is one of the things that makes you look good.
While it is only informative by default,
not necessarily resulting in mails being junked if they fail the test,
it does have an impact on computing the likeliness of a message being a spam when added to other factors.
It is commonly accepted that lack of SPF has a very negative impact on the reputation of a domain,
so given how simple it is to provide the record,
there&rsquo;s simply no excuse.</p><p>There are multiple ways to setup SPF,
in this example I will simply set it up so ONLY my mail server can send mail on my behalf:</p><pre tabindex=0><code>hypno.cat.      IN TXT  &#34;v=spf1 mx -all&#34;
</code></pre><p>Should hosts receive a mail with a sender <code>@hypno.cat</code> not originating from <code>mail.hypno.cat</code>,
they will be able to assume,
or even enforce,
that it should be rejected.</p><h2 class="relative group">Prove that I actually authorized the message<div id=prove-that-i-actually-authorized-the-message class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#prove-that-i-actually-authorized-the-message aria-label=Anchor>#</a></span></h2><p>DKIM is an authentication mechanism by which you can cryptographically sign mails emitted by your mail server,
proving that you saw them and took responsibility in letting them transit.
Hosts receiving these mails can verify that you authorized them,
by verifying the signature and detect possible forgery.</p><p>Like SPF,
this is informative by default and failing a DKIM signature or even lacking the mechanism doesn&rsquo;t mean a mail can&rsquo;t inbox,
however it accounts in the bad points given to a sender and degrades the reputation.
It is also commonly accepted that lack of DKIM has a very negative impact on the reputation of a domain,
so again, just do it.</p><p>It is slightly more complex than SPF because,
although it also relies on DNS,
for DKIM you have to generate a keypair in order to publish the public key in a DNS record.</p><p><strong>We&rsquo;re in 2019</strong>,
I will be generating a 1024 bits RSA key,
<strong>I know</strong>.</p><p>&mdash; BEGIN DIGRESSION &mdash;</p><p>2048 bits RSA public keys do not fit in a DNS TXT record and must be truncated into two records,
but not everyone is able to cope with these truncated keys so you may lose DKIM benefits by going 2048 if hosts fail to use your (partial) public key and assume you&rsquo;ve failed signing.
Given that we&rsquo;re not looking into security more than trying to look good at this point,
we&rsquo;ll just look the other way while excusing the fact that there&rsquo;s a very moderate risk of impersonation when used in conjunction with SPF.
<strong>This is very bad thinking</strong> but DKIM also has other short-comings and given that virtually everyone does 1024 bits RSA,
I suggest we argue about the 1024 vs >= 2048 key size when we&rsquo;re already successful at exchanging mails with Big Mailer Corps,
but I&rsquo;ll just take a moment to stress out,
without pointing fingers at any,
that even some security companies that actually work in the mail industry have issues with 2048 bits RSA.</p><p>Companies that actually provide sender reputation scoring.
Oh, the, irony.</p><p>&mdash; END DIGRESSION &mdash;</p><p>If this genuinely worries you,
you can still experiment truncating key into two records and see if it suits you,
adapting my example is trivial,
just make sure you have a TXT record with a part of the key and another TXT record with the remaining.</p><p>I&rsquo;ll create a directory to hold the keys:</p><pre tabindex=0><code># mkdir /etc/mail/dkim
</code></pre><p>Then, the following commands will generate the keypair and extract the public key out of the private key:</p><pre tabindex=0><code># openssl genrsa -out /etc/mail/dkim/hypno.cat.key 1024                                       
Generating RSA private key, 1024 bit long modulus
..............................++++++
...............++++++
e is 65537 (0x10001)

# openssl rsa -in /etc/mail/dkim/hypno.cat.key -pubout -out /etc/mail/dkim/hypno.cat.pub 
writing RSA key

# cat /etc/mail/dkim/hypno.cat.pub                                                                 
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDThHqiM610nwN1nmV8OMc7PaPO
uJWVGRDz5bWj4cRjTTmQYjJQd02xrydRNrRhjEKBm2mMDArNWjoM3jvN04ZifqJx
DmKr7X8jsYi+MPEHz6wZxB8mayDK6glYTCyx//zl1luUdvm26PutA38K8cgnb7iT
kfVP2OqK6sHAdXjnowIDAQAB
-----END PUBLIC KEY-----
</code></pre><p>Finally,
I can create the DNS TXT record by extracting the public key out of the armor delimiters and formatting the content so it displays as follows:</p><pre tabindex=0><code>20190913._domainkey.hypno.cat.	IN TXT &#34;v=DKIM1;k=rsa;p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDThHqiM610nwN1nmV8OMc7PaPOuJWVGRDz5bWj4cRjTTmQYjJQd02xrydRNrRhjEKBm2mMDArNWjoM3jvN04ZifqJxDmKr7X8jsYi+MPEHz6wZxB8mayDK6glYTCyx//zl1luUdvm26PutA38K8cgnb7iTkfVP2OqK6sHAdXjnowIDAQAB;&#34;
</code></pre><p>The name of the record should be constructed using this pattern: <code>&lt;selector>._domainkey.&lt;domain>.</code>,
where <code>&lt;selector></code> is a name you chose and which allows multiple keys to coexist.
I like to use the date at which I generated the keypair,
but whatever you chose,
write it down for later as we&rsquo;ll need it when configuring DKIM signing.</p><p>Also,
note that the public key doesn&rsquo;t have to be kept in the directory once it&rsquo;s published in DNS.
It can always be retrieved from the private key should it be needed for some reason,
however I like keeping it around for fast reference.
And make sure the private key isn&rsquo;t world-readable if you have local users on your system,
for some reason OpenSSL thinks private keys should be created <code>rw-r--r--</code>.</p><h2 class="relative group">Instructing hosts what to do with SPF and DKIM failures with DMARC<div id=instructing-hosts-what-to-do-with-spf-and-dkim-failures-with-dmarc class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#instructing-hosts-what-to-do-with-spf-and-dkim-failures-with-dmarc aria-label=Anchor>#</a></span></h2><p>SPF and DKIM are both fine,
but if they&rsquo;re informative then it also mean they don&rsquo;t prevent abuses of your domain name.</p><p>DMARC allows instructing a destination mail server what to do with senders that fail SPF and DKIM tests.
Most notably it allows instructing them to reject such senders.</p><p>There&rsquo;s no clear indicator that providing a reject policy brings any positive points to a domain over not doing anything,
however there are multiple hints that having a DMARC record has a positive impact over having none,
even if that record states that nothing should be done about SPF and DKIM failures.</p><p>The format of DMARC records goes beyond this article and you&rsquo;ll find multiple examples in any search engine,
but a very simple record will simply state a policy (p=) of <code>none</code> (<code>reject</code> if you want to be harsh, <code>quarantine</code> if you need more time to decide).
The percentage field (pct=) declares how many of these mails should be subjected to the DMARC policy,
and the Reporting URI of Aggregated field (rua=) is where you should receive DMARC reports should you want to analyze them (before switching from <code>quarantine</code> to <code>reject</code> for example).</p><p>I&rsquo;ll just setup the most dummy record,
one that will make all Big Mailer Corps see that we care about DMARC even though we don&rsquo;t know what to do with it:</p><pre tabindex=0><code>_dmarc.hypno.cat.   IN TXT    &#34;v=DMARC1;p=none;pct=100;rua=mailto:postmaster@hypno.cat;&#34;
</code></pre><h2 class="relative group">Getting yourself a certificate for TLS<div id=getting-yourself-a-certificate-for-tls class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#getting-yourself-a-certificate-for-tls aria-label=Anchor>#</a></span></h2><p>There are multiple ways you can obtain a TLS certificate,
and assuming that you are already familiar with hosting other services,
I&rsquo;ll just pretend that you already know how to obtain one from your registrar or from <a href=https://letsencrypt.org target=_blank>letsencrypt</a>.</p><p><strong>If you know how to deal with your certificates, you can just skip this section and go to the next one.</strong></p><p>Since I&rsquo;m really setting up <code>mail.hypno.cat</code>,
I won&rsquo;t be able to continue this article without obtaining a certificate,
so as a courtesy to OpenBSD users I&rsquo;ll document how I will generate mine on a brand new OpenBSD install.
<code>acme-client</code> is a utility that lets you request and renew certificates from the console.
It relies on an HTTP challenge,
so it needs to be able to write to a directory that is served over HTTP,
but luckily OpenBSD also ships with an <code>httpd</code> daemon that we can use for the challenge.
Because we&rsquo;re EXTRA lucky, it also provides an example configuration file that we can use with almost no change.</p><p>Simply copy the example configuration from <code>/etc/example/httpd.conf</code> to <code>/etc/httpd.conf</code>,
replace <code>example.com</code> with <code>mail.hypno.cat</code> and remove the tls block since we only care about serving the challenge.
The file should now read as follow:</p><pre tabindex=0><code>server &#34;mail.hypno.cat&#34; {
        listen on * port 80
        location &#34;/.well-known/acme-challenge/*&#34; {
                root &#34;/acme&#34;
                request strip 2
        }
        location * {
                block return 302 &#34;https://$HTTP_HOST$REQUEST_URI&#34;
        }
}
</code></pre><p>The <code>httpd</code> daemon can be started with the following command:</p><pre tabindex=0><code># rcctl -f start httpd
httpd(ok)
</code></pre><p>The acme-client itself is straighforward to configure,
again simply copy the example configuration from <code>/etc/example/acme-client.conf</code> to <code>/etc/acme-client.conf</code>,
replace <code>example.com</code> with <code>mail.hypno.cat</code> and you should end up with a block like this:</p><pre tabindex=0><code>domain mail.hypno.cat {
        domain key &#34;/etc/ssl/private/mail.hypno.cat.key&#34;
        domain full chain certificate &#34;/etc/ssl/mail.hypno.cat.fullchain.pem&#34;
        sign with letsencrypt
}
</code></pre><p>at this point you can simply run <code>acme-client</code> on the domain:</p><pre tabindex=0><code># acme-client -v mail.hypno.cat
[...]
acme-client: /etc/ssl/mail.hypno.cat.fullchain.pem: created
</code></pre><p>The certificate and keys are created at the appropriate place,
we&rsquo;ll later adjust paths in OpenSMTPD and Dovecot to point to the proper files.</p><p>You can keep the httpd running for future renewals and call <code>acme-client</code> from a cron,
you can shut it down and deal with renewals in another way.
You sort out how you want to renew with the help of the <code>acme-client(1)</code> man page.</p><h2 class="relative group">Installing and configuring Rspamd<div id=installing-and-configuring-rspamd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#installing-and-configuring-rspamd aria-label=Anchor>#</a></span></h2><p>On OpenBSD, Rspamd is packaged and can be installed with a single command.
We also need to install Redis which is used to store Rspamd statistics and greylisting states (among other things),
as well as <code>filter-rspamd</code> which is the piece of code that allows OpenSMTPD to work with Rspamd.
Both of them are also packaged so they can be installed with a single command too.</p><p>As I&rsquo;m writing this,
<code>filter-rspamd</code> will only be available in the next OpenBSD release due in October,
so if you want to play with it before then,
you can simply <a href=https://github.com/poolpOrg/filter-rspamd target=_blank>obtain it from github</a> and read the README instructing how to build.
Both Redis and Rspamd are already available in OpenBSD packages so the instructions below are already valid for them.</p><p>First,
I&rsquo;ll install these packages:</p><pre tabindex=0><code>mail$ doas pkg_add redis rspamd opensmtpd-filter-rspamd
[...]
redis-4.0.14: ok
rspamd-1.9.0: ok
opensmtpd-filter-rspamd-0.1.1: ok
The following new rcscripts were installed: /etc/rc.d/redis /etc/rc.d/rspamd
See rcctl(8) for details.
</code></pre><p>Rspamd is highly configurable so if you want to do funky things, it&rsquo;s up to you to go <a href=https://rspamd.com/doc/configuration/ target=_blank>read the extensive documentation</a>.
For the purpose of this article I&rsquo;ll keep it very basic,
as is the case on my own machines.</p><p>I could edit the configuration in <code>/etc/rspamd/actions.conf</code> to adjust junking thresholds to my liking, but the defaults suit me fine so this was just to show them to you:</p><pre tabindex=0><code>actions {
    reject = 15;    # Reject when reaching this score
    add_header = 6; # Add header when reaching this score
    greylist = 4;   # Apply greylisting when reaching this score (will emit `soft reject action`)
    [...]
</code></pre><p>And what I really, really want is for Rspamd to handle my DKIM signing because this is one of the requirements to not look bad to the world.</p><p>This is done by providing the configuration to match the DKIM key I generated earlier in <code>/etc/rspamd/local.d/dkim_signing.conf</code>:</p><pre tabindex=0><code># mkdir /etc/rspamd/local.d
# cat &lt;&lt; EOF &gt;/etc/rspamd/local.d/dkim_signing.conf
allow_username_mismatch = true;

domain {
    hypno.cat {
        path = &#34;/etc/mail/dkim/hypno.cat.key&#34;;
        selector = &#34;20190913&#34;;
    }
}
EOF
</code></pre><p>The <code>allow_username_mismatch</code> configuration is needed here because Rspamd expects usernames to contain the domain name,
but <strong>in this setup</strong> OpenSMTPD authenticates against simple usernames. Also make sure the dkim key file is
readable by members of the <code>_rspamd</code> group.</p><h2 class="relative group">Optional: Only accept mail in certain languages<div id=optional-only-accept-mail-in-certain-languages class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optional-only-accept-mail-in-certain-languages aria-label=Anchor>#</a></span></h2><p>Rspamd is very configurable, and you can add your own rules. I have found the default rules are generally pretty
good for a generic mail server, however I get a lot of foreign language spam. If you are certain what languages
people using your server are able to understand I have found it very helpful to add a filter to mark mail read
in languages I do not understand as spam I have done this with the following lua rule.</p><pre tabindex=0><code class=language-cat data-lang=cat>local rspamd_logger = require &#39;rspamd_logger&#39;

local ok_langs = {
        [&#39;en&#39;] = true,
        [&#39;fr&#39;] = true,
}

rspamd_config.LANG_FILTER = {
        callback = function(task)
                local any_ok = false
                local lang_seen = false
                local parts = task:get_text_parts()
                for i, p in ipairs(parts) do
                        local ln = p:get_language() or &#39;&#39;
                        local dash = ln:find(&#39;-&#39;)
                        if dash then
                                -- from zh-cn to zh
                                ln = ln:sub(1, dash-1)
                        end
                        lang_seen = true
                        rspamd_logger.infox(&#34;lang for %1 is %2&#34;, i, ln)
                        if ok_langs[ln] then
                                any_ok = true
                        end
                end
                if any_ok then
                        return 0.1
                end
                if not (lang_seen) then
                        rspamd_logger.infox(&#34;no language seen&#34;)
                        return 0.1
                end
                return 1.0
        end,
        score = 6.0,
        description = &#39;no ok languages&#39;,
}
EOF
</code></pre><p>You will need to edit the above added file if you understand different languages than
english and french. To activate it, add a line to /usr/local/share/rspamd/rules/rspamd.lua:</p><pre tabindex=0><code>dofile(local_rules .. &#39;/rspamd-local.lua&#39;)
</code></pre><h2 class="relative group">Enable and start redis and rspamd<div id=enable-and-start-redis-and-rspamd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#enable-and-start-redis-and-rspamd aria-label=Anchor>#</a></span></h2><p>We&rsquo;re done here, Rspamd and Redis can be enabled so OpenBSD starts them at next reboot:</p><pre tabindex=0><code># rcctl enable redis
# rcctl enable rspamd
</code></pre><p>And I can start them right away so we don&rsquo;t have to wait until next reboot:</p><pre tabindex=0><code># rcctl start redis
redis(ok)
# rcctl start rspamd
rspamd(ok)
</code></pre><h2 class="relative group">Configuring OpenSMTPD<div id=configuring-opensmtpd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#configuring-opensmtpd aria-label=Anchor>#</a></span></h2><p>OpenSMTPD is installed by default on OpenBSD so there is no installing phase here.
If you run a different operating system,
either someone has packaged it there and you can install using your package manager,
or you can build from source and install by getting code from <a href=https://github.com/OpenSMTPD/OpenSMTPD target=_blank>Github mirror</a> and following build instructions.</p><p>As stated earlier,
<strong>these instructions are only valid for the 6.6.0 release and later</strong>,
earlier versions don&rsquo;t support filters and some other features described here.</p><p>The default configuration for OpenSMTPD is suitable for local mail server,
not accepting connections from the outside,
but able to let local users exchange messages between themselves and to a remote host.
It looks like this:</p><pre tabindex=0><code>#       $OpenBSD: smtpd.conf,v 1.11 2018/06/04 21:10:58 jmc Exp $

# This is the smtpd server system-wide configuration file.
# See smtpd.conf(5) for more information.

table aliases file:/etc/mail/aliases

# To accept external mail, replace with: listen on all
#
listen on lo0

action &#34;local_mail&#34; mbox alias &lt;aliases&gt;
action &#34;outbound&#34; relay

# Uncomment the following to accept external mail for domain &#34;example.org&#34;
#
# match from any for domain &#34;example.org&#34; action &#34;local_mail&#34;
match for local action &#34;local_mail&#34;
match for any action &#34;outbound&#34;
</code></pre><p>It uses sane defaults as to make it hard to misconfigure,
so if you&rsquo;re worried about the last line (<code>match for any</code>)
turning your server into an open-relay,
don&rsquo;t worry too much as it has an implicit (<code>from local</code>).
You would have to very explicitely tell your server to <code>match from any for any</code> in order to let spammers abuse you.</p><p>I initially wanted to update the configuration file progressively to hold your hand,
but this article grew a lot since my first version.
I&rsquo;ll just put the complete 16 configuration lines configuration file and comment it extensively afterwards:</p><pre tabindex=0><code>pki mail.hypno.cat cert &#34;/etc/ssl/mail.hypno.cat.fullchain.pem&#34;
pki mail.hypno.cat key &#34;/etc/ssl/private/mail.hypno.cat.key&#34;

filter check_dyndns phase connect match rdns regex { &#39;.*\.dyn\..*&#39;, &#39;.*\.dsl\..*&#39; } \
    disconnect &#34;550 no residential connections&#34;

filter check_rdns phase connect match !rdns \
    disconnect &#34;550 no rDNS is so 80s&#34;

filter check_fcrdns phase connect match !fcrdns \
    disconnect &#34;550 no FCrDNS is so 80s&#34;

filter senderscore \
    proc-exec &#34;filter-senderscore -blockBelow 10 -junkBelow 70 -slowFactor 5000&#34;

filter rspamd proc-exec &#34;filter-rspamd&#34;

table aliases file:/etc/mail/aliases

listen on all tls pki mail.hypno.cat \
    filter { check_dyndns, check_rdns, check_fcrdns, senderscore, rspamd }

listen on all port submission tls-require pki mail.hypno.cat auth filter rspamd

action &#34;local_mail&#34; maildir junk alias &lt;aliases&gt;
action &#34;outbound&#34; relay helo mail.hypno.cat

match from any for domain &#34;hypno.cat&#34; action &#34;local_mail&#34;
match for local action &#34;local_mail&#34;

match from any auth for any action &#34;outbound&#34;
match for any action &#34;outbound&#34;
</code></pre><p>That&rsquo;s all is needed for our complete SMTP setup.</p><p>The first two <code>pki</code> lines declare that <code>mail.hypno.cat</code> will use the certificate and key we generated earlier for TLS.</p><p>The filter lines apply a set of filters to incoming connections,
<code>check_dyndns</code> will filter if rDNS matches some patterns,
<code>check_rdns</code> will filter if rDNS is missing,
<code>check_fcrdns</code> will filter if FCrDNS is missing,
these are builtin filters in OpenSMTPD that you can tweak to filter at different phases or using other criterias.</p><p><code>senderscore</code> is a custom filter that you can install either through your package manager (<code>pkg_add opensmtpd-filter-senderscore</code> on OpenBSD),
or obtain from <a href=https://github.com/poolpOrg/filter-senderscore target=_blank>Github</a>.
It is not mandatory but I find it particularly useful and will explain why in the next section.
In this configuration,
it will reject a sender if its senderscore is below 10, <code>junk</code> message (add X-Spam header) if score is below 70,
and for my own personal pleasure,
add a delay to each response that is proportional to how bad the reputation is so bad senders are slowed down.</p><p><code>rspamd</code> is also a custom filter that we installed in the previous section.
There&rsquo;s no configuration as it is fully controlled from the Rspamd daemon responses,
all we need to do is declare it.</p><p>If you want to be more conservative and not reject mails to avoid false positives,
you can assign a <code>junk</code> action rather than <code>disconnect</code> action to builtin filters and remove the <code>-blockBelow</code> option in the <code>senderscore</code> filter:</p><pre tabindex=0><code>filter check_dyndns phase connect match rdns regex { &#39;.*\.dyn\..*&#39;, &#39;.*\.dsl\..*&#39; } junk
filter check_rdns phase connect match !rdns junk
filter check_fcrdns phase connect match !fcrdns junk
filter senderscore proc-exec &#34;filter-senderscore -junkBelow 70 -slowFactor 5000&#34;
</code></pre><p>This way instead of rejecting sessions,
OpenSMTPD will simply junk them so they are in your Spam folder.
By monitoring what ends in your junk folder,
you can gain confidence and tune settings to match what you really want.</p><p>These simple filters,
not even counting rspamd,
are enough to cut most of my Spam turning <em>hundreds</em> of daily spam into a handful.
The <code>rdns regex</code> one can be tuned as depending on your country,
you may see patterns that are particularly repetitive and that would never appear in mine.
To ease maintenance,
you can store them in a file, one by line and use the following construct:</p><pre tabindex=0><code>table &lt;dyndns&gt; file:/etc/mail/path-to-my-regex-file
filter check_dyndns phase connect match rdns regex &lt;dyndns&gt; junk
</code></pre><p>Let&rsquo;s continue dissecting the configuration.</p><p>The <code>table aliases</code> points to a file with&mldr; aliases in two columns.
The left column has the user-part of an e-mail address you receive,
the right column has the user to which it should be delivered (ie: <code>root: gilles</code>)
It is recommended that you have aliases mapping <code>root</code>, <code>abuse</code> and <code>postmaster</code> to an account that you actually read.
I didn&rsquo;t do that because I&rsquo;m going to trash the install after this article,
but do it.</p><p>Then comes the <code>listen</code> lines.
The first one is the public endpoint that other mail servers can contact to send mails to <code>hypno.cat</code>,
it is configured to offer <code>tls</code> using the certificate and key for <code>mail.hypno.cat</code> and filter incoming sessions through all my filters.
The second one is the endpoint for my own users,
on the <code>submission</code> port,
it requires <code>tls</code> using the same certificates,
requires <code>auth</code> using system users (the default, can be configured otherwise),
and filters through the rspamd filter only so we can DKIM-sign our own messages.</p><p>The <code>action</code> lines define an action for local mail which is to deliver to a maildir,
while classifying junk in a specific folder and resolving aliases,
the other action is to relay mail and let other host know that we&rsquo;re <code>mail.hypno.cat</code> when we greet ourselves.
If a server had multiple IP addresses the relay action should also specify the source address to use (with <code>src</code>) to make sure the proper IP address is used,
here I only have one IP address and it is used for mail so I don&rsquo;t have to.</p><p>Finally,
the <code>match</code> lines are the ruleset.
When an envelope enters the SMTP server through one of the <code>listen</code> endpoints,
it is compared to each <code>match</code> line one after another until a matching <code>action</code> in found or the envelope is rejected.
The conditions are fairly explicit so I won&rsquo;t describe these four lines,
you should be able to figure out by yourself what <code>from any for domain "hypno.cat"</code> means otherwise you shouldn&rsquo;t be reading this in the first place.</p><h2 class="relative group">A few words about SenderScore<div id=a-few-words-about-senderscore class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#a-few-words-about-senderscore aria-label=Anchor>#</a></span></h2><p>SenderScore is an IP reputation database which associates a score ranging between 0 and 100 to an IP address.
The score is tied to the volume and behavior observed from these IP addresses,
and while we can&rsquo;t really know HOW these scores are computed because the methodology is not public,
a bit of studying allows confirming that they didn&rsquo;t make these numbers out of nowhere:
they do correlate with delivery and error rates at various Big Mailer Corps and it is possible to influence the scoring with changes of behaviors that also correlate to changes in delivery and error rates.</p><p>It is also <strong>VERY</strong> obvious that to build their reputation score they have access to SMTP session informations that only a destination mail server can have,
such as the volume of mails observed from an IP address,
or the ratio of failed vs accepted recipients,
and since the scoring correlates with delivery and error rates in my observations,
this implies that they get this information from Big Mailer Corps.
Do what you want with that bit of information.</p><p>Based on <strong><em>MY</em></strong> understanding,
it is a very interesting indicator to limit the amount of spam hitting you.
I don&rsquo;t trust it to be accurate when it comes to good reputations (because I kinda know how to work a bit around)
but I do trust it to be HIGHLY accurate when it comes to bad reputations,
because it takes a certain amount of doing bad things in high volumes to see a scoring degrade.
If you don&rsquo;t do bulk mailing,
you should definitely either be unknown to them or have a scoring around 95 or above,
otherwise you&rsquo;re very likely doing something wrong.</p><p>Not everyone is convinced about SenderScore and some delivery experts claim it&rsquo;s bullshit.
I personally ran months-long experiments graphing daily reputation and volumes,
then comparing them to delivery graphs,
and my opinion is quite the opposite:
to me there is a very significant correlation that definitely helps classify senders.
I think the best approach is to use the filter for junking,
not blocking,
and determining by yourself if you&rsquo;re happy with it.</p><p>SenderScore considers that hosts should have a reputation above 70,
I would personally assume hosts below 80 to be good junking candidates,
and hosts below 10 to be obvious rejects.</p><h2 class="relative group">Installing and configuring Dovecot<div id=installing-and-configuring-dovecot class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#installing-and-configuring-dovecot aria-label=Anchor>#</a></span></h2><p>OpenBSD also has a package for Dovecot which can be installed with a simple command:</p><pre tabindex=0><code>mail# pkg_add dovecot
dovecot-2.3.7.2v0: ok
The following new rcscripts were installed: /etc/rc.d/dovecot
See rcctl(8) for details.
New and changed readme(s):
        /usr/local/share/doc/pkg-readmes/dovecot
[...]
</code></pre><p>And,
<strong>specifically for OpenBSD</strong>,
following instructions from the readme,
the <code>/etc/login.conf</code> file should contain a <code>dovecot</code> class to bump the resources allowed as Dovecot is very hungry for file descriptors:</p><pre tabindex=0><code>dovecot:\
    :openfiles-cur=1024:\
    :openfiles-max=2048:\
    :tc=daemon:
</code></pre><p>Once that is done,
there&rsquo;s really not much to do on the Dovecot side except have it point to the proper TLS certificate we generated earlier.</p><p>I do that by tweaking the <code>ssl_cert</code> and <code>ssl_key</code> configuration keys in the <code>/etc/dovecot/conf.d/10-ssl.conf</code> file so they read as follows:</p><pre tabindex=0><code>ssl_cert = &lt;/etc/ssl/mail.hypno.cat.fullchain.pem
ssl_key = &lt;/etc/ssl/private/mail.hypno.cat.key
</code></pre><p>Then Dovecot must be told that mails should be looked up in the user <code>~/Maildir</code> directory as this is where OpenSMTPD drops files.
I do that by tweaking the <code>mail_location</code> configuration key in the <code>/etc/dovecot/conf.d/10-mail.conf</code> file so it reads as follows:</p><pre tabindex=0><code>mail_location = maildir:~/Maildir
</code></pre><p>We&rsquo;re all set, we can enable the daemon so it&rsquo;s started at next boot, and start it right away:</p><pre tabindex=0><code>mail# rcctl enable dovecot
mail# rcctl start dovecot   
dovecot(ok)
</code></pre><p>At this point,
you can already configure any mail client like <code>mutt</code>, <code>thunderbird</code> or even the <code>gmail</code> app on Android,
so that it uses <code>mail.hypno.cat</code> both for incoming and outgoing mails.</p><center><img src=2019-09-01-smartphone.png></center><h2 class="relative group">Teaching Dovecot to train Rspamd<div id=teaching-dovecot-to-train-rspamd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#teaching-dovecot-to-train-rspamd aria-label=Anchor>#</a></span></h2><p>You read until here,
good.</p><p>So this is a bonus section,
one that&rsquo;s absolutely not mandatory in setting up your mail server,
but one that I&rsquo;d like to add because it lets users train the spam filtering the same way they&rsquo;re used to already:
moving a mail to spam, marking a mail as spam or reporting a mail as spam,
whichever it is called on their interface.
The good news is that it integrates with IMAP,
so no matter if they use their smartphone app, a client on their desktop or a webmail,
the action of reporting a spam will automatically train the filter.</p><p>How you do that is relatively simple in theory,
it consists of plugging a couple scripts,
one to handle moving a mail from Inbox to Spam and one to handle moving mail from Spam to elsewhere.
In pratice,
Big Mailer Corps filters also detect that you delete a mail without opening it and such,
but let&rsquo;s not get too excited and start with something that&rsquo;s already good enough.
How you do that in practice is a bit more complex,
and that is because we will rely on Sieve which is&mldr;
how do you put it with diplomacy &mldr;
&ldquo;overengineered&rdquo;.</p><p><strong>Given that this is not a critical piece of the setup, you are allowed to shut your brain off and follow blindly instructions. Worst than can happen at this point is that it will not train anything.</strong></p><p>To enable imap sieve,
the Pigeonhole package must be installed,
and as has been the case throughout this article all I need is a simple command:</p><pre tabindex=0><code>mail# pkg_add dovecot-pigeonhole
dovecot-pigeonhole-0.5.7.2v1: ok

[...]
</code></pre><p>And&mldr;
here comes the tricky part, you need to configure Dovecot to enable imap_sieve,
and teach it what sieve scripts to use for what actions.</p><p>First, I will need to enable <code>imap_sieve</code> in Dovecot by adding it to the mail plugins for IMAP.
This is done by tweaking the <code>mail_plugins</code> configuration key in <code>/etc/dovecot/conf.d/20-imap.conf</code>:</p><pre tabindex=0><code>protocol imap {
    [...]

    mail_plugins = $mail_plugins imap_sieve
 
    [...]
}
</code></pre><p>Then to teach Dovecot how to train,
I&rsquo;ll add the following bit to <code>/etc/dovecot/conf.d/90-plugin.conf</code>,
telling it that there are sieve scripts to trigger when mail gets moved in and out of Junk mailbox:</p><pre tabindex=0><code>plugin {
  sieve_plugins = sieve_imapsieve sieve_extprograms
  sieve_global_extensions = +vnd.dovecot.pipe +vnd.dovecot.environment

  imapsieve_mailbox1_name = Junk
  imapsieve_mailbox1_causes = COPY APPEND
  imapsieve_mailbox1_before = file:/usr/local/lib/dovecot/sieve/report-spam.sieve

  imapsieve_mailbox2_name = *
  imapsieve_mailbox2_from = Junk
  imapsieve_mailbox2_causes = COPY
  imapsieve_mailbox2_before = file:/usr/local/lib/dovecot/sieve/report-ham.sieve

  imapsieve_mailbox3_name = Inbox
  imapsieve_mailbox3_causes = APPEND
  imapsieve_mailbox3_before = file:/usr/local/lib/dovecot/sieve/report-ham.sieve

  sieve_pipe_bin_dir = /usr/local/lib/dovecot/sieve
}
</code></pre><p>Now that dovecot is ready,
I&rsquo;ll have to prepare the sieve part which relies on two sieve scripts to train spam and ham inside <code>/usr/local/lib/dovecot/sieve</code>:</p><pre tabindex=0><code># cat report-ham.sieve

require [&#34;vnd.dovecot.pipe&#34;, &#34;copy&#34;, &#34;imapsieve&#34;, &#34;environment&#34;, &#34;variables&#34;];

if environment :matches &#34;imap.mailbox&#34; &#34;*&#34; {
  set &#34;mailbox&#34; &#34;${1}&#34;;
}

if string &#34;${mailbox}&#34; &#34;Trash&#34; {
  stop;
}

if environment :matches &#34;imap.user&#34; &#34;*&#34; {
  set &#34;username&#34; &#34;${1}&#34;;
}

pipe :copy &#34;sa-learn-ham.sh&#34; [ &#34;${username}&#34; ];
</code></pre><pre tabindex=0><code># cat report-spam.sieve

require [&#34;vnd.dovecot.pipe&#34;, &#34;copy&#34;, &#34;imapsieve&#34;, &#34;environment&#34;, &#34;variables&#34;];

if environment :matches &#34;imap.user&#34; &#34;*&#34; {
  set &#34;username&#34; &#34;${1}&#34;;
}

pipe :copy &#34;sa-learn-spam.sh&#34; [ &#34;${username}&#34; ];
</code></pre><p>Because both sieve scripts rely on shell scripts <code>sa-learn-ham.sh</code> and <code>sa-learn-spam.sh</code>,
I also need to create these shell scripts in <code>/usr/local/lib/dovecot/sieve</code>:</p><pre tabindex=0><code># cat sa-learn-ham.sh

#!/bin/sh
exec /usr/local/bin/rspamc -d &#34;${1}&#34; learn_ham
</code></pre><pre tabindex=0><code># cat sa-learn-spam.sh

#!/bin/sh
exec /usr/local/bin/rspamc -d &#34;${1}&#34; learn_spam
</code></pre><p>And finally,
I need to compile the sieve scripts and make the shell scripts executable so that Dovecot can actually use them:</p><pre tabindex=0><code># sievec report-ham.sieve
# sievec report-spam.sieve
# chmod 755 sa-learn-ham.sh
# chmod 755 sa-learn-spam.sh
</code></pre><p>That&rsquo;s all,
now moving mails from a folder to another I can see the following lines in the <code>/var/log/rspamd/rspamd.log</code> file:</p><pre tabindex=0><code>2019-09-13 23:59:46 #18598(controller) &lt;1d44bd&gt;; csession; rspamd_controller_learn_fin_task: &lt;127.0.0.1&gt; learned message as ham: CAHPtQbOxQxBCsVd7nUCP4podu74Pa-F6k28z+4BWfNeeqWYiAg@mail.gmail.com
[...]
2019-09-14 00:01:57 #18598(controller) &lt;b76e28&gt;; csession; rspamd_controller_learn_fin_task: &lt;127.0.0.1&gt; learned message as spam: CAHPtQbOxQxBCsVd7nUCP4podu74Pa-F6k28z+4BWfNeeqWYiAg@mail.gmail.com
[...]
</code></pre><p>I&rsquo;m sure these can be simplified,
I&rsquo;ll be honest and say that I don&rsquo;t really care because it&rsquo;s just a side-feature,
I&rsquo;m unlikely to touch the sieve scripts for the next decade,
I don&rsquo;t think anyone should touch sieve scripts,
we should just come with something better that doesn&rsquo;t remind me of m4 wankery.</p><h2 class="relative group">Testing it all<div id=testing-it-all class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#testing-it-all aria-label=Anchor>#</a></span></h2><p>And now, we&rsquo;ll just test that we can do a round-trip from <code>hypno.cat</code> to <code>gmail.com</code>.</p><p>First,
I&rsquo;ll craft a mail from my <code>hypno.cat</code> account to my <code>gmail.com</code> account:</p><center><img src=2019-09-01-craft-mail.png></center><p>After sending it,
I&rsquo;ll check it arrives at <code>gmail.com</code>:</p><center><img src=2019-09-01-gmail-1.png></center><p>Then,
I&rsquo;ll check that it was sent over a TLS-secured channel:</p><center><img src=2019-09-01-gmail-2.png></center><p>I&rsquo;ll check that <code>gmail.com</code> is happy with our SPF declaration,
our DKIM signature and that it saw we had a DMARC record.
You do that by selecting &ldquo;Show original&rdquo; in the menu associated to each mail:</p><center><img src=2019-09-01-gmail-3.png></center><p>And finally,
I&rsquo;ll reply to the mail just to be sure that it works both ways:</p><center><img src=2019-09-01-received-mail.png></center><h2 class="relative group">Yay, we&rsquo;re done<div id=yay-were-done class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#yay-were-done aria-label=Anchor>#</a></span></h2><p>So this article is dense,
I wanted to <em>explain</em> why we do things,
if you remove all my blabber and focus on the purely technical aspects you&rsquo;ll realize that we built a working mail infra,
providing TLS inbound and outbound services,
with DKIM, SPF and DMARC compliant outgoing traffic,
and spam-filtered incoming traffic.
And we did this by:</p><ul><li>adding a couple A records, an MX record and three TXT records to our DNS zone</li><li>making sure rDNS was properly set</li><li>installing TLS certificates</li><li>building a ~15 lines configuration file for an SMTP server</li><li>modifying 3 lines in the default configuration of an IMAP server</li><li>modifying 8 lines in the default configuration of an antispam solution</li></ul><p>And because we were in a very good mood and willing to take an extra step to help users train antispam,
we implemented ham and spam training of Rspamd by:</p><ul><li>modifying approximately 20 lines in the default configuration of an IMAP server</li><li>copying 4 sieve scripts in a directory</li></ul><p>Agreed,
it may take a new comer some efforts to come up with these without help,
but none of these tasks qualify as hard or tricky.
In addition,
pretty much all of them are only one-time operations,
you don&rsquo;t edit the DNS zone or reset your rDNS every two days,
just like you don&rsquo;t touch your working configuration once in place unless you have a new use-case.
It may happen that you have to do a maintenance,
whatever that means,
but I don&rsquo;t see a scenario where such a maintenance would imply having to do &ldquo;all&rdquo; of that again.</p><p>That being said,
after you do it a few times,
it takes about ten minutes to replicate this setup from scratch as you&rsquo;ll know what you&rsquo;re doing,
because&mldr; you know, mail is not hard.</p><h2 class="relative group">So what should you do next ?<div id=so-what-should-you-do-next- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#so-what-should-you-do-next- aria-label=Anchor>#</a></span></h2><p>What you should do next is setup redundancy to ensure that a failure of your mail server does not causes mail loss.</p><p>In practice,
most mail exchangers will retry if their destination is down,
so <strong>even</strong> if you endure a downtime,
most of your mails will be buffered by your sender and resumed when your server is back.</p><p>In theory,
you still want to do things right,
and letting others buffer your own messages to cope with your downtimes is fairly impolite as they bear responsibility of your messages far longer than they should&mldr;
You should investigate how to setup a backup mail exchanger,
arrange with friends you trust to backup each other,
or even subscribe to a service that will offer backup mail to you.
Anything as long as you know a secondary server will be able to cover for you if you have a downtime.</p><p>Then,
no matter which way you chose to do it,
it will boil down to:</p><ul><li>adding an additional MX record to the DNS zone</li><li>configuring a backup mail server so it forwards mail for your domains to your mail server</li></ul><p>Rocket, science.</p><h2 class="relative group">Are we done ?<div id=are-we-done- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#are-we-done- aria-label=Anchor>#</a></span></h2><p>I will write a serie of articles to discuss reputation,
as well as some of the mechanisms in place at Big Mailer Corps that can cause people to fail delivery.</p><p>If these topics are of interest and I get positive feedback,
I might just write more often about deliverability concepts,
otherwise I&rsquo;ll just resume what I was doing before:
writing about my monthly opensource contributions.
It&rsquo;s up to you :-)</p><p>Finally,
in this article I have described a very simple setup but there are tons of interesting stuff you can do with mail infrastructures if you&rsquo;re not scared of working a bit on it.</p><p>I&rsquo;m currently building an infrastructure for a future mail hosting service which spans over multiple data centers in multiple countries,
which has a very high tolerance to failures,
has backup mail servers to cope with very extreme failures of primary mail servers,
can very easily scale to bursts of volumes,
that decorrelates incoming and outgoing traffic so it can provide partial services to people,
that can easily reroute traffic across machines to work around failures,
while providing IMAP services to virtual accounts on a multitude of domains,
all with daily backups of all mail directories.
The infrastructure currently costs me&mldr; less than 75 EUR a month.
It is also fairly simple with most machines being default installs of OpenBSD with <strong>very few</strong> changes to the base system.</p><p>If reading about how you can build such setups is of any interest,
I could also write about it to help people build MORE hosting alternatives which is ultimately what I hope for.</p><p>Thanks for reading me,
I still don&rsquo;t have a soundcloud,
however <a href=https://patreon.com/gilles target=_blank>I still have a patreon</a> if you want to support me,
or <strong>use the widgets right below the comment link</strong> to share this article on social medias.</p><p>If you find errors in this article,
please let me know so I can fix them,
I started writing this article late and continued half-way through the night so I might have let errors slip in despite multiple readings.</p></br></br></div><script>var oid="views_posts/2019-09-14/index.md",oid_likes="likes_posts/2019-09-14/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">You reached the end of this article,
<b>CONGRATULATIONS</b> !<br><br><b>Please ❤️</b> consider <b>sharing on social networks</b> to increase its visibility.<br><br>You can also help by
<b>commenting the article</u></b>,
if only to let me know if you liked it or not !</span></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;text=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;resubmit=true&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;description=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;quote=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;subject=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;resubmit=true&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/&amp;resubmit=true&amp;title=Setting%20up%20a%20mail%20server%20with%20OpenSMTPD,%20Dovecot%20and%20Rspamd" title aria-label><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div id=comments><script src=https://giscus.app/client.js data-repo=poolpOrg/poolp.org data-repo-id="MDEwOlJlcG9zaXRvcnkxMjYxODk2MjA=" data-category=Articles data-category-id=DIC_kwDOB4WANM4B-Zf1 data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/2019-08-30/you-should-not-run-your-mail-server-because-mail-is-hard/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">You should not run your mail server because mail is hard</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2019-08-30T12:00:00+00:00>30 August 2019</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/2019-09-21/september-2019-report-jules-opensmtpd-6.6.0-upcoming-release-and-related-things/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">September 2019 report: Jules, OpenSMTPD 6.6.0 upcoming release and related things</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2019-09-21T07:08:00+02:00>21 September 2019</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">Copyright © Gilles Chehade - poolp.org
-
<u><a href=/legal/>Legal notice</a></u></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://poolp.org/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=poolporg data-description="Support me on Buy me a coffee!" data-message="Support me !" data-color=#FFDD00 data-position=left data-x_margin=18 data-y_margin=18></script><div class=discord-button onclick='document.querySelector(".discord-dialog").className="discord-dialog discord-dialog--active"'><svg class="discord-button__icon" viewBox="0 0 24 24"><path d="M22 24l-5.25-5L17.38 21H4.5A2.5 2.5.0 012 18.5V3.5A2.5 2.5.0 014.5 1h15A2.5 2.5.0 0122 3.5V24M12 6.8c-2.68.0-4.56 1.15-4.56 1.15 1.03-.92 2.83-1.45 2.83-1.45l-.17-.17C8.41 6.36 6.88 7.53 6.88 7.53c-1.72 3.59-1.61 6.69-1.61 6.69 1.4 1.81 3.48 1.68 3.48 1.68L9.46 15c-1.25-.27-2.04-1.38-2.04-1.38S9.3 14.9 12 14.9s4.58-1.28 4.58-1.28S15.79 14.73 14.54 15L15.25 15.9S17.33 16.03 18.73 14.22C18.73 14.22 18.84 11.12 17.12 7.53c0 0-1.53-1.17-3.22-1.2l-.17.17s1.8.53 2.83 1.45c0 0-1.88-1.15-4.56-1.15M9.93 10.59c.65.0 1.18.57 1.17 1.27C11.1 12.55 10.58 13.13 9.93 13.13 9.29 13.13 8.77 12.55 8.77 11.86 8.77 11.16 9.28 10.59 9.93 10.59m4.17.0c.65.0 1.17.57 1.17 1.27C15.27 12.55 14.75 13.13 14.1 13.13 13.46 13.13 12.94 12.55 12.94 11.86 12.94 11.16 13.45 10.59 14.1 10.59z"/></svg></div><div class=discord-dialog><div class=discord-dialog__header><a href=https://discordapp.com><svg class="discord-dialog__logo" viewBox="0 0 532 130"><path d="M53.2 20.3H20v37.6l22.1 20V41.4H54c7.5.0 11.2 3.7 11.2 9.5v27.9c0 5.8-3.5 9.7-11.2 9.7H20v21.2h33.2c17.8.1 34.5-8.8 34.5-29.4V50.2c0-20.8-16.7-29.9-34.5-29.9zM227.3 80.4V49.6c0-11.1 19.8-13.7 25.8-2.5l18.3-7.5C264.3 23.7 251.1 19 240.2 19c-17.8.0-35.4 10.4-35.4 30.6v30.8c0 20.3 17.6 30.6 35 30.6 11.2.0 24.6-5.6 32-20.1l-19.6-9.1C247.4 94.2 227.3 91.2 227.3 80.4zM166.7 53.8c-6.9-1.5-11.5-4-11.8-8.3.4-10.4 16.3-10.7 25.6-.8l14.7-11.4C186 22 175.6 19 164.8 19c-16.3.0-32.1 9.2-32.1 26.8.0 17.1 13 26.2 27.3 28.4 7.3 1 15.4 3.9 15.2 9-.6 9.6-20.2 9.1-29.1-1.8L132 94.8c8.3 10.7 19.6 16.2 30.2 16.2 16.3.0 34.4-9.5 35.1-26.8C198.3 62.2 182.5 56.7 166.7 53.8zM99.8 109.7h22.4V20.3H99.8v89.4zM477.5 20.3h-33.2v37.6l22.1 20V41.4h11.8c7.5.0 11.2 3.7 11.2 9.5v27.9c0 5.8-3.5 9.7-11.2 9.7h-34v21.2h33.2c17.8.1 34.5-8.8 34.5-29.4V50.2C512 29.4 495.3 20.3 477.5 20.3zM314.6 19c-18.4.0-36.7 10.1-36.7 30.7v30.6c0 20.5 18.4 30.7 36.9 30.7 18.4.0 36.7-10.2 36.7-30.7V49.7C351.5 29.2 333 19 314.6 19zM329 80.3c0 6.4-7.2 9.7-14.3 9.7-7.2.0-14.4-3.2-14.4-9.7V49.7c0-6.6 7-10.1 14-10.1 7.3.0 14.7 3.2 14.7 10.1V80.3zM431.8 49.7c-.5-21-14.7-29.4-33-29.4h-35.5v89.5H386V81.3h4l20.6 28.4h28L414.4 79C425.2 75.6 431.8 66.3 431.8 49.7zM399.2 61.8H386V41.4h13.2c14.2.0 14.2 20.4.0 20.4z"/></svg></a></div><div class=discord-dialog__close-button onclick='document.querySelector(".discord-dialog").className="discord-dialog"'><svg viewBox="0 0 24 24"><path fill="#000" d="M13.46 12 19 17.54V19H17.54L12 13.46 6.46 19H5V17.54L10.54 12 5 6.46V5H6.46L12 10.54 17.54 5H19V6.46L13.46 12z"/></svg></div><div class=discord-dialog__container><div class=discord-dialog__guild>You're invited to join my Discord server</div>This is a chat server where I hang out, discuss my projects and sometimes screencast as I work on them.<br><br>Feel free to hop in, talk about your own projects, share your thoughts:
<b>this is a virtual coworking room for anyone to join</b>.</div><div class=discord-dialog__footer><a href=https://discord.gg/YC6j4rbvSk class=discord-dialog__btn>Join the server now</a></div></div></html>