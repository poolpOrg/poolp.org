<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd &#183; poolp.org</title><meta name=title content="Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd &#183; poolp.org"><link rel=canonical href=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/><link type=text/css rel=stylesheet href=/css/main.bundle.min.c6116b9ed1c907a8c0eb015f377d3eecc07e448d75729e31fc3de5881465c6c172ba9fa9a6800c030116caf2a110d92242bb816639484ca791f7cd107a8d49b5.css integrity="sha512-xhFrntHJB6jA6wFfN30+7MB+RI11cp4x/D3liBRlxsFyup+ppoAMAwEWyvKhENkiQruBZjlITKeR980Qeo1JtQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd"><meta property="og:description" content="TL;DR: - Pas de résumé, j'ai passé des heures à traduire, vous allez passer des minutes à lire ;) - OK… J'ai expliqué avec BIEN TROP DE DÉTAILS comment mettre en place un serveur de mail Merci à mes sponsors !"><meta property="og:type" content="article"><meta property="og:url" content="https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/"><meta property="og:image" content="https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/feature.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-23T07:57:00+02:00"><meta property="article:modified_time" content="2019-12-23T07:57:00+02:00"><meta property="og:site_name" content="poolp.org"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/feature.png"><meta name=twitter:title content="Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd"><meta name=twitter:description content="TL;DR: - Pas de résumé, j'ai passé des heures à traduire, vous allez passer des minutes à lire ;) - OK… J'ai expliqué avec BIEN TROP DE DÉTAILS comment mettre en place un serveur de mail Merci à mes sponsors !"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd","headline":"Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd","abstract":"TL;DR: - Pas de résumé, j\u0027ai passé des heures à traduire, vous allez passer des minutes à lire ;) - OK… J\u0027ai expliqué avec BIEN TROP DE DÉTAILS comment mettre en place un serveur de mail Merci à mes sponsors !","inLanguage":"en","url":"https:\/\/poolp.org\/posts\/2019-12-23\/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd\/","author":{"@type":"Person","name":""},"copyrightYear":"2019","dateCreated":"2019-12-23T07:57:00\u002b02:00","datePublished":"2019-12-23T07:57:00\u002b02:00","dateModified":"2019-12-23T07:57:00\u002b02:00","mainEntityOfPage":"true","wordCount":"8539"}]</script><script src=/lib/jquery/jquery.slim.min.js integrity></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>poolp.org</span>
<img src=/img/poolp_org.png width=150 height=51 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=poolp.org></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">poolp.org</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>Blog</p></a><a href=/series/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Series>Series</p></a><a href=/categories/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Categories>Categories</p></a><a href=/tags/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Posts>Blog</p></a></li><li class=mt-1><a href=/series/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Series>Series</p></a></li><li class=mt-1><a href=/categories/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Categories>Categories</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a></li></ul><hr><ul class="flex mt-4 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li class=mb-1><a href=/categories/personal/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=personal>Personal</p></a></li><li class=mb-1><a href=/categories/technology/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=technology>Technology</p></a></li><li class=mb-1><a href class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title>Music</p></a></li></ul></div></label></div></div><div class="main-menu flex pb-3 flex-col items-end justify-between md:justify-start space-x-3" style=margin-top:-15px><div class="hidden md:flex items-center space-x-5"><a href=/categories/personal/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title=personal>Personal</p></a><a href=/categories/technology/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title=technology>Technology</p></a><a href class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title>Music</p></a></div></div></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom" style=background-image:url(/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/feature_hu91f0ddb58ed565371ed0fd41f3a129e8_60088_1200x0_resize_box_3.png)></div><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>poolp.org</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/>Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Mettre en place un serveur de mail avec OpenSMTPD, Dovecot et Rspamd</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2019-12-23 07:57:00 +0200 +0200">23 December 2019</time><span class="px-2 text-primary-500">&#183;</span><span>8539 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">41 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/poolpOrg/poolp.org/tree/master/content/posts/2019-12-23/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/technology/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">technology</span></span></span></div></div><div class=flex><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/img/gilles_hu897fc9ad11a292e594efc0b9f1eaea51_1273455_192x192_fill_q75_box_center.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://poolp.org//authors/gilles class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Gilles Chehade</a><div class="text-sm text-neutral-700 dark:text-neutral-400">I&rsquo;m not a cat.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:gilles@poolp.org target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://discord.gg/YC6j4rbvSk target=_blank aria-label=Discord rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M524.531 69.836a1.5 1.5.0 00-.764-.7A485.065 485.065.0 00404.081 32.03a1.816 1.816.0 00-1.923.91 337.461 337.461.0 00-14.9 30.6 447.848 447.848.0 00-134.426.0 309.541 309.541.0 00-15.135-30.6 1.89 1.89.0 00-1.924-.91A483.689 483.689.0 00116.085 69.137a1.712 1.712.0 00-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016.0 00.765 1.375A487.666 487.666.0 00176.02 479.918a1.9 1.9.0 002.063-.676A348.2 348.2.0 00208.12 430.4a1.86 1.86.0 00-1.019-2.588 321.173 321.173.0 01-45.868-21.853 1.885 1.885.0 01-.185-3.126c3.082-2.309 6.166-4.711 9.109-7.137a1.819 1.819.0 011.9-.256c96.229 43.917 200.41 43.917 295.5.0a1.812 1.812.0 011.924.233c2.944 2.426 6.027 4.851 9.132 7.16a1.884 1.884.0 01-.162 3.126 301.407 301.407.0 01-45.89 21.83 1.875 1.875.0 00-1 2.611 391.055 391.055.0 0030.014 48.815 1.864 1.864.0 002.063.7A486.048 486.048.0 00610.7 405.729a1.882 1.882.0 00.765-1.352C623.729 277.594 590.933 167.465 524.531 69.836zM222.491 337.58c-28.972.0-52.844-26.587-52.844-59.239S193.056 219.1 222.491 219.1c29.665.0 53.306 26.82 52.843 59.239.0 32.654-23.41 59.241-52.843 59.241zm195.38.0c-28.971.0-52.843-26.587-52.843-59.239S388.437 219.1 417.871 219.1c29.667.0 53.307 26.82 52.844 59.239.0 32.654-23.177 59.241-52.844 59.241z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/poolpOrg target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/gilleschehade target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://social.poolp.org/@gilles target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.patreon.com/gilles target=_blank aria-label=Patreon rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M512 194.8c0 101.3-82.4 183.8-183.8 183.8-101.7.0-184.4-82.4-184.4-183.8.0-101.6 82.7-184.3 184.4-184.3C429.6 10.5 512 93.2 512 194.8zM0 501.5h90v-491H0v491z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://reddit.com/user/poolpOrg target=_blank aria-label=Reddit rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/poolpOrg target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.youtube.com/gilleschehade target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#merci-à-mes-sponsors->Merci à mes sponsors !</a></li><li><a href=#où-est-ce-que-jai-déjà-lu-ça->Où est-ce que j&rsquo;ai déjà lu ça ?</a></li><li><a href=#cet-article-est-pour-les-techies-et-les-sysadmins>Cet article est pour les techies et les sysadmins</a></li><li><a href=#ehlo-hypnocat>EHLO hypno.cat</a></li><li><a href=#pré-requis>Pré-requis</a></li><li><a href=#la-stack-technique>La stack technique</a></li><li><a href=#me-rendre-accessible>Me rendre accessible</a></li><li><a href=#me-faire-bien-voir>Me faire bien voir</a></li><li><a href=#annoncer-quelles-machines-sont-autorisées-à-émettre-pour-mon-domaine>Annoncer quelles machines sont autorisées à émettre pour mon domaine</a></li><li><a href=#prouver-que-jai-autorisé-le-message-lui-même>Prouver que j&rsquo;ai autorisé le message lui même.</a></li><li><a href=#dire-aux-autres-quoi-faire-en-cas-derreurs-spf-et-dkim-avec-dmarc>Dire aux autres quoi faire en cas d&rsquo;erreurs SPF et DKIM avec DMARC</a></li><li><a href=#obtenir-un-certificat-pour-tls>Obtenir un certificat pour TLS</a></li><li><a href=#installer-et-configurer-rspamd>Installer et configurer Rspamd</a></li><li><a href=#configurer-opensmtpd>Configurer OpenSMTPD</a></li><li><a href=#quelques-mots-au-sujet-de-senderscore>Quelques mots au sujet de SenderScore</a></li><li><a href=#installer-et-configurer-dovecot>Installer et configurer Dovecot</a></li><li><a href=#apprendre-à-dovecot-à-entrainer-rspamd>Apprendre à Dovecot à entrainer Rspamd</a></li><li><a href=#tester-le-tout>Tester le tout</a></li><li><a href=#cool-on-a-fini>Cool, on a fini</a></li><li><a href=#quelle-est-la-prochaine-étape->Quelle est la prochaine étape ?</a></li><li><a href=#est-ce-quon-a-vraiment-fini->Est-ce qu&rsquo;on a vraiment fini ?</a></li></ul></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#merci-à-mes-sponsors->Merci à mes sponsors !</a></li><li><a href=#où-est-ce-que-jai-déjà-lu-ça->Où est-ce que j&rsquo;ai déjà lu ça ?</a></li><li><a href=#cet-article-est-pour-les-techies-et-les-sysadmins>Cet article est pour les techies et les sysadmins</a></li><li><a href=#ehlo-hypnocat>EHLO hypno.cat</a></li><li><a href=#pré-requis>Pré-requis</a></li><li><a href=#la-stack-technique>La stack technique</a></li><li><a href=#me-rendre-accessible>Me rendre accessible</a></li><li><a href=#me-faire-bien-voir>Me faire bien voir</a></li><li><a href=#annoncer-quelles-machines-sont-autorisées-à-émettre-pour-mon-domaine>Annoncer quelles machines sont autorisées à émettre pour mon domaine</a></li><li><a href=#prouver-que-jai-autorisé-le-message-lui-même>Prouver que j&rsquo;ai autorisé le message lui même.</a></li><li><a href=#dire-aux-autres-quoi-faire-en-cas-derreurs-spf-et-dkim-avec-dmarc>Dire aux autres quoi faire en cas d&rsquo;erreurs SPF et DKIM avec DMARC</a></li><li><a href=#obtenir-un-certificat-pour-tls>Obtenir un certificat pour TLS</a></li><li><a href=#installer-et-configurer-rspamd>Installer et configurer Rspamd</a></li><li><a href=#configurer-opensmtpd>Configurer OpenSMTPD</a></li><li><a href=#quelques-mots-au-sujet-de-senderscore>Quelques mots au sujet de SenderScore</a></li><li><a href=#installer-et-configurer-dovecot>Installer et configurer Dovecot</a></li><li><a href=#apprendre-à-dovecot-à-entrainer-rspamd>Apprendre à Dovecot à entrainer Rspamd</a></li><li><a href=#tester-le-tout>Tester le tout</a></li><li><a href=#cool-on-a-fini>Cool, on a fini</a></li><li><a href=#quelle-est-la-prochaine-étape->Quelle est la prochaine étape ?</a></li><li><a href=#est-ce-quon-a-vraiment-fini->Est-ce qu&rsquo;on a vraiment fini ?</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><pre><code>TL;DR:
- Pas de résumé, j'ai passé des heures à traduire, vous allez passer des minutes à lire ;)
- OK… J'ai expliqué avec BIEN TROP DE DÉTAILS comment mettre en place un serveur de mail
</code></pre><div id=merci-à-mes-sponsors- class=anchor></div><h2 class="relative group">Merci à mes sponsors !
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#merci-%c3%a0-mes-sponsors- aria-label=Anchor>#</a></span></h2><p>Un <strong>énorme</strong> merci aux gens qui me sponsorisent sur <a href=https://www.patreon.com/gilles target=_blank>patreon</a> ou <a href=https://github.com/sponsors/poolpOrg target=_blank>github</a>,
le temps consacré à la rédaction et traduction de cet article a été rendu possible par mon <a href=/sponsorship/>sponsorat</a>.</p><div id=où-est-ce-que-jai-déjà-lu-ça- class=anchor></div><h2 class="relative group">Où est-ce que j&rsquo;ai déjà lu ça ?
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#o%c3%b9-est-ce-que-jai-d%c3%a9j%c3%a0-lu-%c3%a7a- aria-label=Anchor>#</a></span></h2><p>En Août,
j&rsquo;ai publié un petit article intitulé &ldquo;<a href=https://poolp.org/posts/2019-08-30/you-should-not-run-your-mail-server-because-mail-is-hard/ target=_blank>
You should not run your mail server because mail is hard</a>&rdquo; (&ldquo;Vous ne devriez pas héberger votre serveur de mail parce que c&rsquo;est dur&rdquo;) qui était, en gros, mon opinion sur les différentes raisons qui poussent les gens à décourager l&rsquo;hébergement de mails.
De manière très inattendue, l&rsquo;article est devenu assez populaire, atteignant 100K lectures et continuant à recevoir des visites et des commentaires plusieurs mois après sa publication.</p><p>En Septembre, j&rsquo;ai publié un autre article beaucoup plus long intitulé &ldquo;<a href=https://poolp.org/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/ target=_blank>
Setting up a mail server with OpenSMTPD, Dovecot and Rspamd</a>&rdquo; (&ldquo;Installer un serveur de mail avec OpenSMTPD, Dovecot et Rspamd&rdquo;) qui décrivait pas à pas, de façon très détaillée, les étapes pour installer un serveur de mail complet jusqu&rsquo;à la livraison des e-mails en boîte de réception chez un gros hébergeur de mail américain.
L&rsquo;article est devenu lui aussi plutôt populaire, sans pour autant atteindre le niveau du précedent article moins technique et spécifique, mais atteignant 40K lectures et continuant également à recevoir des visites et des commentaires plusieurs mois après la publication.
<strong>Le contenu que vous vous apprêtez à lire est la traduction de cet article technique.</strong></p><p>C&rsquo;est mon second article rédigé en français depuis des années, je vous demande donc un peu d&rsquo;indulgence :
si vous trouvez des fautes, vous pouvez me les remonter pour que je les corrige, ou faire une <a href=https://github.com/poolpOrg/poolp.org/ target=_blank>pull request</a> pour les techies.</p><p><strong>Cet article est DENSE</strong> parce que je vais vous tenir la main à un niveau <strong>frisant l&rsquo;absurdité</strong> en expliquant chacune de mes actions et le pourquoi du comment.
D&rsquo;un point de vue purement technique, sans explications, l&rsquo;article pourrait probablement tenir en quelques paragraphes.</p><p>N&rsquo;hésitez pas à <strong>partager la publication</strong> à l&rsquo;aide des icones en fin d&rsquo;article et à la commenter &lt;3</p><p>Ah, et tant que je vous ai sous la main, je vous recommande chaudement la lecture de mon article non technique <a href=https://poolp.org/posts/2019-12-15/decentralisons-smtp-pour-le-bien-commun/ target=_blank>&ldquo;Décentralisons SMTP pour le bien commun&rdquo;</a> qui aborde certaines des raisons pour lesquelles il nous faut davantage de serveurs de mail.</p><p>Bonne lecture !</p><div id=cet-article-est-pour-les-techies-et-les-sysadmins class=anchor></div><h2 class="relative group">Cet article est pour les techies et les sysadmins
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cet-article-est-pour-les-techies-et-les-sysadmins aria-label=Anchor>#</a></span></h2><p>L&rsquo;auto-hébergement requiert un minimum de connaissances et de motivation.
Ce n&rsquo;est pas un truc qui se fait en deux clics, il vous faut des connaissances minimales et avoir l&rsquo;envie d&rsquo;y dédier un peu de votre temps.
Si vous n&rsquo;avez jamais touché une zone DNS ou si vous pensez que prendre une heure pour configurer quelque chose est une tâche difficile, alors autant vous prévenir de suite :
<strong>ça ne va pas être simple</strong>.
Je ne vous recommande pas vous lancer dans l&rsquo;aventure sauf si vous <strong>VOULEZ</strong> avoir à apprendre une tonne de trucs.</p><p>Si vous êtes un sysadmin familier avec le travail de sysadmin, alors la plupart de votre travail de sysadmin est déjà considérablement plus dur que mettre en place une instractructure mail.
Pour vous, <strong>le mail ne sera pas quelque chose de difficile</strong>.</p><div id=ehlo-hypnocat class=anchor></div><h2 class="relative group">EHLO hypno.cat
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ehlo-hypnocat aria-label=Anchor>#</a></span></h2><p>Pour cet article, nous mettrons en place un serveur de mail pour <a href=https://hypno.cat target=_blank>hypno.cat</a>, un petit site web pour mon (hypothétique) activité prospère d&rsquo;hypnopraticien.
J&rsquo;ai enregistré ce domaine il y a plusieurs années parce que j&rsquo;aimais bien le nom mais il n&rsquo;a jamais été utilisé pour quoi que ce soit d&rsquo;autre que l&rsquo;hébergement d&rsquo;un <strong>merveilleux</strong> fichier animé.</p><center><img src=2019-09-01-newdomain.png></center><p>Google, Bing et Yahoo le connaissent ; on ne sait pas trop comment <em>(je vais du moins faire semblant de ne pas savoir)</em> et ont indexé la page d&rsquo;accueil, du coup ils ne considèrent pas que ce domaine vient d&rsquo;être acheté par un spammer pour immédiatement envoyer du mail, mais il reste virtuellement inconnu sur internet parce qu&rsquo;il n&rsquo;a aucun contenu, ne fais aucun lien, n&rsquo;est linké depuis nul part, et n&rsquo;a jamais émis ou reçu de mail depuis ou vers personne.
C&rsquo;est un détail plutôt important qui montre que l&rsquo;âge d&rsquo;un domaine à un impact sur la réputation, mais ça reste un critère parmi d&rsquo;autres, on reparlera réputation dans un futur article.</p><p>Je vais le mettre en place au fur et à mesure que j&rsquo;écris cet article, depuis le moment où j&rsquo;ai démarré un nouveau VPS jusqu&rsquo;au moment où j&rsquo;ai pu échanger un mail dans les deux sens avec mon compte Gmail.
J&rsquo;ai choisi Gmail parce qu&rsquo;il est sur-représenté dans la population et qu&rsquo;un nombre important de personnes se sont plains de problèmes de distribution là-bas.
Très personnellement, je pense que Outlook est bien pire en terme d&rsquo;interopérabilité, mais gardons ça pour un futur article peut-être.</p><p>Les services de mail pour <a href=https://hypno.cat target=_blank>hypno.cat</a> vont fournir du mail entrant et sortant sécurisés par TLS.
Ils vont permettre de soumettre des messages depuis l&rsquo;application Gmail de mon smartphone pour ne pas changer les habitudes de mes utilisateurs.
Je pourrais tout aussi bien fournir un webmail, avec <a href=https://www.rainloop.net/ target=_blank>Rainloop</a> ou <a href=https://www.roundcube.net/ target=_blank>Roundcube</a>, ou installer un client lourd comme <a href=https://www.thunderbird.net/ target=_blank>Thunderbird</a> ou <a href=http://mutt.org target=_blank>mutt</a>.
N&rsquo;importe quel client fonctionnera ; donc je ne vais pas couvrir cette partie. Il y a de nombreuses alternatives et plusieurs articles existants sur internet pour couvrir leur mise en place.
Il y a même des techniques pour assister les clients à automatiquement découvrir leur configuration, mais tout ça reste hors du périmètre de mon article, je ne me fais pas de soucis vous allez trouver tout seul.</p><p>Mon mail sortant passera les vérifications basiques de Gmail, plus précisément SPF, DKIM et DMARC, qui sont plus que suffisant pour laisser le mail arriver en inbox.
Il est possible de faire <strong>beaucoup plus</strong>, mais le but de cet article est de trouver le bon équilibre entre faire assez de travail pour avoir bonne allure face aux autres serveurs et rester simple.</p><p>Le mail entrant sera filtré pour réduire la quantité de spam, soit en tuant les connexions de mauvais émetteurs évidents dès qu&rsquo;ils sont détectés, soit en proposant une classification du Spam dans un répertoire dédié pour éviter de saturer la boite de réception.</p><p>Je pourrais m&rsquo;arrêter là parce que c&rsquo;est déjà un setup assez intéressant, mais je vais rajouter un peu de configuration pour apprendre à Dovecot à entrainer le filtre antispam.
Il apprendra à reconnaitre le Spam lorsque je déplacerai un message dans le répertoire Spam, et à reconnaitre le mail légitime lorsque je déplacerai un message hors du répertoire Spam.
Cette partie est un peu plus complexe parce qu&rsquo;elle dépend de Sieve qui est loin d&rsquo;être un bijou d&rsquo;ingénierie.
Si vous vous moquez de l&rsquo;apprentissage, vous pouvez sauter cette partie ; j&rsquo;ai fait sans pendant plus de dix ans. C&rsquo;est un truc sympa à avoir mais loin d&rsquo;être une obligation ; c&rsquo;est juste mon petit cadeau bonus dans cet article.</p><div id=pré-requis class=anchor></div><h2 class="relative group">Pré-requis
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#pr%c3%a9-requis aria-label=Anchor>#</a></span></h2><p>Le premier pré-requis est de savoir où vous allez faire tourner votre serveur de mail.</p><p>Avec la propagation des connexions permanentes type ADSL ou FTTH (fibre), une connexion à domicile peut être tentante mais ce n&rsquo;est pas une bonne idée parce que les espaces d&rsquo;adressage IP des FAI sont souvent blacklistés, ou souffrent d&rsquo;une très mauvaise réputation de départ.
De plus, de nombreux FAI bloquent le trafic SMTP sortant pour éviter que les machines personelles compromises se transforment en bot à spam.
Pour moi, la meilleure option est de louer un serveur dédié ou un VPS depuis une société d&rsquo;hébergement après s&rsquo;être assuré que le trafic SMTP sortant est autorisé là-bas.</p><p>J&rsquo;ai loué mes serveurs dédiés chez <a href=https://www.online.net/ target=_blank>online.net</a> ces douze dernières années et je suis extrêmement satisfait.
Vous trouverez même sur ce blog <a href=https://poolp.org/posts/2018-01-29/install-openbsd-on-dedibox-with-full-disk-encryption/ target=_blank>des instructions (en anglais) pour faire tourner OpenBSD</a> sur leurs serveurs comme ce n&rsquo;est pas supporté nativement.
Ils ne filtrent pas SMTP, ce qui est bien parce que vous pouvez faire tourner un serveur de mail immédiatement, mais les adresses IP peuvent avoir été utilisées préalablement par de mauvais émetteurs et il vous faudra les tester.
Si l&rsquo;adresse IP qui vous est automatiquement allouée n&rsquo;est pas bonne, soit il va falloir bucher pour gagner en réputation, soit il vous faudra en commander une additionelle en prenant bien le soin de la choisir dans un autre range, après avoir <a href=https://mxtoolbox.com/blacklists.aspx target=_blank>vérifié qu&rsquo;elle n&rsquo;est pas dans une blacklist</a>, ou qu&rsquo;elle ne <a href=https://www.senderscore.org target=_blank>souffre pas déjà d&rsquo;une mauvaise réputation</a>.</p><p>Alternativement, pour les besoins d&rsquo;une offre commerciale que je suis en train de monter, j&rsquo;ai commencé à construire une infrastructure sur <a href="https://www.vultr.com/?ref=6831037" target=_blank>vultr.com</a> (lien de parrainage).
Je ne suis là bas que depuis quelques mois et je changerai peut-être d&rsquo;avis, mais <strong>pour l&rsquo;instant</strong> j&rsquo;en suis très satisfait.
Là-bas, SMTP est filtré par défaut et il faut ouvrir un ticket et expliquer quel est le projet pour le trafic mail.
J&rsquo;ai expliqué que je ne cherchais pas à devenir ESP et que je n&rsquo;allais pas envoyer de mail commercial de masse mais plutôt gérer de l&rsquo;hébergement ; ils ont été très serviables et m&rsquo;ont retiré le filtrage le jour même.</p><p>Peu importe où le serveur de mail sera hébergé, ce que vous devez vérifier c&rsquo;est que :</p><ul><li>l&rsquo;hébergeur n&rsquo;a pas un passif avec l&rsquo;hébergement de spammers et qu&rsquo;il autorise SMTP</li><li>vous avez une adresse IP <strong>dédiée au mail</strong></li><li>vous avez le contrôle du reverse DNS pour cette adresse IP</li><li>votre adresse IP n&rsquo;est pas déjà sur des blacklists</li></ul><p>Tant que ces pré-requis sont respectés, vous ne devriez pas avoir trop de problèmes.</p><p>Comme personne n&rsquo;aime perdre de mails, il est aussi judicieux de se <strong>préparer aux incidents</strong>.
On s&rsquo;en protège en utilisant un serveur secondaire pour prendre le trafic lorsque le primaire est down, ou pour re-router le trafic lorsque le primaire est en incapacité de router correctement.
Je ne vais pas couvrir ce sujet parce que ce n&rsquo;est pas très complexe, il s&rsquo;agit d&rsquo;installer un second serveur qui route son trafic vers le premier et de faire le bon enregistrement DNS, après avoir lu cet article vous devriez vous en sortir seul.</p><p><strong>CEPENDANT</strong>, un grand nombre de personnes ont mentionnés s&rsquo;être déjà fait blacklister et avoir perdu du mail, donc je pense que c&rsquo;est le bon moment pour donner ce conseil :
<strong>n&rsquo;hébergez pas vos différents serveurs au même endroit</strong>.
Vous ne voulez pas avoir tous vos serveurs au même endroit s&rsquo;il y a une panne de courant ou de réseau, et vous voulez aussi éviter que si votre range IP est blacklisté en dommage collatéral d&rsquo;un voisin malveillant, l&rsquo;adresse IP de votre serveur secondaire est &ldquo;<strong>suffisamment éloignée</strong>&rdquo; pour ne pas être blacklistée aussi.
De cette façon, si votre serveur primaire est en incapacité temporaire d&rsquo;émettre à cause d&rsquo;un blocage, vous pouvez re-router votre trafic au-travers de votre serveur secondaire le temps que le problème soit résolu.</p><p>J&rsquo;ai personellement eu à gérer <em>un seul</em> blocage <strong>sur mon propre setup</strong> (bien plus en dehors) durant ces dix dernières années.
C&rsquo;est un peu chiant parce que les incidents tombent toujours au mauvais moment et que ce n&rsquo;est jamais fun, mais j&rsquo;ai re-routé le trafic au-travers d&rsquo;un serveur secondaire pour le rétablir, rempli un formulaire de délistage en apportant la preuve que j&rsquo;étais un émetteur légitime, puis re-routé le trafic par mon serveur primaire une fois le problème résolu.
On est <strong>très loin du problème insurmontable</strong> qu&rsquo;en font un certain nombre de personnes.</p><p><strong>Pas de stress pour ceux qui ont un plan pour les pannes avant qu&rsquo;elles ne surviennent</strong>.</p><div id=la-stack-technique class=anchor></div><h2 class="relative group">La stack technique
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#la-stack-technique aria-label=Anchor>#</a></span></h2><p>Je vais démarrer un nouveau VPS chez <a href="https://www.vultr.com/?ref=6831037" target=_blank>vultr.com</a> (toujours un lien de parrainage), installer la dernière version d&rsquo;<a href=https://www.openbsd.org target=_blank>
OpenBSD</a>
(<a href=https://ftp.eu.openbsd.org/pub/OpenBSD/snapshots/amd64/ target=_blank>
snapshot</a>) parce que c&rsquo;est mon système de préférence (installation non couverte dans cet article), et construire mon système de mail par dessus.
Je vais partir du principe que nous sommes sous OpenBSD tout le reste de cet article, mais à l&rsquo;exception de certaines commandes spécifiques pour installer des packages, la configuration est très similaire d&rsquo;un système à un autre.
Si vous êtes assez grands pour faire tourner un serveur de mail, vous êtes assez grands pour adapter des chemins, remplacer <code>doas</code> par <code>sudo</code>, et sinon… installez OpenBSD !</p><center><img src=https://opensmtpd.org/images/opensmtpd.png></center><p>Pour la couche SMTP, qui est en charge de transférer des messages entre deux hôtes indépendemment de la manière dont les utilisateurs vont y accéder, j&rsquo;utiliserais le logiciel <a href=https://www.OpenSMTPD.org/ target=_blank>OpenSMTPD</a>.
Il s&rsquo;agit du serveur SMTP par défaut pour le système d&rsquo;exploitation OpenBSD et il y a une version portable <a href=https://github.com/OpenSMTPD/OpenSMTPD target=_blank>disponible sur Github</a> avec des instructions pour le construire. Il est également disponible dans <a href=https://repology.org/project/opensmtpd/badges target=_blank>les dépôts de packages de différents systèmes et distributions Linux</a>, peut-être tout juste à un <code>pkg</code>, un <code>rpm</code> ou un <code>apt</code> de vous.</p><p>Les instructions de cet article sont pour la <strong>version 6.6.0</strong> ou ultérieure, elles <strong>ne fonctionneront pas</strong> sur des versions précédentes.
Si votre système ne fournit pas de package à jour, vous pouvez tenter de demander au mainteneur de le mettre à jour ou alors tenter d&rsquo;en devenir mainteneur.
Il vous faudra construire le package manuellement à partir du dernier tag contenant un <code>p</code>, pour <code>portable</code>, dans son nom <a href=https://github.com/OpenSMTPD/OpenSMTPD/tags target=_blank>sur Github</a>.</p><center><img src=https://www.dovecot.org/typo3conf/ext/dvc_content/Resources/Public/Images/dovecot_logo_vector.svg></center><p>Pour la couche IMAP, qui permet aux utilisateurs de récupérer les messages qu&rsquo;ils ont reçus et y accéder depuis leurs smartphones ou webmail, j&rsquo;utiliserais la dernière version de <a href=https://www.dovecot.org target=_blank>Dovecot</a>.
J&rsquo;utiliserai également le package <code>Dovecot-Pigeonhole</code>, qui permettera d&rsquo;entraîner notre solution antispam en lui faisant apprendre ce qui est du Spam et ce qui est du Ham.
Si vous souhaitez utiliser un client console, en ssh, comme <code>mutt</code> par exemple, pas besoin de cette couche car OpenSMTPD peut distribuer dans une boite mail locale à laquelle les clients mail peuvent accéder en direct.
Dans cet article, nous configurerons IMAP parce que nous voulons que les mails puissent être consultés depuis un smartphone comme une personne lambda.</p><center><img src=https://camo.githubusercontent.com/ea57696ebeee9a4a6668347acf7ebd8ef8f74ee7/68747470733a2f2f727370616d642e636f6d2f696d672f727370616d645f6c6f676f5f626c61636b2e706e67></center><p>Enfin, pour la couche de filtrage du spam, j&rsquo;utiliserai l&rsquo;excellent <a href=https://www.rspamd.com target=_blank>Rspamd</a> qui est bien plus qu&rsquo;une <strong>simple</strong> solution antispam.
Il fournit des méthodes de filtrage moderne, mais permet également l&rsquo;intégration de filtrage antivirus, de signature DKIM, et d&rsquo;une tonne de modules que vous pouvez choisir d&rsquo;activer ou non pour régler plus finement votre setup.
Dans cet article, nous utiliserons tout simplement ses capacités de filtrage du Spam et de signature DKIM, le strict minimum dont nous avons besoin.</p><div id=me-rendre-accessible class=anchor></div><h2 class="relative group">Me rendre accessible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#me-rendre-accessible aria-label=Anchor>#</a></span></h2><p>SMTP est très étroitement lié avec DNS et les autres hôtes dépendent de recherches DNS pour trouver quelle machine gère le mail de votre domaine.
C&rsquo;est fait au-travers de la recherche d&rsquo;enregistrements MX (Mail eXchanger), donc le minimum à faire pour que SMTP fonctionne est de déclarer un enregistrement MX pour votre domaine.
Pour <code>hypno.cat</code>, la zone contiendra ce qui suit :</p><pre tabindex=0><code>;; un enregistrement A (et AAAA pour IPv6) est déclaré pour nommer le serveur de mail

mail.hypno.cat  A       217.69.8.253
mail.hypno.cat  AAAA    2001:19f0:6801:867:5400:01ff:fee7:7af7


;; un enregistrement MX est déclaré pour dire au monde que mail.hypno.cat gère le
;; mail pour hypno.cat
;; 0 est la préférence maximale, si nous avions un serveur secondaire il aurait un
;; nombre supérieur

hypno.cat.      MX 0    mail.hypno.cat.
;;hypno.cat.    MX 10   mail-backup.hypno.cat.
</code></pre><p>Je peux m&rsquo;assurer que tout est correct en utilisant <code>host</code> et <code>dig</code> pour vérifier que le nom résoud et que la recherche MX retourne bien le bon nom :</p><pre tabindex=0><code>$ host mail.hypno.cat
mail.hypno.cat has address 217.69.8.253
mail.hypno.cat has IPv6 address 2001:19f0:6801:867:5400:1ff:fee7:7af7

$ dig -t MX hypno.cat +short
0 mail.hypno.cat.
</code></pre><p>À ce stade et avec ces enregistrements DNS, les autres serveurs de mail peuvent déjà trouver quel serveur est responsable pour <code>hypno.cat</code>, et le contacter quand ils veulent envoyer du mail à n&rsquo;importe quelle adresse mail de ce domaine.</p><div id=me-faire-bien-voir class=anchor></div><h2 class="relative group">Me faire bien voir
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#me-faire-bien-voir aria-label=Anchor>#</a></span></h2><p>Être joignable n&rsquo;est pas suffisant parce qu&rsquo;aujourd&rsquo;hui, vous <strong>DEVEZ</strong> avoir un reverse DNS (rDNS) <strong>ET</strong> un Forward-Confirmed rDNS (FCrDNS).</p><p>Il y a une raison derrière cela.
Un grand nombre d&rsquo;hôtes qui émettent du spam sont des machines compromises, avec une grande portion d&rsquo;entre elles qui sont des ordinateurs personnels derrière des connexions résidentielles.
Beaucoup de ces connexions n&rsquo;ont pas de rDNS ou de FCrDNS, ou ont des rDNS qui ressemblent à des patterns d&rsquo;IP allouées dynamiquement (ex. : <code>123.123.123.123.dyn.adsl.example.com</code>).</p><p>Comme il s&rsquo;agit de machines compromises individuellement, et non de machines dont la configuration est sous le contrôle total des spammers, les rDNS et FCrDNS ne peuvent pas être configurés…
il en résulte que la configuration de rDNS et FCrDNS est devenu une preuve de travail : il faut un rDNS et un FCrDNS correctement configuré et ne ressemblant pas à une allocation dynamique.
Chez certains Big Mailer Corps, il s&rsquo;agit de règles claires, décrites dans les guidelines, pour d&rsquo;autres on le découvre par la sanction.
Dans tous les cas, il s&rsquo;agit du <strong>STRICT MINIMUM</strong> ; assurez-vous que vos noms d&rsquo;hôtes ressemblent à un <strong>VRAI</strong> nom de serveur de mail (ex. : <code>mail.hypno.cat</code>, et non pas <code>www.hypno.cat</code>).</p><p>Le rDNS est généralement hors de votre contrôle parce que dans une zone un peu spéciale, <code>arpa</code>, gérée par le propriétaire de l&rsquo;adresse IP (en général votre hébergeur).
Les FAI ne vous laissent pas toujours les configurer ; mais les hébergeurs de serveurs n&rsquo;ayant pas vraiment d&rsquo;autres choix, fournissent généralement un formulaire quelque part sur leurs espaces clients pour assigner un rDNS aux adresses qu&rsquo;ils vous ont assignées :</p><center><img src=2019-09-01-vultr-rdns.png></center><p>Si je configure mon rDNS pour avoir la même valeur que l&rsquo;enregistrement DNS configuré plus haut, alors je passe automatiquement le test du FCrDNS.
On peut le vérifier très simplement en faisant une recherche rDNS pour l&rsquo;adresse IP :</p><pre tabindex=0><code>$ host 217.69.8.253   
253.8.69.217.in-addr.arpa domain name pointer mail.hypno.cat.
$ host 2001:19f0:6801:867:5400:1ff:fee7:7af7
7.f.a.7.7.e.e.f.f.f.1.0.0.0.4.5.7.6.8.0.1.0.8.6.0.f.9.1.1.0.0.2.ip6.arpa domain name pointer mail.hypno.cat.
</code></pre><p>Puis cherchez l&rsquo;adresse IP pour ce rDNS :</p><pre tabindex=0><code>$ host mail.hypno.cat
mail.hypno.cat has address 217.69.8.253
mail.hypno.cat has IPv6 address 2001:19f0:6801:867:5400:1ff:fee7:7af7
</code></pre><p>Si les valeurs se retrouvent dans les deux sens, tout est d&rsquo;équerre.</p><div id=annoncer-quelles-machines-sont-autorisées-à-émettre-pour-mon-domaine class=anchor></div><h2 class="relative group">Annoncer quelles machines sont autorisées à émettre pour mon domaine
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#annoncer-quelles-machines-sont-autoris%c3%a9es-%c3%a0-%c3%a9mettre-pour-mon-domaine aria-label=Anchor>#</a></span></h2><p>SPF est un mécanisme qui permet pour un domaine destination de déterminer si la machine qui émet était autorisée pour le domaine émetteur.</p><p>Le mécanisme est très simple, on ajoute un enregistrement DNS à la zone de notre domaine qui déclare quels serveurs peuvent émettre.
Quand le domaine destination reçoit un mail avec un émetteur de notre domaine, il vérifie si l&rsquo;adresse IP du serveur émetteur en avait le droit.</p><p>SPF n&rsquo;est pas obligatoire pour SMTP mais c&rsquo;est une des choses qui nous font paraître légitimes face aux destinataires.
SPF est informatif par défaut ; ne pas passer un test SPF ou ne pas avoir d&rsquo;enregistrement SPF n&rsquo;implique pas qu&rsquo;un mail termine en Spam ou soit détruit.
Il est communément accepté que l&rsquo;absence d&rsquo;un enregistrement SPF a un impact très négatif sur la réputation d&rsquo;un domaine, c&rsquo;est même explicitement dit dans les guidelines de certains Big Mailer Corps, et vu comme l&rsquo;enregistrement est simple à fournir… il n&rsquo;y a vraiment aucune excuse pour ne pas le faire.</p><p>Il y a plusieurs façons de configurer SPF ; dans cet example, je vais simplement le configurer pour n&rsquo;autoriser QUE mon serveur de mail à envoyer du mail en mon nom :</p><pre tabindex=0><code>hypno.cat.      IN TXT  &#34;v=spf1 mx -all&#34;
</code></pre><p>Si des hôtes reçoivent un mail avec un émetteur <code>@hypno.cat</code> qui ne provient pas de <code>mail.hypno.cat</code>, ils pourront prendre la décision (ou non) de rejeter le mail.
Ils pourront en tout cas constater qu&rsquo;il provient d&rsquo;une machine qui n&rsquo;était pas autorisée et qu&rsquo;ils ont le droit de le rejeter.</p><div id=prouver-que-jai-autorisé-le-message-lui-même class=anchor></div><h2 class="relative group">Prouver que j&rsquo;ai autorisé le message lui même.
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#prouver-que-jai-autoris%c3%a9-le-message-lui-m%c3%aame aria-label=Anchor>#</a></span></h2><p>DKIM est un mécanisme d&rsquo;authentification par lequel on peut signer cryptographiquement les mails émis par notre serveur, prouvant qu&rsquo;on les a vu passer et que l&rsquo;on a pris la responsabilité de les laisser transiter.
Les hôtes qui recoivent ces mails peuvent vérifier qu&rsquo;ils étaient bien autorisés en vérifiant la signature, permettant ainsi de détecter des mails forgés hors du système de mail.</p><p>Comme SPF, c&rsquo;est informatif par défaut et l&rsquo;absence de signature DKIM ou une signature invalide ne veut pas dire qu&rsquo;un mail ne sera pas distribué.
En revanche, il est là aussi admis et décrit dans les guidelines que l&rsquo;absence de DKIM aura un effet sur la réputation d&rsquo;un domaine.
Et comme configurer DKIM est facile, pas vraiment d&rsquo;excuse pour ne pas le faire là non plus.</p><p>C&rsquo;est un petit peu plus complexe que pour SPF parce que, même si ça dépend aussi de DNS, il faut générer une paire de clés et publier la clé publique dans l&rsquo;enregistrement DNS.
Rien de bien foufou non plus.</p><p><strong>Nous sommes en 2019</strong>. Je vais générer une clé RSA de 1024 bits ; <strong>je sais</strong> !</p><p><strong>&mdash; BEGIN DIGRESSION &mdash;</strong></p><p>Les clés RSA 2048 bits ne rentrent pas dans un enregistrement DNS TXT et doivent être tronquées en deux enregistrements, mais tout le monde n&rsquo;est pas capable de réassocier ces clés tronquées,
et vous pouvez perdre les bénéfices de DKIM si l&rsquo;hôte destination n&rsquo;arrive pas à utiliser votre clé publique partielle et considère la signature invalide.</p><p>En ce qui me concerne, ces hôtes sont responsables et nous pouvons les ignorer ; mais comme le but de cet article est de permettre une interopérabilité maximale et que DKIM n&rsquo;est pas présent ici pour sécuriser quoi que ce soit, juste pour vous faire paraître légitime, on va juste regarder ailleurs en justifiant cette mauvaise pratique par le risque modéré de falsification de contenu quand il est utilisé conjointement à SPF.</p><p><strong>Ce n&rsquo;est pas une bonne manière de raisonner</strong> mais DKIM a d&rsquo;autres inconvénients et comme virtuellement tout le monde utilise du RSA 1024-bits. Je suggère de laisser le débat 1024 vs >= 2048 à plus tard, lors que nous aurons déjà réussis à échanger correctement avec les Big Mailer Corps.
Je prendrais juste le temps, sans pointer de doigt nul part, d&rsquo;appuyer sur le fait que certaines sociétés dans la sécurité qui travaillent dans l&rsquo;industrie du mail ont (avaient ?) encore des problèmes avec les clés 2048-bits en 2019.
Des sociétés qui calculent des scores de réputation.
Oh, la, belle, ironie !</p><p>Si c&rsquo;est un sujet d&rsquo;inquiétude pour vous, vous pouvez expérimenter la troncature des clé et voir si ça vous convient.
Adapter mon exemple est trivial ; assurez vous juste d&rsquo;avoir la clé tronquée sur deux enregistrements TXT.</p><p><strong>&mdash; END DIGRESSION &mdash;</strong></p><p>Je crée un répertoire pour contenir les clés :</p><pre tabindex=0><code># mkdir /etc/mail/dkim
</code></pre><p>Ensuite, la commande suivante va générer une paire de clé et extraire la clé publique de la clé privée:</p><pre tabindex=0><code># openssl genrsa -out /etc/mail/dkim/hypno.cat.key 1024                                       
Generating RSA private key, 1024 bit long modulus
…………………………++++++
……………++++++
e is 65537 (0x10001)

# openssl rsa -in /etc/mail/dkim/hypno.cat.key -pubout -out /etc/mail/dkim/hypno.cat.pub 
writing RSA key

# cat /etc/mail/dkim/hypno.cat.pub                                                                 
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDThHqiM610nwN1nmV8OMc7PaPO
uJWVGRDz5bWj4cRjTTmQYjJQd02xrydRNrRhjEKBm2mMDArNWjoM3jvN04ZifqJx
DmKr7X8jsYi+MPEHz6wZxB8mayDK6glYTCyx//zl1luUdvm26PutA38K8cgnb7iT
kfVP2OqK6sHAdXjnowIDAQAB
-----END PUBLIC KEY-----
</code></pre><p>Enfin, je génére un enregistrement DNS TXT en retirant le blindage de la clé publique et en formattant le contenu pour qu&rsquo;il soit comme suit :</p><pre tabindex=0><code>20190913._domainkey.hypno.cat.	IN TXT &#34;v=DKIM1;k=rsa;p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDThHqiM610nwN1nmV8OMc7PaPOuJWVGRDz5bWj4cRjTTmQYjJQd02xrydRNrRhjEKBm2mMDArNWjoM3jvN04ZifqJxDmKr7X8jsYi+MPEHz6wZxB8mayDK6glYTCyx//zl1luUdvm26PutA38K8cgnb7iTkfVP2OqK6sHAdXjnowIDAQAB;&#34;
</code></pre><p>Le nom de l&rsquo;enregistrement est construit selon le motif : <code>&lt;selector>._domainkey.&lt;domain>.</code>, où <code>&lt;selector></code> est un nom arbitraire choisi pour permettre à plusieurs clés de co-exister.
J&rsquo;aime bien utiliser la date à laquelle j&rsquo;ai généré la paire de clés, mais peu importe ce que vous choisissez, écrivez le pour plus tard car nous en aurons besoin pour configurer la signature DKIM.</p><p>De plus, la clé publique n&rsquo;a pas besoin de rester dans le répertoire une fois qu&rsquo;elle est publiée dans l&rsquo;enregistrement DNS.
Elle peut toujours être dérivée de la clé privée si nous en avons besoin, mais personnellement j&rsquo;aime bien la garder pour la retrouver rapidement.</p><p><strong>Faites bien attention</strong> à ce que la clé privée ne soit pas en lecture pour tous car, pour une raison inconnue et pas très maline, OpenSSL pense que les clés privées doivent être créées en <code>rw-r--r--</code>.</p><div id=dire-aux-autres-quoi-faire-en-cas-derreurs-spf-et-dkim-avec-dmarc class=anchor></div><h2 class="relative group">Dire aux autres quoi faire en cas d&rsquo;erreurs SPF et DKIM avec DMARC
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dire-aux-autres-quoi-faire-en-cas-derreurs-spf-et-dkim-avec-dmarc aria-label=Anchor>#</a></span></h2><p>SPF et DKIM sont tous les deux très intéressants, mais ils ne sont qu&rsquo;informatifs, alors ils n&rsquo;empêchent pas d&rsquo;abuser de votre nom de domaine.</p><p>DMARC permet de dire aux serveurs mails de destination ce que vous voulez qu&rsquo;ils fassent des mails en apparence de votre domaine qui ratent les tests SPF et DKIM.
Il permet par exemple de leur dire qu&rsquo;ils doivent rejeter ces mails.</p><p>Il n&rsquo;y a pas d&rsquo;indicateur clair : fournir une politique de rejet nous fait mieux voir que de fournir une politique sans action. Des expérimentations semblent montrer qu&rsquo;avoir un enregistrement a un impact positif par rapport à n&rsquo;en avoir aucun, même si l&rsquo;enregistrement dit que rien ne doit être fait avec les erreurs SPF et DKIM.
Il serait intéressant de mener une nouvelle expérimentation à ce sujet, mais en même temps, il est plus simple de fournir une politique de rejet et de ne pas avoir à se poser la question :-)</p><p>Le format d&rsquo;un enregistrement DMARC va bien au-delà de cet article et vous trouverez de nombreux exemples dans n&rsquo;importe quel moteur de cherche. Un enregistrement simple annoncera une politique (p=) de <code>none</code> (<code>reject</code> si vous voulez rejeter, <code>quarantine</code> si vous avez besoin de temps pour décider).
Le champ pourcentage (pct=) déclare combien de ces mails devraient être sujets à la politique DMARC, et le champ Reporting URI of Aggregates (rua=) est la destination des rapports DMARC (pour analyse avant de basculer de <code>quarantine</code> à <code>reject</code> par exemple).</p><p>Je vais ici créer un enregistrement simple, un enregistrement qui fera que les Big Mailer Corps voient que nous nous intéressons à DMARC même si nous ne savons pas encore quoi en faire :</p><pre tabindex=0><code>_dmarc.hypno.cat.   IN TXT    &#34;v=DMARC1;p=none;pct=100;rua=mailto:postmaster@hypno.cat;&#34;
</code></pre><p>Mon opinion est qu&rsquo;il est préférable de basculer rapidement vers <code>p=reject</code>, après s&rsquo;être assuré que les mails sont correctement signés et que seul notre serveur de mail les émet.</p><div id=obtenir-un-certificat-pour-tls class=anchor></div><h2 class="relative group">Obtenir un certificat pour TLS
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#obtenir-un-certificat-pour-tls aria-label=Anchor>#</a></span></h2><p>Il y a plusieurs façons d&rsquo;obtenir un certificat TLS.
Je vais partir du principe que vous êtes familiers avec l&rsquo;hébergement d&rsquo;autres services et que vous êtes capable d&rsquo;en obtenir un par votre registrar ou depuis <a href=https://letsencrypt.org target=_blank>letsencrypt</a>.
Si ce n&rsquo;est pas le cas, vous trouverez des exemples à foison sur n&rsquo;importe quel moteur de recherche.</p><p><strong>Si vous savez gérer vos certificats, vous pouvez sauter à la section suivante.</strong></p><p>Comme je suis réellement en train de mettre en place <code>mail.hypno.cat</code>, je ne serais pas en mesure de continuer cet article sans obtenir de certificat, donc en bonus pour les utilisateurs d&rsquo;OpenBSD, je vais documenter la génération de mon certificat sur ma nouvelle installation.</p><p><code>acme-client</code> est un utilitaire présent dans le système de base et qui permet de demander ou renouveller des certificats depuis la console.
Il dépend d&rsquo;un challenge HTTP ; il doit donc être en mesure d&rsquo;écrire dans un répertoire qui soit accessible par HTTP.
Et comme nous sommes chanceux…
OpenBSD contient un serveur <code>httpd</code> que l&rsquo;on peut utiliser pour ce challenge.
Et comme nous sommmes <strong>TRÈS</strong> chanceux…
OpenBSD fournit aussi un exemple de fichier de configuration que l&rsquo;on peut utiliser sans gros changement.</p><p>On copie simplement le fichier d&rsquo;example depuis <code>/etc/example/httpd.conf</code> vers <code>/etc/httpd.conf</code>, en remplaçant <code>example.com</code> par <code>mail.hypno.cat</code> et en supprimant le bloc TLS puisque seul le challenge nous interesse.
Le fichier doit ressembler à cela :</p><pre tabindex=0><code>server &#34;mail.hypno.cat&#34; {
        listen on * port 80
        location &#34;/.well-known/acme-challenge/*&#34; {
                root &#34;/acme&#34;
                request strip 2
        }
        location * {
                block return 302 &#34;https://$HTTP_HOST$REQUEST_URI&#34;
        }
}
</code></pre><p>Le daemon <code>httpd</code> peut être démarré comme suit :</p><pre tabindex=0><code># rcctl -f start httpd
httpd(ok)
</code></pre><p>En ce qui concerne <code>acme-client</code>, c&rsquo;est très simple, on copie à nouveau le fichier d&rsquo;exemple depuis <code>/etc/example/acme-client.conf</code> vers <code>/etc/acme-client.conf</code>,
en remplaçant <code>example.com</code> par <code>mail.hypno.cat</code> et on doit se retrouver avec un bloc comme suit :</p><pre tabindex=0><code>domain mail.hypno.cat {
        domain key &#34;/etc/ssl/private/mail.hypno.cat.key&#34;
        domain full chain certificate &#34;/etc/ssl/mail.hypno.cat.fullchain.pem&#34;
        sign with letsencrypt
}
</code></pre><p>À ce stade, on se contente de lancer <code>acme-client</code> pour notre domaine :</p><pre tabindex=0><code># acme-client -v mail.hypno.cat
[…]
acme-client: /etc/ssl/mail.hypno.cat.fullchain.pem: created
</code></pre><p>Le certificat et les clés sont créés au bon endroit, il suffira par la suite d&rsquo;ajouter les chemins dans OpenSMTPD et Dovecot.</p><p>Vous pouvez garder <code>httpd</code> en marche pour les renouvellements et appeller <code>acme-client</code> depuis un cron, vous pouvez l&rsquo;éteindre et renouveller d&rsquo;une autre façon.
Je vous laisse vous débrouiller ; vous trouverez comment faire avec l&rsquo;aide de la page de manuel <code>acme-client(1)</code>.</p><div id=installer-et-configurer-rspamd class=anchor></div><h2 class="relative group">Installer et configurer Rspamd
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#installer-et-configurer-rspamd aria-label=Anchor>#</a></span></h2><p>Sur OpenBSD, Rspamd est packagé et peut être installé d&rsquo;une simple commande.
Nous avons aussi besoin d&rsquo;installer Redis qui sert à stocker des statistiques pour Rspamd et son greylisting (entre autres), et également <code>filter-rspamd</code> qui est un petit bout de code qui permets à OpenSMTPD de travailler avec Rspamd.
Ils existent également sous forme de packages et peuvent être installés en une seule commande.</p><p>Tout d&rsquo;abord, on installe les packages :</p><pre tabindex=0><code>mail$ doas pkg_add redis rspamd opensmtpd-filter-rspamd
[…]
redis-4.0.14: ok
rspamd-1.9.0: ok
opensmtpd-filter-rspamd-0.1.1: ok
The following new rcscripts were installed: /etc/rc.d/redis /etc/rc.d/rspamd
See rcctl(8) for details.
</code></pre><p>Rspamd est très configurable, si vous voulez faire des choses un peu funky je vous laisse <a href=https://rspamd.com/doc/configuration/ target=_blank>lire la documentation</a>.
Pour cet article je me contenterai d&rsquo;une utilisation très basique, comme c&rsquo;est le cas sur mes propres machines :</p><p>Je pourrais éditer la configuration dans <code>/etc/rspamd/actions.conf</code> pour ajuster les seuils de mise en spam, mais les valeurs par défaut me conviennent alors je vous les montre juste :</p><pre tabindex=0><code>actions {
    reject = 15;    # Reject when reaching this score
    add_header = 6; # Add header when reaching this score
    greylist = 4;   # Apply greylisting when reaching this score (will emit `soft reject action`)
    […]
</code></pre><p>Mais ce que <strong>je veux vraiment</strong> c&rsquo;est que Rspamd gère la signature DKIM parce que c&rsquo;est un des pré-requis pour paraître légitime.</p><p>On le fait en fournissant une configuration dans <code>/etc/rspamd/local.d/dkim_signing.conf</code> pour faire correspondre à notre domaine la clé DKIM générée plus tôt :</p><pre tabindex=0><code># mkdir /etc/rspamd/local.d
# cat &lt;&lt; EOF &gt;/etc/rspamd/local.d/dkim_signing.conf
allow_username_mismatch = true;

domain {
    hypno.cat {
        path = &#34;/etc/mail/dkim/hypno.cat.key&#34;;
        selector = &#34;20190913&#34;;
    }
}
EOF
</code></pre><p>La clé de configuration <code>allow_username_mismatch</code> est nécessaire parce que Rspamd attend des utilisateurs avec des noms de domaines, mais <strong>dans cette configuration</strong> OpenSMTPD authentifie de simples utilisateurs système.
De plus, faites attention à ce que le fichier contenant la clé DKIM soit autorisé en lecture au groupe <code>_rspamd</code>.</p><p>À ce stade on est bon, Rspamd et Redis peuvent être activés pour qu&rsquo;OpenBSD les démarre à chaque reboot :</p><pre tabindex=0><code># rcctl enable redis
# rcctl enable rspamd
</code></pre><p>Et on peut les démarrer immédiatement pour ne pas avoir à attendre le prochain reboot :</p><pre tabindex=0><code># rcctl start redis
redis(ok)
# rcctl start rspamd
rspamd(ok)
</code></pre><div id=configurer-opensmtpd class=anchor></div><h2 class="relative group">Configurer OpenSMTPD
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#configurer-opensmtpd aria-label=Anchor>#</a></span></h2><p>OpenSMTPD est installé par défaut sur OpenBSD donc aucune phase d&rsquo;installation ici.
Si vous utilisez un système d&rsquo;exploitation différent, soit quelqu&rsquo;un l&rsquo;a packagé et vous pouvez l&rsquo;installer avec votre gestionnaire de paquets, ou vous pouvez le construire depuis les sources et l&rsquo;installer en utilisant le code depuis le <a href=https://github.com/OpenSMTPD/OpenSMTPD target=_blank>mirroir Github</a> et en suivant les instructions de build.</p><p>Comme écrit plus haut, <strong>ces instructions ne sont valides que pour la version 6.6.0 et ultérieures</strong>, les versions précédentes ne supportent pas les filtres et certaines des fonctionnalités décrites ici.</p><p>La configuration par défault d&rsquo;OpenSMTPD est adaptée à un serveur de mail local, n&rsquo;acceptant pas de connexions de l&rsquo;extérieur, mais capable de laisser les utilisateurs locaux s&rsquo;échanger des messages et en émettre vers des hôtes distants.</p><p>Elle ressemble à ce qui suit :</p><pre tabindex=0><code>#       $OpenBSD: smtpd.conf,v 1.11 2018/06/04 21:10:58 jmc Exp $

# This is the smtpd server system-wide configuration file.
# See smtpd.conf(5) for more information.

table aliases file:/etc/mail/aliases

# To accept external mail, replace with: listen on all
#
listen on lo0

action &#34;local_mail&#34; mbox alias &lt;aliases&gt;
action &#34;outbound&#34; relay

# Uncomment the following to accept external mail for domain &#34;example.org&#34;
#
# match from any for domain &#34;example.org&#34; action &#34;local_mail&#34;
match from local for local action &#34;local_mail&#34;
match from local for any action &#34;outbound&#34;
</code></pre><p>Je voulais initialement mettre à jour la configuration progressivement pour vous tenir par la main, mais cet article à énormément grossi depuis sa première version.
Par souci de simplicité, je vais simplement mettre les 16 lignes de configuration et les commenter ensuite :</p><pre tabindex=0><code>pki mail.hypno.cat cert &#34;/etc/ssl/mail.hypno.cat.fullchain.pem&#34;
pki mail.hypno.cat key &#34;/etc/ssl/private/mail.hypno.cat.key&#34;

filter check_dyndns phase connect match rdns regex { &#39;.*\.dyn\..*&#39;, &#39;.*\.dsl\..*&#39; } \
    disconnect &#34;550 no residential connections&#34;

filter check_rdns phase connect match !rdns \
    disconnect &#34;550 no rDNS is so 80s&#34;

filter check_fcrdns phase connect match !fcrdns \
    disconnect &#34;550 no FCrDNS is so 80s&#34;

filter senderscore \
    proc-exec &#34;filter-senderscore -blockBelow 10 -junkBelow 70 -slowFactor 5000&#34;

filter rspamd proc-exec &#34;filter-rspamd&#34;

table aliases file:/etc/mail/aliases

listen on all tls pki mail.hypno.cat \
    filter { check_dyndns, check_rdns, check_fcrdns, senderscore, rspamd }

listen on all port submission tls-require pki mail.hypno.cat auth filter rspamd

action &#34;local_mail&#34; maildir junk alias &lt;aliases&gt;
action &#34;outbound&#34; relay helo mail.hypno.cat

match from any for domain &#34;hypno.cat&#34; action &#34;local_mail&#34;
match from local for local action &#34;local_mail&#34;

match from any auth for any action &#34;outbound&#34;
match from local for any action &#34;outbound&#34;
</code></pre><p>C&rsquo;est tout ce dont nous avons besoin pour notre configuration SMTP complète.</p><p>Les deux premières lignes <code>pki</code> déclarent que <code>mail.hypno.cat</code> utilisera le certificat et la clé que nous avons générés plus tôt pour TLS.</p><p>Les lignes <code>filter</code> appliquent un ensemble de filtres sur les connexions entrantes. <code>check_dyndns</code> filtrera si rDNS corresponds à certains motifs. <code>check_rdns</code> filtrera s&rsquo;il n&rsquo;y a pas de rDNS.
<code>check_fcrdns</code> filtrera si la correspondance FCrDNS échoue.
Il s&rsquo;agit de filtres &ldquo;internes&rdquo; à OpenSMTPD que vous pouvez ajuster pour filtrer différement, à d&rsquo;autres phases ou avec d&rsquo;autres critères.</p><p><code>senderscore</code> est un filtre custom que vous pouvez installer soit depuis votre gestionnaire de paquets (<code>pkg_add opensmtpd-filter-senderscore</code> sur OpenBSD), ou obtenir depuis <a href=https://github.com/poolpOrg/filter-senderscore target=_blank>Github</a>.
Il n&rsquo;est pas obligatoire mais je le trouve particulièrement utile et expliquerai pourquoi dans la prochaine section.
Dans cette configuration, il rejettera un émetteur si son senderscore est en dessous de 10, il <code>junk</code>-era le message (ajoutera un entête <code>X-Spam</code> si le score est inférieur à 70), et pour mon plaisir personnel, ajoutera avant chaque réponse un délai inversement proportionnel à la réputation de l&rsquo;émetteur pour ralentir les mauvais émetteurs.</p><p><code>rspamd</code> est également un filtre custom que nous avons installé dans la précedente section.
Il n&rsquo;y a aucune configuration car il est entièrement controlé depuis Rspamd, il suffit donc de le déclarer.</p><p>Si vous voulez être plus conservateur et ne pas rejeter les mail pour éviter des faux positifs, vous pouvez assigner l&rsquo;action <code>junk</code> plutôt que <code>disconnect</code> aux filtres internes et supprimer l&rsquo;option <code>-blockBelow</code> au filtre <code>senderscore</code> :</p><pre tabindex=0><code>filter check_dyndns phase connect match rdns regex { &#39;.*\.dyn\..*&#39;, &#39;.*\.dsl\..*&#39; } junk
filter check_rdns phase connect match !rdns junk
filter check_fcrdns phase connect match !fcrdns junk
filter senderscore proc-exec &#34;filter-senderscore -junkBelow 70 -slowFactor 5000&#34;
</code></pre><p>De cette façon, au lieu de rejeter les sessions, OpenSMTPD va simplement junk les messages pour les faire atterrir en boite à Spam.
En regardant régulièrement ce qui atterri dans cette boite, vous pourrez gagner en confiance et adapter vos réglages pour trouver ceux qui vous conviennent.</p><p>Ces filtres simples, sans même compter <code>rspamd</code>, sont suffisants pour tuer la plus grosse partie du spam.
Chez moi, ils permettent de passer de <em>plusieurs centaines</em> de spam quotidiens à une poignée.
Le filtre <code>rdns regex</code> doit être adapté en fonction du pays, vous pouvez trouver des motifs qui sont récurrents chez vous et n&rsquo;apparaissent jamais chez moi.
Pour faciliter la maintenance, ils peuvent être stockés dans un fichier à raison d&rsquo;un par ligne, en respectant la construction suivante :</p><pre tabindex=0><code>table &lt;dyndns&gt; file:/etc/mail/path-to-my-regex-file
filter check_dyndns phase connect match rdns regex &lt;dyndns&gt; junk
</code></pre><p>Continuons à disséquer la configuration.</p><p>La table <code>aliases</code> pointe vers un fichier d&rsquo;alias sur deux colonnes.
La colonne de gauche correspond à la partie utilisateur d&rsquo;une adresse e-mail que vous recevez ; la colonne de droite correspond à l&rsquo;utilisateur à qui le mail doit être livré (ex. : <code>root: gilles</code>).
Il est recommandé d&rsquo;aliaser les adresses <code>root</code>, <code>abuse</code> et <code>postmaster</code> vers une adresse que vous lisez réellement.
Je ne le fais pas ici parce que je vais simplement détruire le setup une fois l&rsquo;article fini, mais en ce qui vous concerne, faites le !</p><p>Ensuite viennent les lignes <code>listen</code>.
La première est le point d&rsquo;attache que vont contacter les autres serveurs de mail qui souhaitent envoyer du mail vers <code>hypno.cat</code>. Elle est configurée pour offrir <code>tls</code> en utilisant les certificats et clés pour <code>mail.hypno.cat</code> et pour filtrer les sessions entrantes avec mes filtres.
La seconde est le point d&rsquo;attache que vont contacter mes propres utilisateurs sur le port de <code>submission</code>, qui requiert TLS en utilisant les mêmes certificats et clés, mais également l&rsquo;authentification des utilisateurs système locaux (le défaut peut être changé), et filtrant à-travers le filtre rspamd uniquement dans le but de faire la signature DKIM de nos messages.</p><p>Les lignes <code>action</code> définissent les actions à entreprendre avec les mails qui sont acceptés dans le système.
Une action locale permet de distribuer dans une maildir, en classifiant les spams dans un répertoire spécifique, et en résolvant les alias.
Une seconde action permets de relayer les mails en s&rsquo;annonçant en tant que <code>mail.hypno.cat</code> aux autres hôtes.
Si le serveur disposait de plusieurs adresses IP, il serait possible d&rsquo;assigner à l&rsquo;aide de l&rsquo;option <code>src</code> celle à utiliser, mais ici je n&rsquo;ai qu&rsquo;une seule adresse IP donc pas besoin de la spécifier.</p><p>Enfin, les lignes <code>match</code> représentent l&rsquo;ensemble des règles.
Quand une enveloppe entre dans le serveur SMTP au travers d&rsquo;un des points d&rsquo;attache <code>listen</code>, elle est comparée séquentiellement à chaque ligne <code>match</code> jusqu&rsquo;à trouver une correspondance ou rejetée si aucune correspondance n&rsquo;est trouvée.
Lorsqu&rsquo;une correspondance est trouvée, l&rsquo;action associée à la règle est prise en compte.
Les règles de match sont très simples à comprendre, je ne vais donc pas les expliquer ; vous devriez arriver à comprendre seuls ce que signifie <code>from any for domain "hypno.cat"</code>, sans quoi vous ne devriez pas lire cet article en premier lieu.</p><div id=quelques-mots-au-sujet-de-senderscore class=anchor></div><h2 class="relative group">Quelques mots au sujet de SenderScore
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#quelques-mots-au-sujet-de-senderscore aria-label=Anchor>#</a></span></h2><p>SenderScore est une base de donnée de réputation IP qui associe un score entre 0 et 100 à une adresse IP.
Le score est lié au volume et comportement observé depuis ces adresses IP, et même si l&rsquo;on ne sait pas COMMENT sont calculés ces scores parce que la méthodologie n&rsquo;est pas publique,
un peu d&rsquo;étude permet de confirmer que ces nombres ne sortent pas de nul part : ils sont corrélés au ratio de distribution et d&rsquo;erreur chez différents Big Mailer Corps et il est possible d&rsquo;influencer le score en changeant de comportement.</p><p>Il est également <strong>TRÈS</strong> clair que pour construire les scores de réputation, ils ont accès à des informations relatives aux sessions SMTP dont seuls les serveurs mails de destinations peuvent disposer, comme le volume de mails ou le ratio de destinataires acceptés et refusés, observés depuis une adresse, impliquant que ces informations sont obtenues directement depuis les Big Mailer Corps.
Faites ce que vous voulez de cela.</p><p>En me basant sur <strong><em>MA</em></strong> compréhension, il s&rsquo;agit d&rsquo;un indicateur intéressant pour limiter la quantité de spam qui vous atteint.
Je ne fait pas confiance à cet indicateur concernant les bons scores (parce que je sais à peu près contourner) mais j&rsquo;y fais ÉNORMÉMENT confiance en ce qui concerne les mauvais scores, parce qu&rsquo;il faut vraiment faire un paquet de mauvaises choses en gros volume pour que le score se dégrade.
Si vous ne faites pas de mailing en masse, vous êtes censés être soit inconnu de cette base de donnée ou avoir un score supérieur à 95, sinon il y a quelque chose qui déconne chez vous.</p><p>Tout le monde n&rsquo;est pas convaincu par SenderScore et certains experts en déliverabilité disent que c&rsquo;est du pipeau.
J&rsquo;ai personnellement fait tourner une expérimentation sur plusieurs mois en graphant volume et réputation quotidienne, en comparant aux graphs de distribution. Mon opinion est contraire :
il y a une correlation très significative qui permet clairement de classifier les émetteurs.
Je pense que la meilleure approche est d&rsquo;utiliser le filtre pour junker, et non bloquer, pour déterminer par vous même si vous en êtes satisfait.</p><p>SenderScore considère que les émetteurs devraient avoir une réputation supérieure à 70. Je pense pour ma part que les hôtes avec un score inférieur à 70 sont de bons candidats au junk, les hôtes avec un score inférieur à 10 sont des rejets évidents.</p><div id=installer-et-configurer-dovecot class=anchor></div><h2 class="relative group">Installer et configurer Dovecot
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#installer-et-configurer-dovecot aria-label=Anchor>#</a></span></h2><p>OpenBSD dispose d&rsquo;un paquet pour Dovecot qui peut être installé d&rsquo;une simple commande :</p><pre tabindex=0><code>mail# pkg_add dovecot
dovecot-2.3.7.2v0: ok
The following new rcscripts were installed: /etc/rc.d/dovecot
See rcctl(8) for details.
New and changed readme(s):
        /usr/local/share/doc/pkg-readmes/dovecot
[…]
</code></pre><p>Et, <strong>specifiquement pour OpenBSD</strong>, en suivant les instructions du fichier readme, le fichier <code>/etc/login.conf</code> devrait contenir une classe <code>dovecot</code> pour augmenter les ressources autorisées à Dovecot, gourmand en descripteurs de fichiers :</p><pre tabindex=0><code>dovecot:\
    :openfiles-cur=1024:\
    :openfiles-max=2048:\
    :tc=daemon:
</code></pre><p>Cela fait, il n&rsquo;y a plus grand chose à faire à part pointer Dovecot sur le certificat et la clé TLS générés plus tôt.
On le fait en modifiant les clés de configuration <code>ssl_cert</code> et <code>ssl_key</code> dans le fichier <code>/etc/dovecot/conf.d/10-ssl.conf</code> pour qu&rsquo;elles soient comme suit :</p><pre tabindex=0><code>ssl_cert = &lt;/etc/ssl/mail.hypno.cat.fullchain.pem
ssl_key = &lt;/etc/ssl/private/mail.hypno.cat.key
</code></pre><p>Puis dire à Dovecot que les mails sont livrés dans le répertoire <code>~/Maildir</code> de chaque utilisateur puisque c&rsquo;est là que OpenSMTPD les déposera.
On le fait en modifiant la clé de configuration <code>mail_location</code> dans le fichier <code>/etc/dovecot/conf.d/10-mail.conf</code> pour qu&rsquo;elle soit comme suit :</p><pre tabindex=0><code>mail_location = maildir:~/Maildir
</code></pre><p>On est bon.</p><p>Le daemon peut être activé pour être démarré à chaque reboot, puis démarré immédiatement :</p><pre tabindex=0><code>mail# rcctl enable dovecot
mail# rcctl start dovecot   
dovecot(ok)
</code></pre><p>À ce stade, il est possible de configurer n&rsquo;importe quel client mail comme <code>mutt</code>, <code>thunderbird</code> ou même l&rsquo;application <code>gmail</code> sur Android, et utiliser <code>mail.hypno.cat</code> pour les mails entrants et sortants.</p><center><img src=2019-09-01-smartphone.png></center><div id=apprendre-à-dovecot-à-entrainer-rspamd class=anchor></div><h2 class="relative group">Apprendre à Dovecot à entrainer Rspamd
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#apprendre-%c3%a0-dovecot-%c3%a0-entrainer-rspamd aria-label=Anchor>#</a></span></h2><p>Vous avez lu jusqu&rsquo;ici ? bien.</p><p>Cette section est une section bonus, elle n&rsquo;est absolument pas nécessaire pour configurer votre serveur de mail, mais c&rsquo;est un élément que j&rsquo;aime ajouter parce qu&rsquo;il permet aux utilisateurs d&rsquo;entrainer le filtre antispam d&rsquo;une manière à laquelle ils sont habitués :
en déplaçant un mail vers la boite à Spam, ou en appuyant sur un bouton &ldquo;signaler un Spam&rdquo;, &ldquo;marquer comme Spam&rdquo; ou peu importe comment il s&rsquo;appelle dans l&rsquo;interface utilisée. Le bon côté est que cet élément de configuration s&rsquo;intègre avec IMAP, donc peu importe comment les mails sont consultés et depuis quel logiciel, l&rsquo;action de marquer un mail comme Spam entraînera automatiquement le filtre.</p><p>C&rsquo;est très simple en théorie : il suffit de brancher deux scripts, l&rsquo;un qui gère le déplacement dans la boite à Spam, l&rsquo;autre qui gère le déplacement hors de la boite à Spam.
Les Big Mailer Corps utilisent des stratégies plus poussées en détectant les mails non ouverts, ceux déplacés directement en poubelle, etc…
mais débutons simple, il est toujours possible d&rsquo;étendre ensuite.</p><p>Pour faire ce branchement, nous dépendont de Sieve qui est…
comment dire avec diplomatie…
un peu sur-conçu.</p><p><strong>Ce n&rsquo;est pas un élément critique du setup, vous êtes autorisés à éteindre vos cerveaux et suivre les instructions aveuglément.</strong>
<strong>Le pire qui puisse arriver ici est que l&rsquo;entraînement de la détection ne marche pas.</strong></p><p>Pour activer imap sieve, le package Pigeonhole doit être installé, encore une fois à l&rsquo;aide d&rsquo;une simple commande :</p><pre tabindex=0><code>mail# pkg_add dovecot-pigeonhole
dovecot-pigeonhole-0.5.7.2v1: ok

[…]
</code></pre><p>Et… voici la partie la plus complexe, il faut configurer Dovecot pour activer <code>imap_sieve</code> et lui apprendre quels scripts utiliser pour quelles actions.</p><p>D&rsquo;abord, on active <code>imap_sieve</code> dans Dovecot en l&rsquo;ajoutant dans la liste des plugins mails pour IMAP.
C&rsquo;est fait en mofifiant la clé de configuration <code>mail_plugins</code> dans le fichier <code>/etc/dovecot/conf.d/20-imap.conf</code> :</p><pre tabindex=0><code>protocol imap {
    […]

    mail_plugins = $mail_plugins imap_sieve
 
    […]
}
</code></pre><p>Ensuite pour apprendre à Dovecot à entrainer Rspamd, on ajoute la section suivante dans le fichier <code>/etc/dovecot/conf.d/90-plugin.conf</code>, pour dire quel script sieve déclencher quand un mail est déplacé vers ou hors du répertoire Junk :</p><pre tabindex=0><code>plugin {
  sieve_plugins = sieve_imapsieve sieve_extprograms
  sieve_global_extensions = +vnd.dovecot.pipe +vnd.dovecot.environment

  imapsieve_mailbox1_name = Junk
  imapsieve_mailbox1_causes = COPY APPEND
  imapsieve_mailbox1_before = file:/usr/local/lib/dovecot/sieve/report-spam.sieve

  imapsieve_mailbox2_name = *
  imapsieve_mailbox2_from = Junk
  imapsieve_mailbox2_causes = COPY
  imapsieve_mailbox2_before = file:/usr/local/lib/dovecot/sieve/report-ham.sieve

  imapsieve_mailbox3_name = Inbox
  imapsieve_mailbox3_causes = APPEND
  imapsieve_mailbox3_before = file:/usr/local/lib/dovecot/sieve/report-ham.sieve

  sieve_pipe_bin_dir = /usr/local/lib/dovecot/sieve
}
</code></pre><p>Maintenant que Dovecot est prêt, on prépare la partie Sieve qui dépend de deux scripts pour entraîner le Spam et le Ham dans <code>/usr/local/lib/dovecot/sieve</code> :</p><pre tabindex=0><code># cat report-ham.sieve

require [&#34;vnd.dovecot.pipe&#34;, &#34;copy&#34;, &#34;imapsieve&#34;, &#34;environment&#34;, &#34;variables&#34;];

if environment :matches &#34;imap.mailbox&#34; &#34;*&#34; {
  set &#34;mailbox&#34; &#34;${1}&#34;;
}

if string &#34;${mailbox}&#34; &#34;Trash&#34; {
  stop;
}

if environment :matches &#34;imap.user&#34; &#34;*&#34; {
  set &#34;username&#34; &#34;${1}&#34;;
}

pipe :copy &#34;sa-learn-ham.sh&#34; [ &#34;${username}&#34; ];
</code></pre><pre tabindex=0><code># cat report-spam.sieve

require [&#34;vnd.dovecot.pipe&#34;, &#34;copy&#34;, &#34;imapsieve&#34;, &#34;environment&#34;, &#34;variables&#34;];

if environment :matches &#34;imap.user&#34; &#34;*&#34; {
  set &#34;username&#34; &#34;${1}&#34;;
}

pipe :copy &#34;sa-learn-spam.sh&#34; [ &#34;${username}&#34; ];
</code></pre><p>Et parce que les deux scripts Sieve dépendent de scripts shell <code>sa-learn-ham.sh</code> et <code>sa-learn-spam.sh</code>, on crée aussi ces deux scripts shell dans <code>/usr/local/lib/dovecot/sieve</code> :</p><pre tabindex=0><code># cat sa-learn-ham.sh

#!/bin/sh
exec /usr/local/bin/rspamc -d &#34;${1}&#34; learn_ham
</code></pre><pre tabindex=0><code># cat sa-learn-spam.sh

#!/bin/sh
exec /usr/local/bin/rspamc -d &#34;${1}&#34; learn_spam
</code></pre><p>Enfin, on compile les scripts Sieve et on rend les scripts shell exécutables pour que Dovecot puisse les utiliser :</p><pre tabindex=0><code># sievec report-ham.sieve
# sievec report-spam.sieve
# chmod 755 sa-learn-ham.sh
# chmod 755 sa-learn-spam.sh
</code></pre><p>C&rsquo;est tout. Dorénavant en déplaçant un mail d&rsquo;un répertoire à un autre, on doit voir les lignes suivantes dans le fichier de log <code>/var/log/rspamd/rspamd.log</code> :</p><pre tabindex=0><code>2019-09-13 23:59:46 #18598(controller) &lt;1d44bd&gt;; csession; rspamd_controller_learn_fin_task: &lt;127.0.0.1&gt; learned message as ham: CAHPtQbOxQxBCsVd7nUCP4podu74Pa-F6k28z+4BWfNeeqWYiAg@mail.gmail.com
[…]
2019-09-14 00:01:57 #18598(controller) &lt;b76e28&gt;; csession; rspamd_controller_learn_fin_task: &lt;127.0.0.1&gt; learned message as spam: CAHPtQbOxQxBCsVd7nUCP4podu74Pa-F6k28z+4BWfNeeqWYiAg@mail.gmail.com
[…]
</code></pre><p>Il est surement possible de simplifier, je vais être honnête et dire que mon intérêt pour Sieve n&rsquo;est pas assez poussé pour que je me perfectionne.
C&rsquo;est une fonctionnalité sur le côté et je ne toucherai probablement pas les scripts avant les dix prochaines années.
Je ne suis pas du tout convaincu par Sieve et quand j&rsquo;aurai le temps, je ferais une alternative qui ne me rappelle pas les années m4 de Sendmail.</p><div id=tester-le-tout class=anchor></div><h2 class="relative group">Tester le tout
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tester-le-tout aria-label=Anchor>#</a></span></h2><p>Et maintenant, on va juste tester que l&rsquo;on arrive à faire un trajet complet aller-retour de mail depuis <code>hypno.cat</code> vers <code>gmail.com</code>.</p><p>Tout d&rsquo;abord, je prépare un mail depuis mon compte <code>hypno.cat</code> vers mon compte <code>gmail.com</code> :</p><center><img src=2019-09-01-craft-mail.png></center><p>Après envoi, je vérifie qu&rsquo;il arrive bien chez <code>gmail.com</code> :</p><center><img src=2019-09-01-gmail-1.png></center><p>Ensuite, je vérifie que l&rsquo;émission a bien eu lieu par dessus un canal sécurisé par TLS :</p><center><img src=2019-09-01-gmail-2.png></center><p>Je vérifie également que <code>gmail.com</code> est content avec notre déclaration SPF, notre signature DKIM et qu&rsquo;il a bien vu notre enregistrement DMARC.
On fait cela en sélectionnant &ldquo;Voir l&rsquo;original&rdquo; dans le menu associé à chaque mail :</p><center><img src=2019-09-01-gmail-3.png></center><p>Enfin, j&rsquo;y répond pour être sur que ça fonctionne dans les deux sens :</p><center><img src=2019-09-01-received-mail.png></center><div id=cool-on-a-fini class=anchor></div><h2 class="relative group">Cool, on a fini
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cool-on-a-fini aria-label=Anchor>#</a></span></h2><p>Cet article est dense, je voulais <em>expliquer</em> pourquoi on fait les choses. Si vous retirez toutes les explications et gardez juste les détails purement techniques, vous réaliserez que nous avons construit une infrastructure de mail, fournissant des services entrants et sortants sécurisés par TLS, avec un trafic sortant respectant DKIM, SPF et DMARC, et un trafic entrant filtrant le spam.</p><p>On a fait cela en :</p><ul><li>ajoutant deux enregistrements A, un MX et trois TXT dans notre zone DNS;</li><li>faisant attention à avoir un rDNS correctement configuré</li><li>installant un certificat TLS</li><li>préparant un fichier de configuration d&rsquo;environ 15 lignes pour un serveur SMTP</li><li>modifiant 3 lignes dans la configuration par défaut d&rsquo;un serveur IMAP</li><li>modifiant 8 lignes dans la configuration par défaut d&rsquo;une solution antispam</li></ul><p>Et parce que nous étions de tres bonne humeur et volontaires pour faire un petit pas de plus, nous avons implémenté un apprentissage Spam / Ham de Rspamd en :</p><ul><li>modifiant environ 20 lignes dans la configuration par défaut d&rsquo;un serveur IMAP</li><li>copiant 4 scripts Sieve dans un répertoire</li></ul><p>On admettra qu&rsquo;un nouvel arrivant va devoir fournir quelques efforts pour trouver tout ça sans aide, mais aucune de ces tâches n&rsquo;est réellement difficile ou complexe.
De plus, la plupart sont des opérations de mises en place qui ne sont réalisées qu&rsquo;une fois ; on n&rsquo;édite pas la zone DNS ou un reverse DNS tous les deux jours, tout comme on ne touche pas une configuration en place qui fonctionne tant qu&rsquo;il n&rsquo;y a pas de nouveau cas d&rsquo;utilisation.</p><p>Pour citer les plus réfractaires à l&rsquo;auto-hébergement, il peut y avoir des maintenances pour gérer les conséquences d&rsquo;une blacklist, mais il n&rsquo;y a aucun scénario dans lequel ladite maintenance impliquerait autant de travail que la mise en place que nous venons de faire… et qui au final se réplique en 10 minutes chrono une fois réalisée une première fois pour se faire la main.</p><div id=quelle-est-la-prochaine-étape- class=anchor></div><h2 class="relative group">Quelle est la prochaine étape ?
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#quelle-est-la-prochaine-%c3%a9tape- aria-label=Anchor>#</a></span></h2><p>Votre prochaine étape est de mettre en place de la redondance pour vous assurer qu&rsquo;une panne de votre serveur de mail n&rsquo;entraine pas de perte de mail.</p><p>En pratique, la plupart des serveurs de mails retentent une émission de multiples fois si la destination est inaccessible donc, <strong>même</strong> en cas de panne, la plupart de vos mails seront temporisés par votre émetteur et retransmis quand votre serveur sera de nouveau accessible.</p><p>En théorie, on veut tout de même faire les choses bien, et reposer sur la responsabilité des autres à gérer nos pannes n&rsquo;est pas très poli.
Vous devez mettre en place un serveur secondaire, vous arranger entre amis pour être serveurs secondaires les uns des autres, ou même vous souscrire à un service qui offre du mail secondaire.
N&rsquo;importe quoi qui puisse permettre de couvrir vos arrières lorsque votre serveur primaire tombe.</p><p>Ensuite, peu importe la méthode choisie, il vous faudra :</p><ul><li>ajouter un enregistrement MX supplémentaire dans votre zone DNS</li><li>configurer le serveur secondaire pour retransmettre les mails au serveur primaire</li></ul><p>On est loin de la haute voltige.</p><div id=est-ce-quon-a-vraiment-fini- class=anchor></div><h2 class="relative group">Est-ce qu&rsquo;on a vraiment fini ?
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#est-ce-quon-a-vraiment-fini- aria-label=Anchor>#</a></span></h2><p>Je vais probablement écrire une série d&rsquo;article pour discuter de la réputation, ainsi que des mécanismes en place chez les Big Mailer Corps qui provoquent des pannes de distribution.</p><p>Si ce sont des sujets d&rsquo;intérêt et que j&rsquo;ai du feedback positif, j&rsquo;écrirais plus souvent sur les concepts autour de la déliverabilité, sinon je reprendrais mes anciennes activités : écrire mes rapports mensuels sur mes contributions opensource. À vous de me dire :-)</p><p>Finalement, dans cet article j&rsquo;ai décrit un setup vraiment simple mais il y a des tonnes de choses intéressantes à faire avec les infrastructures de mail, si vous n&rsquo;avez pas peur d&rsquo;aller plus loin.</p><p>Je construis actuellement une infrastructure de mail pour un future service commercial d&rsquo;hébergement.
L&rsquo;infrastructure s&rsquo;étend sur plusieurs data centers dans plusieurs pays, a des serveurs secondaires capable d&rsquo;encaisser des pannes très sérieuses des serveurs primaires, peut facilement monter à l&rsquo;échelle sur des pics de volume, elle décorelle le trafic entrant et sortant pour permettre de fournir des services partiels, peut facilement re-router le trafic entre des machines pour contourner des pannes, tout en fournissant des services IMAP à des comptes virtuels sur une multitude de domaines, avec des backups quotidiens.
L&rsquo;infrastructure me coute… moins de 75 EUR par mois.
Elle est également très simple, la plupart des machines sont des installations par défaut d&rsquo;OpenBSD avec <strong>très peu</strong> de changements au système de base.</p><p>Si lire à propos de ce genre de mises en place vous intéresse, je peux écrire à ce sujet pour aider un maximum de personnes à monter un maximum d&rsquo;alternatives aux Big Mailer Corps, ce qui est au final mon souhait.</p><p>Merci de m&rsquo;avoir lu, je n&rsquo;ai pas de soundcloud, mais <a href=https://patreon.com/gilles target=_blank>j&rsquo;ai un patreon</a> et un <a href=https://github.com/sponsors/poolpOrg target=_blank>github</a> si vous voulez me sponsoriser, ou <strong>utiliser les icones en dessous du lien de commentaires</strong> pour partager cet article sur les reseaux sociaux.</p><hr><p>Comments: <a href=https://github.com/poolpOrg/poolp.org/discussions/113 target=_blank>https://github.com/poolpOrg/poolp.org/discussions/113</a></p></br></br></div><script>var oid="views_posts/2019-12-23/index.md",oid_likes="likes_posts/2019-12-23/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;title=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;text=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;resubmit=true&amp;title=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;description=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;quote=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;subject=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;resubmit=true&amp;title=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/posts/2019-12-23/mettre-en-place-un-serveur-de-mail-avec-opensmtpd-dovecot-et-rspamd/&amp;resubmit=true&amp;title=Mettre%20en%20place%20un%20serveur%20de%20mail%20avec%20OpenSMTPD,%20Dovecot%20et%20Rspamd" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><a href=/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/feature_hu8c1faae41ee01e60a5aef9a9cf29c1ad_40196_600x0_resize_q75_box.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/2019-09-14/setting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd/>Setting up a mail server with OpenSMTPD, Dovecot and Rspamd</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2019-09-14 05:37:00 +0000 UTC">14 September 2019</time><span class="px-2 text-primary-500">&#183;</span><span>7711 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">37 mins</span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/technology/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">technology</span></span></span></div></div><div class="py-1 prose dark:prose-invert">TL;DR: - NO TL;DR: this time, I spent hours writing, you should spend minutes reading. - OK... I explain in WAY TOO MUCH details how to setup a mail server EDIT (2019-10-26) # OpenSMTPD 6.</div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/2019-12-15/decentralised-smtp-is-for-the-greater-good/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/2019-12-15/decentralised-smtp-is-for-the-greater-good/feature_hu8c1faae41ee01e60a5aef9a9cf29c1ad_40196_600x0_resize_q75_box.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/2019-12-15/decentralised-smtp-is-for-the-greater-good/>Decentralised SMTP is for the greater good</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2019-12-15 07:29:00 +0200 +0200">15 December 2019</time><span class="px-2 text-primary-500">&#183;</span><span>1239 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/technology/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">technology</span></span></span></div></div><div class="py-1 prose dark:prose-invert">TL;DR: - SMTP is the way computers exchange e-mails - it is a decentralised protocol meaning that ANYONE can run a node and be independant - it is being centralised at companies that have a history of abuse - it is being centralised in a country that has a history of abuse Where did you read this already ?</div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/2019-12-01/spf-aware-greylisting-and-filter-greylist/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/2019-12-01/spf-aware-greylisting-and-filter-greylist/feature_hua90d7be2b6bc315430ccbe022e6fae03_6472_600x0_resize_q75_box.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/2019-12-01/spf-aware-greylisting-and-filter-greylist/>SPF-aware greylisting and filter-greylist</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2019-12-01 10:11:00 +0200 +0200">1 December 2019</time><span class="px-2 text-primary-500">&#183;</span><span>2380 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">12 mins</span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/technology/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">technology</span></span></span></div></div><div class="py-1 prose dark:prose-invert">TL;DR: - greylisting is a sound idea - yet it is not really practical today - people tend to disable it or find work-arounds - SPF-aware greylisting makes greylisting usable again Shout outs to my sponsors !</div></div><div class="px-6 pt-4 pb-2"></div></div></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/2019-12-15/decentralisons-smtp-pour-le-bien-commun/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Décentralisons SMTP pour le bien commun</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2019-12-15 13:05:00 +0200 +0200">15 December 2019</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/posts/2019-12-24/december-2019-opensmtpd-and-filters-work-articles-and-goodies/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">December 2019: OpenSMTPD and filters work, articles and goodies</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2019-12-24 09:31:00 +0200 +0200">24 December 2019</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://giscus.app/client.js data-repo=poolpOrg/poolp.org data-repo-id="MDEwOlJlcG9zaXRvcnkxMjYxODk2MjA=" data-category=Articles data-category-id=DIC_kwDOB4WANM4B-Zf1 data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>Categories</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">Copyright © Gilles Chehade - poolp.org</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://poolp.org style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=poolporg data-description="Support me on Buy me a coffee!" data-message="Support me !" data-color=#FFDD00 data-position=Left data-x_margin=18 data-y_margin=18></script></html>