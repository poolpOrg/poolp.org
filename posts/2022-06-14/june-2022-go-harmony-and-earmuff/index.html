<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.111.3"><link rel=icon href=/images/poolp_org.png><title>June 2022: go-harmony and earmuff | poolp.org</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://poolp.org/posts/2022-06-14/june-2022-go-harmony-and-earmuff/cover.png"><meta name=twitter:title content="June 2022: go-harmony and earmuff"><meta name=twitter:description content="TL;DR: did a lot of music, even while writing code. Shout out to my sponsors ‚ù§Ô∏è A HUGE thanks goes to my sponsors on github and patreon: your continuous support is very much appreciated !
I created a Discord where I hang out and discuss my projects or screencast as I work on them. Feel free to hop in if you want, and feel free to do just like me and share thoughts as you work on your own projects there: this is a virtual hack room for anyone to join: https://discord."><meta property="og:title" content="June 2022: go-harmony and earmuff"><meta property="og:description" content="TL;DR: did a lot of music, even while writing code. Shout out to my sponsors ‚ù§Ô∏è A HUGE thanks goes to my sponsors on github and patreon: your continuous support is very much appreciated !
I created a Discord where I hang out and discuss my projects or screencast as I work on them. Feel free to hop in if you want, and feel free to do just like me and share thoughts as you work on your own projects there: this is a virtual hack room for anyone to join: https://discord."><meta property="og:type" content="article"><meta property="og:url" content="https://poolp.org/posts/2022-06-14/june-2022-go-harmony-and-earmuff/"><meta property="og:image" content="https://poolp.org/posts/2022-06-14/june-2022-go-harmony-and-earmuff/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-14T12:27:00+02:00"><meta property="article:modified_time" content="2022-06-14T12:27:00+02:00"><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link href=/css/medium.css rel=stylesheet><link href=/css/additional.css rel=stylesheet><link href=/css/syntax.css rel=stylesheet><link href=/css/custom.css rel=stylesheet><link rel=alternate type=application/rss+xml title="subscribe to feed" href=/index.xml></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://poolp.org/><img src=/images/poolp_org.png alt=logo></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><div class="row post-top-meta"><div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right"><img class=author-thumb src=/images/me.jpg alt="Gilles Chehade / ÿ¨ŸäŸÑ ÿ¥ÿ≠ÿßÿØÿ©"></div><div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left"><a target=_blank class=link-dark>Gilles Chehade / ÿ¨ŸäŸÑ ÿ¥ÿ≠ÿßÿØÿ©</a><br><span class=author-description><br></span><br><span class=author-description><i class="far fa-star"></i>
Jun 14, 2022
<i class="far fa-clock clock"></i>
11 min read</span></div></div><div class=after-post-tags><ul class=tags></ul></div><h1 class=posttitle>June 2022: go-harmony and earmuff</h1><b><a class="far fa-comment" href=#comments>go to comments</a></b><br><br></div><div class=article-post><blockquote><b>TL;DR:</b>
did a lot of music, even while writing code.</blockquote><center><img src=cover.png></center><h1 id=shout-out-to-my-sponsors-x2764xfe0f>Shout out to my sponsors ‚ù§Ô∏è</h1><p>A <strong>HUGE thanks</strong> goes to my sponsors on <a href=https://github.com/sponsors/poolpOrg>github</a>
and <a href=https://www.patreon.com/gilles>patreon</a>:
your continuous support is very much appreciated !</p><p>I created a Discord where I hang out and discuss my projects or screencast as I work on them.
Feel free to hop in if you want,
and feel free to do just like me and share thoughts as you work on your own projects there:
<strong>this is a virtual hack room for anyone to join</strong>: <a href=https://discord.gg/YC6j4rbvSk>https://discord.gg/YC6j4rbvSk</a></p><h1 id=code-unrelated-work>Code-unrelated work</h1><p>As last month,
I&rsquo;ll start with code-unrelated work !</p><p>First,
here&rsquo;s my progress on learning Hyunsoo Lee&rsquo;s adaptation of Bach&rsquo;s Air on G string,
still not quite right and with some missing parts but&mldr; slowly getting there:</p><center><iframe width=560 height=315 src=https://www.youtube.com/embed/u6G3bgIk4Wo title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></center><p>While at it,
I started learning Hyunsoo Lee&rsquo;s adaptation of Beethovens&rsquo; 5th&rsquo;s Symphony,
also not quite right and with missing parts but also making progress:</p><center><iframe width=560 height=315 src=https://www.youtube.com/embed/PtlDJwlM-SM title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></center><p>It was a long time since I made a LoFi track,
here&rsquo;s two that I thought were not too bad:</p><center><iframe width=560 height=315 src=https://www.youtube.com/embed/rjxiUCOkLGA title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></center>
<center><iframe width=560 height=315 src=https://www.youtube.com/embed/Fk0grNZ4LtY title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></center><p>They&rsquo;re mostly an exercise to get familiar with Logic Pro X.</p><h1 id=go-harmony>go-harmony</h1><p><code>go-harmony</code> is a package written in Golang that intends to implement a <strong>music theory engine</strong> to build other tools with.
It&rsquo;s only a month old so there&rsquo;s not much to it yet,
however there&rsquo;s enough that I could use it to build the project I&rsquo;ll talk about in the next section.</p><p>My intent was not only to build the engine but also to refresh my memories and fill some gaps&mldr;
so I decided not to be lazy and copy-paste a bunch of values in static tables.
Instead,
I first implemented notes,
then intervals as semitones distances to a root note,
then chords as a pattern of intervals from a root note (taking into account chord inversions),
then also scales also as a pattern of intervals,
then derived triads and sevenths chords using the chords implementation,
and so on&mldr;</p><p>I made it so it would be very easy to extend for unsupported cases,
like chords which are defined as follows making it simple to add new families by simply describing the general structure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>  <span class=nx>MajorTriad</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nx>Structure</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>MinorTriad</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nx>Structure</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MinorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>AugmentedTriad</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nx>Structure</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>AugmentedFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>DiminishedTriad</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nx>Structure</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MinorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>DiminishedFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>AddNinth</span>      <span class=nx>Structure</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>MajorTriad</span><span class=p>,</span> <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorNinth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>AddEleventh</span>   <span class=nx>Structure</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>MajorTriad</span><span class=p>,</span> <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectEleventh</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>AddThirteenth</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>MajorTriad</span><span class=p>,</span> <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorThirteenth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>SusSecond</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nx>Structure</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSecond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>SusFourth</span> <span class=nx>Structure</span> <span class=p>=</span> <span class=nx>Structure</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFourth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>The same applies for scales:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>Ionian</span> <span class=p>=</span> <span class=p>[]</span><span class=nx>intervals</span><span class=p>.</span><span class=nx>Interval</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSecond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFourth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSixth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSeventh</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>Octave</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>Dorian</span> <span class=p>=</span> <span class=p>[]</span><span class=nx>intervals</span><span class=p>.</span><span class=nx>Interval</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSecond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MinorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFourth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSixth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MinorSeventh</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>Octave</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>BluesMajor</span> <span class=p>=</span> <span class=p>[]</span><span class=nx>intervals</span><span class=p>.</span><span class=nx>Interval</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSecond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFourth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MajorSixth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>Octave</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>MinorPentatonic</span> <span class=p>=</span> <span class=p>[]</span><span class=nx>intervals</span><span class=p>.</span><span class=nx>Interval</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectUnison</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MinorThird</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFourth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>PerfectFifth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>MinorSeventh</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>intervals</span><span class=p>.</span><span class=nx>Octave</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>Then <code>go-harmony</code> uses <strong>artihmetics to compute everything</strong> from a root note and its intervals.
For example the <code>scale.Notes()</code> method computes the notes for a scale by applying the intervals that match the scale pattern for a given root note:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>scale</span> <span class=o>*</span><span class=nx>Scale</span><span class=p>)</span> <span class=nf>Notes</span><span class=p>()</span> <span class=p>[]</span><span class=nx>notes</span><span class=p>.</span><span class=nx>Note</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ret</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=nx>notes</span><span class=p>.</span><span class=nx>Note</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>interval</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>scale</span><span class=p>.</span><span class=nx>structure</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ret</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>ret</span><span class=p>,</span> <span class=o>*</span><span class=nx>scale</span><span class=p>.</span><span class=nx>root</span><span class=p>.</span><span class=nf>Interval</span><span class=p>(</span><span class=nx>interval</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ret</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>No hard-coded scales for each notes and once a scale structure is implemented, it works for all notes.</p><p>The package by itself doesn&rsquo;t do much more,
it&rsquo;s meant to provide APIs and structures for other projects to rely upon,
however I built a small utility that&rsquo;s shipped with it to showcase some of it&rsquo;s features.</p><p>For example,
it can be used to validate note names and obtain their frequencies relative to a particular tuning (only A440 for now):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>% harmony -note <span class=s1>&#39;C&#39;</span>
</span></span><span class=line><span class=cl>C 261.63
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -note <span class=s1>&#39;C5&#39;</span>
</span></span><span class=line><span class=cl>C 523.25
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -note <span class=s1>&#39;A&#39;</span>
</span></span><span class=line><span class=cl>A <span class=m>440</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -note <span class=s1>&#39;Cb&#39;</span>
</span></span><span class=line><span class=cl>Cb 493.88
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -note <span class=s1>&#39;C#&#39;</span>
</span></span><span class=line><span class=cl>C# 277.18
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -note <span class=s1>&#39;Cbb&#39;</span>
</span></span><span class=line><span class=cl>Cbb 466.16
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -note Z
</span></span><span class=line><span class=cl>2022/06/14 13:25:36 bad note <span class=o>(</span>Z<span class=o>)</span>: should be <span class=s1>&#39;C&#39;</span>, <span class=s1>&#39;D&#39;</span>, <span class=s1>&#39;E&#39;</span>, <span class=s1>&#39;F&#39;</span>, <span class=s1>&#39;G&#39;</span>, <span class=s1>&#39;A&#39;</span> or <span class=s1>&#39;B&#39;</span>
</span></span></code></pre></div><p>Just as with notes,
it can be used to validate chord names (it supports multiple notations) and decompose them into their building intervals:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;C&#39;</span>
</span></span><span class=line><span class=cl>Cmaj
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>    3maj:   E 329.63
</span></span><span class=line><span class=cl>       5:   G 392.00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;C5&#39;</span>
</span></span><span class=line><span class=cl>C5
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>       5:   G 392.00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;C7&#39;</span>
</span></span><span class=line><span class=cl>C7
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>    3maj:   E 329.63
</span></span><span class=line><span class=cl>       5:   G 392.00
</span></span><span class=line><span class=cl>    7min:  Bb 466.16
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;C7b5&#39;</span>
</span></span><span class=line><span class=cl>C7dim5
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>    3maj:   E 329.63
</span></span><span class=line><span class=cl>    5dim:  Gb 369.99
</span></span><span class=line><span class=cl>    7min:  Bb 466.16
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;Csus2&#39;</span>
</span></span><span class=line><span class=cl>Csus2
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>    2maj:   D 293.66
</span></span><span class=line><span class=cl>       5:   G 392.00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;Cadd9&#39;</span>
</span></span><span class=line><span class=cl>Cadd9
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>    3maj:   E 329.63
</span></span><span class=line><span class=cl>       5:   G 392.00
</span></span><span class=line><span class=cl>    9maj:   D 587.33
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;Cadd9/E&#39;</span>
</span></span><span class=line><span class=cl>Cadd9/E
</span></span><span class=line><span class=cl>    3maj:   E 329.63
</span></span><span class=line><span class=cl>       1:   C 261.63
</span></span><span class=line><span class=cl>       5:   G 392.00
</span></span><span class=line><span class=cl>    9maj:   D 587.33
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -chord <span class=s1>&#39;Cadd2&#39;</span> 
</span></span><span class=line><span class=cl>2022/06/14 13:24:43 unknown chord name: add2
</span></span></code></pre></div><p>It knows of a few scales and modes and can decompose them into notes, triads and sevenths chords for each degree of the scale:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>% harmony -scale Caeolian
</span></span><span class=line><span class=cl>C
</span></span><span class=line><span class=cl>   C 261.63
</span></span><span class=line><span class=cl>   D 293.66
</span></span><span class=line><span class=cl>   Eb 311.13
</span></span><span class=line><span class=cl>   F 349.23
</span></span><span class=line><span class=cl>   G <span class=m>392</span>
</span></span><span class=line><span class=cl>   Ab 415.3
</span></span><span class=line><span class=cl>   Bb 466.16
</span></span><span class=line><span class=cl>   C 523.25
</span></span><span class=line><span class=cl>Triads:
</span></span><span class=line><span class=cl>   Cmin
</span></span><span class=line><span class=cl>   Ddim
</span></span><span class=line><span class=cl>   Ebmaj
</span></span><span class=line><span class=cl>   Fmin
</span></span><span class=line><span class=cl>   Gmin
</span></span><span class=line><span class=cl>   Abmaj
</span></span><span class=line><span class=cl>   Bbmaj
</span></span><span class=line><span class=cl>Sevenths:
</span></span><span class=line><span class=cl>   Cmin7
</span></span><span class=line><span class=cl>   Dm7b5
</span></span><span class=line><span class=cl>   Ebmaj7
</span></span><span class=line><span class=cl>   Fmin7
</span></span><span class=line><span class=cl>   Gmin7
</span></span><span class=line><span class=cl>   Abmaj7
</span></span><span class=line><span class=cl>   Bb7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -scale Cphrygian
</span></span><span class=line><span class=cl>C
</span></span><span class=line><span class=cl>   C 261.63
</span></span><span class=line><span class=cl>   Db 277.18
</span></span><span class=line><span class=cl>   Eb 311.13
</span></span><span class=line><span class=cl>   F 349.23
</span></span><span class=line><span class=cl>   G <span class=m>392</span>
</span></span><span class=line><span class=cl>   Ab 415.3
</span></span><span class=line><span class=cl>   Bb 466.16
</span></span><span class=line><span class=cl>   C 523.25
</span></span><span class=line><span class=cl>Triads:
</span></span><span class=line><span class=cl>   Cmin
</span></span><span class=line><span class=cl>   Dbmaj
</span></span><span class=line><span class=cl>   Ebmaj
</span></span><span class=line><span class=cl>   Fmin
</span></span><span class=line><span class=cl>   Gdim
</span></span><span class=line><span class=cl>   Abmaj
</span></span><span class=line><span class=cl>   Bbmin
</span></span><span class=line><span class=cl>Sevenths:
</span></span><span class=line><span class=cl>   Cmin7
</span></span><span class=line><span class=cl>   Dbmaj7
</span></span><span class=line><span class=cl>   Eb7
</span></span><span class=line><span class=cl>   Fmin7
</span></span><span class=line><span class=cl>   Gm7b5
</span></span><span class=line><span class=cl>   Abmaj7
</span></span><span class=line><span class=cl>   Bbmin7
</span></span></code></pre></div><p>And finally,
someone asked if it could build chords from a given set of notes,
so I implemented it which took only a couple minutes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>% harmony -notes <span class=s1>&#39;C,E,G&#39;</span>
</span></span><span class=line><span class=cl>Cmaj
</span></span><span class=line><span class=cl>   C 261.63
</span></span><span class=line><span class=cl>   E 329.63
</span></span><span class=line><span class=cl>   G <span class=m>392</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -notes <span class=s1>&#39;C,Eb,G,B&#39;</span>
</span></span><span class=line><span class=cl>C-M7
</span></span><span class=line><span class=cl>   C 261.63
</span></span><span class=line><span class=cl>   Eb 311.13
</span></span><span class=line><span class=cl>   G <span class=m>392</span>
</span></span><span class=line><span class=cl>   B 493.88
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -notes <span class=s1>&#39;C,Eb,G,Bb&#39;</span>
</span></span><span class=line><span class=cl>Cmin7
</span></span><span class=line><span class=cl>   C 261.63
</span></span><span class=line><span class=cl>   Eb 311.13
</span></span><span class=line><span class=cl>   G <span class=m>392</span>
</span></span><span class=line><span class=cl>   Bb 466.16
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% harmony -notes <span class=s1>&#39;C,F,G&#39;</span>    
</span></span><span class=line><span class=cl>Csus4
</span></span><span class=line><span class=cl>   C 261.63
</span></span><span class=line><span class=cl>   F 349.23
</span></span><span class=line><span class=cl>   G <span class=m>392</span>
</span></span></code></pre></div><p>That&rsquo;s about all it can do for now,
but I have many ideas I want to implement as I have big plans for it :-)</p><h1 id=earmuff>earmuff</h1><p><code>earmuff</code> is a proof-of-concept <strong>compiler and interpreter for a programming language to write music</strong>.</p><p>After I showed the first iteration of the interpreter,
two people pointed me to <a href=https://sonic-pi.net>Sonic Pi</a> and it kinda is a similar concept but executed a bit differently.
Whereas Sonic Pi&rsquo;s is an <strong>advanced scriptable synthesizer with its own IDE</strong>,
<code>earmuff</code> is simply a <strong>language to express music sheet as code</strong> and doesn&rsquo;t come with anything but the interpreter and compiler for it.</p><p>My intent was to be able to write music as code <strong>in my usual programming environment</strong>,
using <code>diff</code>, <code>patch</code> or even <code>git</code> for versionning my changes and applying new changes,
and basically <strong>work with music in the same way I work with code</strong> when I don&rsquo;t have instruments at hands.</p><p>So <code>earmuff</code> reads <code>.muff</code> source files,
and either compiles them to SMF (Standard Midi File) files that can be played with a standard MIDI player,
or interprets them into MIDI messages that are sent to a synthesizer to play the source code in real-time.</p><p>It relies on <code>go-harmony</code> to make sense of notes and chord names,
<strong>spotting errors</strong> as it converts the source code to its internal format,
and <strong>validating</strong> that the tracks are <strong>structurally consistent</strong> (ie: time signature violations) just as if it was checking for syntax or grammar errors.</p><p>A <code>.muff</code> file may look like this for a single-track 12-bars blues:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>project {
</span></span><span class=line><span class=cl>    bpm 120;
</span></span><span class=line><span class=cl>    time 4 4;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    instrument guitar {
</span></span><span class=line><span class=cl>        bar { whole chord C7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord F7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord C7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord C7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord F7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord F7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord C7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord C7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord G7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord F7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord C7 on 1/1; }
</span></span><span class=line><span class=cl>        bar { whole chord G7 on 1/1; }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><p>&mldr; or may be more complex for multi-tracks projects,
like these few bars from <a href="https://www.youtube.com/watch?v=DY0FF4iR9Cw">Django&rsquo;s Nuages</a> (I know, it&rsquo;s not quite right but hey, it was late and I&rsquo;m still learning the language üòÖ):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>project {
</span></span><span class=line><span class=cl>    bpm 80;
</span></span><span class=line><span class=cl>    time 4 4;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    instrument guitar {
</span></span><span class=line><span class=cl>        bar {
</span></span><span class=line><span class=cl>            8th note C# on 3/1;
</span></span><span class=line><span class=cl>            8th note D on 3/2;
</span></span><span class=line><span class=cl>            8th note A on 3/3;
</span></span><span class=line><span class=cl>            8th note G# on 3/4;
</span></span><span class=line><span class=cl>            8th note G on 4/1;
</span></span><span class=line><span class=cl>            8th note F# on 4/2;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        bar {
</span></span><span class=line><span class=cl>            half note F on 1/1;
</span></span><span class=line><span class=cl>            8th note E on 4/2;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        bar {
</span></span><span class=line><span class=cl>            half note Fbb on 1/1;
</span></span><span class=line><span class=cl>            quarter note Eb on 2/2;
</span></span><span class=line><span class=cl>            8th note D on 4/2;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        bar { whole note D on 1/1; }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    instrument piano {
</span></span><span class=line><span class=cl>        bar {}
</span></span><span class=line><span class=cl>        bar { whole chord Eb9 on 1/1; }
</span></span><span class=line><span class=cl>        bar {
</span></span><span class=line><span class=cl>            half chord Am7b5 on 1/1;
</span></span><span class=line><span class=cl>            half chord D7b9 on 3/1;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        bar {
</span></span><span class=line><span class=cl>            half chord Gmaj7 on 1/1;
</span></span><span class=line><span class=cl>            quarter chord Am7 on 3/1;
</span></span><span class=line><span class=cl>            quarter chord Bm7b5 on 4/1;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    instrument percussive {
</span></span><span class=line><span class=cl>        bar {}
</span></span><span class=line><span class=cl>        bar { half cymbal on 1/1; }
</span></span><span class=line><span class=cl>        bar { half cymbal on 1/1; }
</span></span><span class=line><span class=cl>        bar { half cymbal on 1/1; }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><p>By default,
<code>earmuff</code> operates as an interpreter so running the following command will playback the source if a synthesizer is detected (currently only FluidSynth is):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>% earmuff nuages.muff
</span></span></code></pre></div><center><audio controls><source src=nuages.mp3 type=audio/mpeg>Your browser does not support the audio element.</audio></center><br><p>The <code>-verbose</code> option may be passed,
in which case <code>earmuff</code> outputs MIDI messages being sent to the synthesizer in real-time for debugging:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>synth &lt;- <span class=m>0</span> ProgramChange channel: <span class=m>0</span> program: <span class=m>25</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>2</span> ProgramChange channel: <span class=m>10</span> program: <span class=m>113</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>1</span> ProgramChange channel: <span class=m>1</span> program: <span class=m>1</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>49</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>50</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>57</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOff channel: <span class=m>0</span> key: <span class=m>49</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>56</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOff channel: <span class=m>0</span> key: <span class=m>50</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOff channel: <span class=m>0</span> key: <span class=m>57</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>55</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOff channel: <span class=m>0</span> key: <span class=m>56</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>54</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOff channel: <span class=m>0</span> key: <span class=m>55</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOff channel: <span class=m>0</span> key: <span class=m>54</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>2</span> NoteOn channel: <span class=m>10</span> key: <span class=m>51</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>1</span> NoteOn channel: <span class=m>1</span> key: <span class=m>51</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>1</span> NoteOn channel: <span class=m>1</span> key: <span class=m>49</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>0</span> NoteOn channel: <span class=m>0</span> key: <span class=m>53</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>1</span> NoteOn channel: <span class=m>1</span> key: <span class=m>55</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>1</span> NoteOn channel: <span class=m>1</span> key: <span class=m>65</span> velocity: <span class=m>120</span>
</span></span><span class=line><span class=cl>synth &lt;- <span class=m>1</span> NoteOn channel: <span class=m>1</span> key: <span class=m>58</span> velocity: <span class=m>120</span>
</span></span></code></pre></div><br><p>Passing the option <code>-out</code> will cause it to compile a <code>.mid</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>% earmuff -out nuages.mid nuages.muff
</span></span></code></pre></div><p>&mldr; which can either be played by a standart MIDI player,
imported in tools that can ingest MIDI files such as a DAWs (here Logic Pro X):</p><center><a href=earmuff-daw.png><img src=earmuff-daw.png></a></center><br><p>&mldr; or tools like Guitar Pro which can render sheet music from a MIDI file,
play it back after altering speed, instruments, etc&mldr;</p><center><a href=earmuff-gp.png><img src=earmuff-gp.png></a></center><br><p>This is a toy project at a <strong>very early stage</strong>,
I don&rsquo;t have very serious plans for it but I&rsquo;ll keep working on it as it improves my overall knowledge,
and I kinda like the idea of being able to write music as code from my bed while the kid sleeps by my side
(also I&rsquo;m far faster as writing code than editing sheets) :-)</p><p>There are still bugs and glitches in the MIDI generation but <strong>the MP3 I linked above was converted from the .mid built by the source code just above it</strong>,
so it may not be perfect yet but it works pretty decently in my opinion.</p><p>My current plans are to cleanup the proof-of-concept,
make it work on at least macOS, Windows, Linux and OpenBSD,
and then extend it with new features such as <strong>loops and functions</strong>.
A very nice feature would be to allow it to read from MIDI and generate the corresponding <code>.muff</code> code,
allowing me to auto-generate code from a MIDI input (like a keyboard for example),
or simply allowing me to export a SMF from another tool to work on it with <code>earmuff</code> and export it back to the other tool:
being able to <strong>switch back and forth</strong> between VScode and Guitar Pro or Logic Pro X would be awesome.</p><h1 id=whats-next->What&rsquo;s next ?</h1><p>Next is <strong>A DAMN BREAK</strong> cause I said last month I&rsquo;d take a couple months and couldn&rsquo;t even hold my word for a single one.
I&rsquo;ll be marrying in a couple weeks,
going on vacations a few weeks later,
and got plenty of code-unrelated things to finish.</p><p>Feel free to <a href=https://discord.gg/YC6j4rbvSk>join my discord</a>,
engage on <a href=https://twitter.com/poolpOrg>twitter</a> or
support me on <a href=https://github.com/sponsors/poolpOrg>github</a> or/and <a href=https://www.patreon.com/gilles>patreon</a>.</p><p>Take care,
stay tuned,
I&rsquo;ll post as soon as I resume my work !</p><hr><p>Comments: <a href=https://github.com/poolpOrg/poolp.org/discussions/153>https://github.com/poolpOrg/poolp.org/discussions/153</a></p></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="d-block col-md-6" href=https://poolp.org/posts/2022-10-18/october-2022-blog-comments-a-bit-of-plakar-and-the-streamchain-project/>&#171; October 2022: blog comments, a bit of plakar and the streamchain project</a>
<a class="d-block col-md-6 text-lg-right" href=https://poolp.org/posts/2022-05-22/may-2022-yet-again-tons-of-plakar-stuff/>May 2022: yet again, tons of plakar stuff &#187;</a><div class=clearfix></div></div></div></div></div><div class=container><div id=comments class="row justify-content-center mb-5"><div class=col-md-8><script src=https://giscus.app/client.js data-repo=poolpOrg/poolp.org data-repo-id="MDEwOlJlcG9zaXRvcnkxMjYxODk2MjA=" data-category=Articles data-category-id=DIC_kwDOB4WANM4B-Zf1 data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></div></div><div class=alertbar><div class="container text-center"><span><img src=/images/poolp_org.png alt=logo height=0px>
Consider tipping me on <a href=https://paypal.me/poolpOrg>PayPal</a>,
supporting me through <a href=https://github.com/sponsors/poolpOrg>Github</a>,
<a href=https://patreon.com/gilles>Patreon</a> or
<a href=https://liberapay.com/poolpOrg>LiberaPay</a>,
or getting me something from <a href=http://amzn.eu/3MwH6CX>Amazon</a> for positive <a href=https://en.wikipedia.org/wiki/Reinforcement>reinforcement</a> :-)</span></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left"><a rel=me href=https://social.poolp.org/@gilles>Mastodon</a>
&copy; Copyright poolp.org - All rights reserved</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target=_blank rel=noopener href=https://www.wowthemes.net>Mediumish Theme</a> by WowThemes.net</div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/js/mediumish.js></script></body></html>