<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Plakar: a TON of changes &#183; poolp.org</title><meta name=title content="Plakar: a TON of changes &#183; poolp.org"><meta name=keywords content="plakar,backups,"><link rel=canonical href=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/><link type=text/css rel=stylesheet href=/css/main.bundle.min.c6116b9ed1c907a8c0eb015f377d3eecc07e448d75729e31fc3de5881465c6c172ba9fa9a6800c030116caf2a110d92242bb816639484ca791f7cd107a8d49b5.css integrity="sha512-xhFrntHJB6jA6wFfN30+7MB+RI11cp4x/D3liBRlxsFyup+ppoAMAwEWyvKhENkiQruBZjlITKeR980Qeo1JtQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Plakar: a TON of changes"><meta property="og:description" content="TL;DR: TL;DR: a lot of work in plakar, but also on CDC and index optimization. Optimized go-fastcdc # I ran into a benchmark which included my implementation of the FastCDC algorithm, and it made me realise that it was not on par with alternative implementations:"><meta property="og:type" content="article"><meta property="og:url" content="https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/"><meta property="og:image" content="https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/feature.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-07T09:29:00+02:00"><meta property="article:modified_time" content="2023-10-07T09:29:00+02:00"><meta property="og:site_name" content="poolp.org"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/feature.jpeg"><meta name=twitter:title content="Plakar: a TON of changes"><meta name=twitter:description content="TL;DR: TL;DR: a lot of work in plakar, but also on CDC and index optimization. Optimized go-fastcdc # I ran into a benchmark which included my implementation of the FastCDC algorithm, and it made me realise that it was not on par with alternative implementations:"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Plakar: a TON of changes","headline":"Plakar: a TON of changes","abstract":"TL;DR: TL;DR: a lot of work in plakar, but also on CDC and index optimization. Optimized go-fastcdc # I ran into a benchmark which included my implementation of the FastCDC algorithm, and it made me realise that it was not on par with alternative implementations:","inLanguage":"en","url":"https:\/\/poolp.org\/posts\/2023-10-07\/plakar-a-ton-of-changes\/","author":{"@type":"Person","name":""},"copyrightYear":"2023","dateCreated":"2023-10-07T09:29:00\u002b02:00","datePublished":"2023-10-07T09:29:00\u002b02:00","dateModified":"2023-10-07T09:29:00\u002b02:00","keywords":["plakar","backups"],"mainEntityOfPage":"true","wordCount":"4242"}]</script><script src=/lib/jquery/jquery.slim.min.js integrity></script>
<link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/custom.css><script>for(var elements=document.querySelectorAll(".discord-dialog__close-button, .discord-dialog"),i=0;i<elements.length;i++)elements[i].addEventListener("click",function(){toggle(".discord-dialog")})</script><style>@import "https://fonts.cdnfonts.com/css/whitney-2";.discord-dialog *,.discord-dialog :after,.discord-dialog :before{box-sizing:inherit}.discord-dialog a{text-decoration:none}@keyframes discord-dialog__transition{0%{opacity:0;transform:translateY(16px)}100%{opacity:1;transform:translateY(0)}}.discord-dialog{-webkit-tap-highlight-color:transparent;box-sizing:border-box;display:none;z-index:2147483647;position:fixed;max-width:288px;right:0;bottom:0;margin:18px;border-radius:10px;font-family:Whitney,sans-serif;background:#2e3136;color:#72767d;box-shadow:0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12),0 8px 10px -5px rgba(0,0,0,.4);transition:opacity .3s cubic-bezier(.25,.8,.25,1),transform .3s cubic-bezier(.25,.8,.25,1);animation:discord-dialog__transition .2s}.discord-dialog--active{display:block}.discord-dialog__container{font-size:14px;line-height:1.2;color:#99aab5;padding:8px 28px 28px}.discord-dialog__logo{display:none;width:auto;margin-top:5px;height:24px}.discord-dialog__logo path{fill:#fff}.discord-dialog__close-button{position:absolute;right:0;padding:16px;cursor:pointer}.discord-dialog__close-button svg{height:20px;width:20px}.discord-dialog__close-button svg path{fill:#ccc}.discord-dialog__close-button:hover{opacity:.8}.discord-dialog__close-button:active{opacity:.4}.discord-dialog__footer{padding:10px 20px}.discord-dialog__guild-icon{border-radius:50%;width:64px;display:block;height:auto;margin:16px 0}.discord-dialog__guild{font-size:24px;line-height:30px;margin-bottom:12px;font-weight:700;color:#fff}.discord-dialog__btn{background:#7289da;color:#fff;text-align:center;display:block;border-radius:1px;margin:8px;font-size:16px;line-height:24px;border-radius:3px;text-align:center;padding:12px 16px;position:relative;top:-6px;box-shadow:0 2px 4px rgba(0,0,0,.3);transition:box-shadow .3s cubic-bezier(.25,.8,.25,1),background .3s cubic-bezier(.25,.8,.25,1)}.discord-dialog__btn:hover{background:#8095de}.discord-dialog__btn:active{background:#677bc4}.discord-dialog__explainer{display:block;margin:2px 8px;color:#7289da;font-size:12px;text-align:right;top:-6px}.discord-dialog__explainer:hover{opacity:.8}.discord-dialog__explainer:active{opacity:.6}.discord-button{-webkit-tap-highlight-color:transparent;box-sizing:border-box;box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);position:fixed;bottom:0;right:0;z-index:50;margin:23.5px;padding:15.5px;border-radius:50%;background:#7289da;cursor:pointer;transition:box-shadow .3s cubic-bezier(.25,.8,.25,1),background .3s cubic-bezier(.25,.8,.25,1);display:flex;text-align:center;align-items:center;justify-content:center}.discord-button svg{height:28px;width:28px;transition:background .3s cubic-bezier(.25,.8,.25,1)}.discord-button svg path{fill:#fff}.discord-button:hover{box-shadow:0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23)}.discord-button:hover svg{opacity:.6}.discord-button:active{box-shadow:0 10px 20px rgba(0,0,0,.19),0 6px 6px rgba(0,0,0,.23)}.discord-button:active svg{opacity:.4}</style><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>poolp.org</span>
<img src=/img/poolp_bing.png width=512 height=512 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=poolp.org></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-bold text-gray-500 hover:text-gray-900">poolp.org</a><div class="text-sm text-neutral-700 dark:text-neutral-400"><br>Code, build and run.</div></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=https://github.com/poolpOrg/ target=_blank class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title>Github</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=https://github.com/poolpOrg/ target=_blank class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title>Github</p></a></li></ul><hr><ul class="flex mt-4 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li class=mb-1><a href=/categories/technology/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=technology>Technology</p></a></li><li class=mb-1><a href=/categories/music/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=music>Music</p></a></li><li class=mb-1><a href=/categories/personal/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=personal>Personal</p></a></li></ul></div></label></div></div><div class="main-menu flex pb-3 flex-col items-end justify-between md:justify-start space-x-3" style=margin-top:-15px><div class="hidden md:flex items-center space-x-5"><a href=/categories/technology/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title=technology>Technology</p></a><a href=/categories/music/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title=music>Music</p></a><a href=/categories/personal/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title=personal>Personal</p></a></div></div></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom" style=background-image:url(/posts/2023-10-07/plakar-a-ton-of-changes/feature_hu5a1df5d6cca77f0876c4c8749db3d7d6_139346_1200x0_resize_q75_box.jpeg)></div><br><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">Message to
<u><b><a href=https://github.com/sponsors/poolpOrg>github</a></b></u> and
<u><b><a href=https://www.patreon.com/gilles>patreon</a></b></u> sponsors:
<b>THANK YOU ❤️</b></span></div><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>poolp.org</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2023-10-07/plakar-a-ton-of-changes/>Plakar: a TON of changes</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Plakar: a TON of changes</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-10-07 09:29:00 +0200 +0200">7 October 2023</time><span class="px-2 text-primary-500">&#183;</span><span>4242 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">20 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/poolpOrg/poolp.org/tree/master/content/posts/2023-09_01/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/technology/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">technology</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/plakar/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">plakar</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/backups/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">backups</span></span></span></div></div><div class=flex><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/img/gilles_hu897fc9ad11a292e594efc0b9f1eaea51_1273455_192x192_fill_q75_box_center.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://poolp.org//authors/gilles class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Gilles Chehade</a><div class="text-sm text-neutral-700 dark:text-neutral-400">I&rsquo;m not a cat.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:gilles@poolp.org target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/poolpOrg target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/gilleschehade target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://social.poolp.org/@gilles target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.youtube.com/gilleschehade target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitch.tv/poolporg target=_blank aria-label=Twitch rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M391.17 103.47H352.54v109.7h38.63zM285 103H246.37V212.75H285zM120.83.0 24.31 91.42V420.58H140.14V512l96.53-91.42h77.25L487.69 256V0zM449.07 237.75l-77.22 73.12H294.61l-67.6 64v-64H140.14V36.58H449.07z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">If you like reading articles on this website,
<b>please ❤️</b> consider <b>sharing on social networks</b> to help increase visibility:
<b>this helps buy time for new articles and projects</b> !<section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;title=Plakar:%20a%20TON%20of%20changes" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;text=Plakar:%20a%20TON%20of%20changes" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;resubmit=true&amp;title=Plakar:%20a%20TON%20of%20changes" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;description=Plakar:%20a%20TON%20of%20changes" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;quote=Plakar:%20a%20TON%20of%20changes" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;subject=Plakar:%20a%20TON%20of%20changes" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;resubmit=true&amp;title=Plakar:%20a%20TON%20of%20changes" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;resubmit=true&amp;title=Plakar:%20a%20TON%20of%20changes" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section></span></div><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#optimized-go-fastcdc>Optimized <code>go-fastcdc</code></a><ul><li><a href=#buffered-io>Buffered I/O</a></li><li><a href=#reworked-next-to-reduce-allocations-and-copies>Reworked <code>Next()</code> to reduce allocations and copies</a></li><li><a href=#micro-optimized-fastcdc>Micro-optimized <code>FastCDC</code></a></li></ul></li><li><a href=#implemented-go-ultracdc>Implemented <code>go-ultracdc</code></a></li><li><a href=#implemented-go-ringbuffer>Implemented <code>go-ringbuffer</code></a></li><li><a href=#merged-go-fastcdc-and-go-ultracdc-into-go-cdc-chunkers-and-switched-plakar-to-it>Merged <code>go-fastcdc</code> and <code>go-ultracdc</code> into <code>go-cdc-chunkers</code> and switched <code>plakar</code> to it</a></li><li><a href=#made-compression-and-hashing-algorithm-configurable>Made compression and hashing algorithm configurable</a></li><li><a href=#initial-support-for-a-plakar-config>Initial support for a <code>plakar config</code></a></li><li><a href=#lots-of-work-on-the-index-format>Lots of work on the index format</a></li><li><a href=#refactor-snapshots-and-storage-layers>Refactor snapshots and storage layers</a></li><li><a href=#whats-next->What&rsquo;s next ?</a></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#optimized-go-fastcdc>Optimized <code>go-fastcdc</code></a><ul><li><a href=#buffered-io>Buffered I/O</a></li><li><a href=#reworked-next-to-reduce-allocations-and-copies>Reworked <code>Next()</code> to reduce allocations and copies</a></li><li><a href=#micro-optimized-fastcdc>Micro-optimized <code>FastCDC</code></a></li></ul></li><li><a href=#implemented-go-ultracdc>Implemented <code>go-ultracdc</code></a></li><li><a href=#implemented-go-ringbuffer>Implemented <code>go-ringbuffer</code></a></li><li><a href=#merged-go-fastcdc-and-go-ultracdc-into-go-cdc-chunkers-and-switched-plakar-to-it>Merged <code>go-fastcdc</code> and <code>go-ultracdc</code> into <code>go-cdc-chunkers</code> and switched <code>plakar</code> to it</a></li><li><a href=#made-compression-and-hashing-algorithm-configurable>Made compression and hashing algorithm configurable</a></li><li><a href=#initial-support-for-a-plakar-config>Initial support for a <code>plakar config</code></a></li><li><a href=#lots-of-work-on-the-index-format>Lots of work on the index format</a></li><li><a href=#refactor-snapshots-and-storage-layers>Refactor snapshots and storage layers</a></li><li><a href=#whats-next->What&rsquo;s next ?</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><blockquote><b>TL;DR:</b><br>TL;DR:
a lot of work in plakar,
but also on CDC and index optimization.</blockquote><div id=optimized-go-fastcdc class=anchor></div><h1 class="relative group">Optimized <code>go-fastcdc</code>
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optimized-go-fastcdc aria-label=Anchor>#</a></span></h1><p><strong>I ran into a benchmark which included my implementation of the <a href=https://www.usenix.org/system/files/conference/atc16/atc16-paper-xia.pdf target=_blank>FastCDC</a> algorithm,
and it made me realise that it was not on par with alternative implementations</strong>:</p><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gpt-4/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gpt-4:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm"><p>Hold up! Before we dive deeper, let&rsquo;s demystify CDC a bit. CDC stands for Content-Defined Chunking. Imagine you&rsquo;re trying to find the best places to split a chocolate bar so that each piece has a nut (or not, if you&rsquo;re not into that). That&rsquo;s kinda what CDC does, but with data. Cool, huh?</p><p>The FastCDC algorithm is a nifty tool used for content-defined chunking. Think of it as a way to split data into chunks based on the content, rather than fixed sizes. Super useful for things like deduplication!</p></div></div></div></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>cd</span> _bench_test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>go</span> test <span style=color:#ff79c6>-</span>bench<span style=color:#ff79c6>=.</span> <span style=color:#ff79c6>-</span>benchmem
</span></span><span style=display:flex><span>goos: darwin
</span></span><span style=display:flex><span>goarch: amd64
</span></span><span style=display:flex><span>pkg: bench_test
</span></span><span style=display:flex><span>cpu: Intel(R) Core(TM) i5<span style=color:#ff79c6>-</span><span style=color:#bd93f9>5287</span>U CPU <span style=color:#8be9fd;font-style:italic>@</span> <span style=color:#8be9fd;font-style:italic>2</span><span style=color:#bd93f9>.90</span>GHz
</span></span><span style=display:flex><span>BenchmarkAskeladdk<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>               <span style=color:#bd93f9>14</span>      <span style=color:#bd93f9>81648896</span> ns<span style=color:#f1fa8c>/op    1643.84 MB/s</span>         <span style=color:#bd93f9>13014</span> chunks        <span style=color:#bd93f9>9364</span> B<span style=color:#f1fa8c>/op           0 allocs/o</span>p
</span></span><span style=display:flex><span>BenchmarkTigerwill90<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>             <span style=color:#bd93f9>12</span>      <span style=color:#bd93f9>99914431</span> ns<span style=color:#f1fa8c>/op    1343.33 MB/s</span>         <span style=color:#bd93f9>16027</span> chunks       <span style=color:#bd93f9>10985</span> B<span style=color:#f1fa8c>/op           1 allocs/o</span>p
</span></span><span style=display:flex><span>BenchmarkJotFS<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>                   <span style=color:#bd93f9>10</span>     <span style=color:#bd93f9>107616777</span> ns<span style=color:#f1fa8c>/op    1247.18 MB/s</span>         <span style=color:#bd93f9>14651</span> chunks      <span style=color:#bd93f9>131184</span> B<span style=color:#f1fa8c>/op           2 allocs/o</span>p
</span></span><span style=display:flex><span>BenchmarkPoolpOrg<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>                 <span style=color:#bd93f9>4</span>     <span style=color:#bd93f9>251425674</span> ns<span style=color:#f1fa8c>/op     533.83 MB/s</span>         <span style=color:#bd93f9>14328</span> chunks    <span style=color:#bd93f9>144083696</span> B<span style=color:#f1fa8c>/op       42990 allocs/o</span>p
</span></span><span style=display:flex><span>PASS
</span></span><span style=display:flex><span>ok      bench_test    <span style=color:#bd93f9>8.210</span>s
</span></span></code></pre></div><p><strong>The benchmark showed that my implementation was considerably slower than three other popular implementations,
it also required far more memory and allocations per op.</strong>
I didn&rsquo;t expect it to outperform other implementations because I had focused on getting it functional and didn&rsquo;t even look at performances,
but I was surprised by how bad it was&mldr; so an hour later I fixed the injustice:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span>BenchmarkPoolpOrg<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>                <span style=color:#bd93f9>14</span>      <span style=color:#bd93f9>78039244</span> ns<span style=color:#f1fa8c>/op    1719.87 MB/s</span>         <span style=color:#bd93f9>15485</span> chunks       <span style=color:#bd93f9>131200</span> B<span style=color:#f1fa8c>/op           4 allocs/o</span>p
</span></span></code></pre></div><p>Now that my implementation no longer lags behind the others and can actually outperform even the top contender in the list,
I can write the following without it sounding like a lame excuse:
this benchmark was not really fair to JotFS and my implementation.</p><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gpt-4/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gpt-4:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm">Speaking of benchmarks, it&rsquo;s always a fun exercise to see how different algorithms stack up against each other. While FastCDC has its merits, there are other contenders in the ring too. Each with its own set of strengths and quirks. But hey, variety is the spice of life, right?</div></div></div></div><p>First,
the top contender state that in this unscientific benchmark their implementation is 20% faster than the next best implementation,
however their implementation took shortcuts:</p><blockquote><p>Unlike other implementations it is not possible to tweak the parameters. This is not needed because there is a sweet spot of practical chunk sizes that enables efficient deduplication: Too small reduces performance due to overhead and too high reduces deduplication due to overly coarse chunks. Hence, chunks are sized between 2KB and 64KB with an average of about 10KB (2KB + 8KB). The final chunk can be smaller than 2KB. Normalized chunking as described in the paper is not implemented because it does not appear to improve deduplication.</p></blockquote><p>Then,
the top two implementations do not provide a usable API,
they benchmark the FastCDC algorithm by itself in a copy-less pattern:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>n, err <span style=color:#ff79c6>:=</span> fastcdc.<span style=color:#50fa7b>Copy</span>(w, r)
</span></span></code></pre></div><p>where the chunks are split from a <code>Reader</code> stream and written in sequence to a <code>Writer</code>,
without the ability to intercept them and process them in any meaniningful way&mldr;
why even apply FastCDC and not <code>io.Copy()</code> ?</p><p>As soon as you want to make something useful of the chunking,
it implies being able to return the individual chunks to a caller,
which means additional overhead of somehow passing the data in a buffer from the chunker to the caller&mldr;
which JotFS and my implementation do.</p><p>Anyways,
I closed the gap so I can speak freely my mind on this and warn that benchmarks should be taken carefully when you don&rsquo;t have a close understanding of what is being measured,
and I will also provide a <code>Copy()</code> method so that I can actually benchmark my raw FastCDC implementation as was done by others and measure the overhead of my API to expose chunks.</p><div id=buffered-io class=anchor></div><h2 class="relative group">Buffered I/O
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#buffered-io aria-label=Anchor>#</a></span></h2><p>First,
I replaced the chunker input from an <code>io.Reader</code> to a <code>bufio.Reader</code>,
letting the stdlib take care of buffering input and reducing the number of syscalls required.
I don&rsquo;t know why I didn&rsquo;t use a <code>bufio.Reader</code> to start with,
I wouldn&rsquo;t skip <code>stdio</code> in C to do I/O buffering on my own&mldr;
yet I did in Golang.</p><div id=reworked-next-to-reduce-allocations-and-copies class=anchor></div><h2 class="relative group">Reworked <code>Next()</code> to reduce allocations and copies
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#reworked-next-to-reduce-allocations-and-copies aria-label=Anchor>#</a></span></h2><p>Then,
I replaced the logic in the <code>Next()</code> method of the chunker which is in charge of returning the next chunk.
When it relied on an <code>io.Reader</code>,
it had to read the data,
so my algorithm had to read twice as much as the maximum chunk size so the FastCDC function could find a cut point within that buffer,
which would then allow me to copy and shift data.
With the change to a <code>bufio.Reader</code>,
I could peak into the input buffer,
pass the result to FastCDC,
return a slice of the input buffer up to the cutpoint and discard.
This considerably reduces the overhead and is as optimal as I can get with I/O as far as I can tell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (chunker <span style=color:#ff79c6>*</span>Chunker) <span style=color:#50fa7b>Next</span>() ([]<span style=color:#8be9fd>byte</span>, <span style=color:#8be9fd>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// chunkder.rd is a bufio with a buffersize that&#39;s 2*chunker.maxSize
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// so I can always peek chunker.maxSize safely while avoiding allocs
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// and not wasting too many memory either.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>//
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// data is a slice in bufio&#39;s buffer so it&#39;s not a &#34;real&#34; allocation
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>//
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	data, err <span style=color:#ff79c6>:=</span> chunker.rd.<span style=color:#50fa7b>Peek</span>(chunker.maxSize)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> <span style=color:#ff79c6>&amp;&amp;</span> err <span style=color:#ff79c6>!=</span> io.EOF <span style=color:#ff79c6>&amp;&amp;</span> err <span style=color:#ff79c6>!=</span> bufio.ErrBufferFull {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	n <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>len</span>(data)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> n <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>, io.EOF
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	cutpoint <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>fastCDC</span>(chunker.options, data[:n], n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// we already have data available in a slice coming directly
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// from bufio&#39;s buffer, we don&#39;t need to read again, just do
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// a Discard() so bufio skips the bytes we&#39;ll return.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> _, err = chunker.rd.<span style=color:#50fa7b>Discard</span>(<span style=color:#8be9fd;font-style:italic>int</span>(cutpoint)); err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// return a slice on the slice from Peek
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>return</span> data[:cutpoint], <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div id=micro-optimized-fastcdc class=anchor></div><h2 class="relative group">Micro-optimized <code>FastCDC</code>
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#micro-optimized-fastcdc aria-label=Anchor>#</a></span></h2><p>Finally,
I micro-optimized the <code>FastCDC</code> function to go from this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (chunker <span style=color:#ff79c6>*</span>Chunker) <span style=color:#50fa7b>fastCDC</span>(src <span style=color:#ff79c6>*</span>bytes.Buffer, n <span style=color:#8be9fd>uint32</span>) <span style=color:#8be9fd>uint32</span> {
</span></span><span style=display:flex><span>        NormalSize <span style=color:#ff79c6>:=</span> chunker.NormalSize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        MaskS <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>uint64</span>(<span style=color:#bd93f9>0x0003590703530000</span>)
</span></span><span style=display:flex><span>        MaskL <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>uint64</span>(<span style=color:#bd93f9>0x0000d90003530000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> n <span style=color:#ff79c6>&lt;=</span> chunker.MinSize {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span> n
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> n <span style=color:#ff79c6>&gt;=</span> chunker.MaxSize {
</span></span><span style=display:flex><span>                n = chunker.MaxSize
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> n <span style=color:#ff79c6>&lt;=</span> NormalSize {
</span></span><span style=display:flex><span>                NormalSize = n
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        fp <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>uint64</span>(<span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>        i <span style=color:#ff79c6>:=</span> chunker.MinSize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> ; i &lt; NormalSize; i<span style=color:#ff79c6>++</span> {
</span></span><span style=display:flex><span>                fp = (fp <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>+</span> G[src.<span style=color:#50fa7b>Bytes</span>()[i]]
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> (fp <span style=color:#ff79c6>&amp;</span> MaskS) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span> {
</span></span><span style=display:flex><span>                        <span style=color:#ff79c6>return</span> i
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> ; i &lt; n; i<span style=color:#ff79c6>++</span> {
</span></span><span style=display:flex><span>                fp = (fp <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>+</span> G[src.<span style=color:#50fa7b>Bytes</span>()[i]]
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> (fp <span style=color:#ff79c6>&amp;</span> MaskL) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span> {
</span></span><span style=display:flex><span>                        <span style=color:#ff79c6>return</span> i
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> i
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>To this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// prototype has changed, it receives a []byte rather than a bytes.Buffer
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>FastCDC) <span style=color:#50fa7b>Algorithm</span>(options <span style=color:#ff79c6>*</span>chunkers.ChunkerOpts, data []<span style=color:#8be9fd>byte</span>, n <span style=color:#8be9fd>int</span>) <span style=color:#8be9fd>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// since MinSize, MaxSize and NormalSize are going to be accessed several times,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// assign to local variables and save a few struct dereferences
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>//
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	MinSize <span style=color:#ff79c6>:=</span> options.MinSize
</span></span><span style=display:flex><span>	MaxSize <span style=color:#ff79c6>:=</span> options.MaxSize
</span></span><span style=display:flex><span>	NormalSize <span style=color:#ff79c6>:=</span> options.NormalSize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// constify MaskS and MaskL, this avoids setting in the stack at each call
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#8be9fd;font-style:italic>const</span> (
</span></span><span style=display:flex><span>		MaskS = <span style=color:#8be9fd;font-style:italic>uint64</span>(<span style=color:#bd93f9>0x0003590703530000</span>)
</span></span><span style=display:flex><span>		MaskL = <span style=color:#8be9fd;font-style:italic>uint64</span>(<span style=color:#bd93f9>0x0000d90003530000</span>)
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// readability change
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>switch</span> {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> n <span style=color:#ff79c6>&lt;=</span> MinSize:
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> n
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> n <span style=color:#ff79c6>&gt;=</span> MaxSize:
</span></span><span style=display:flex><span>		n = MaxSize
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> n <span style=color:#ff79c6>&lt;=</span> NormalSize:
</span></span><span style=display:flex><span>		NormalSize = n
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	fp <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>uint64</span>(<span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>	i <span style=color:#ff79c6>:=</span> MinSize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// instead of having two loops, one from i to NormalSize with MaskS
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// and one from NormalSize to n with MaskL, use a variable that has
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// a toggle point in a simple loop.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>//
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// since I&#39;m 100% positive the buffer is n bytes long, I can switch
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// to pointer arithmetics and avoid Golang checks that an index has
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// not exceeded an array capacity.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>//
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	mask <span style=color:#ff79c6>:=</span> MaskS
</span></span><span style=display:flex><span>	p <span style=color:#ff79c6>:=</span> unsafe.<span style=color:#50fa7b>Pointer</span>(<span style=color:#ff79c6>&amp;</span>data[<span style=color:#bd93f9>0</span>])
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>for</span> ; i &lt; n; i<span style=color:#ff79c6>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> i <span style=color:#ff79c6>==</span> NormalSize {
</span></span><span style=display:flex><span>			mask = MaskL
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		fp = (fp <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>+</span> G[<span style=color:#ff79c6>*</span>(<span style=color:#ff79c6>*</span><span style=color:#8be9fd>byte</span>)(p)]
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> (fp <span style=color:#ff79c6>&amp;</span> mask) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>return</span> i
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		p = unsafe.<span style=color:#50fa7b>Pointer</span>(<span style=color:#8be9fd;font-style:italic>uintptr</span>(p) <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> i
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It may seem like a lot of work but the function being small to begin with,
it was just a matter of thinking about the cost of each line and how to squeeze a bit of perfs,
then benchmark a change and see if it brought significant gains or should be reverted before applying another change.</p><div id=implemented-go-ultracdc class=anchor></div><h1 class="relative group">Implemented <code>go-ultracdc</code>
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implemented-go-ultracdc aria-label=Anchor>#</a></span></h1><p>I wrote my <code>go-fastcdc</code> implementation sometime in 2021,
and back then <a href=https://www.usenix.org/system/files/conference/atc16/atc16-paper-xia.pdf target=_blank>FastCDC</a> was the state-of-the-art algorithm for CDC (as far as I knew).</p><p>I won&rsquo;t spend much time explaining how it works,
there&rsquo;s a paper that&rsquo;s readily available and that describes how it works and how it compares to others.
Basically it was not a brand new method but a set of optimization applied to top of a previously published method to boost its performances.</p><p>I started using my package in <code>plakar</code> and focused on other tasks,
given that CDC is very important but far from being the key feature,
so I didn&rsquo;t pay attention when some of the researchers behind the FastCDC algorithm published <a href=https://ieeexplore.ieee.org/document/9894295 target=_blank>a new paper describing the UltraCDC algorithm</a>&mldr;
a few months later in 2022.</p><p>Unlike FastCDC,
the UltraCDC method relies on a completely different approach rather than optimizations of an existing method,
and announces chunking speed from 1.5 to 10x faster than the state-of-the-art CDC approaches,
with comparable or higher deduplication ratio.</p><p>So I was like:
SAY NO MORE SCIENTISTS,
WHERE DO I SIGN ?</p><p>I couldn&rsquo;t find the paper in the wild,
it was hidden behind a racket-wall at IEEE,
unavailable in the closest sci-hub.
I couldn&rsquo;t find how to contact the authors,
so I eventually caved in and paid the ~$30 tax which is probably used to pay authors fairly (lol).</p><p>Anyways,
I eventually implemented the paper in a <code>go-ultracdc</code> package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span>goos: darwin
</span></span><span style=display:flex><span>goarch: arm64
</span></span><span style=display:flex><span>pkg: github<span style=color:#ff79c6>.</span>com<span style=color:#f1fa8c>/PlakarLabs/go</span><span style=color:#ff79c6>-</span>ultracdc
</span></span><span style=display:flex><span>Benchmark<span style=color:#ff79c6>-</span><span style=color:#bd93f9>8</span>           <span style=color:#bd93f9>48</span>          <span style=color:#bd93f9>24678812</span> ns<span style=color:#f1fa8c>/op        5438.58 MB/s</span>          <span style=color:#bd93f9>7929</span> chunks         <span style=color:#bd93f9>131200</span> B<span style=color:#f1fa8c>/op          4 allocs/o</span>p
</span></span><span style=display:flex><span>PASS
</span></span><span style=display:flex><span>ok      github<span style=color:#ff79c6>.</span>com<span style=color:#f1fa8c>/PlakarLabs/go</span><span style=color:#ff79c6>-</span>ultracdc       <span style=color:#bd93f9>1.662</span>s
</span></span></code></pre></div><p>The results were initially lovely,
but it turns out that it doesn&rsquo;t necessarily translates to better performances on my use-case.
As you can see, there are far less chunks,
because the average chunk size has slighly increased,
and for some reason this translates to slower backups in <code>plakar</code> despite faster chunking.
I still need to investigate why to get an actual understanding beyond observations,
so at this point <code>plakar</code> is still FastCDC-powered.</p><p>The <code>go-ultracdc</code> implementation benefited from the optimizations made in the <code>Next()</code> method for <code>go-fastcdc</code>,
and some optimizations I had applied to the <code>fastCDC</code> function,
but unintuitively not all optimizations produced the same benefits and I reverted some to favour readability.</p><p>Anyways,
at this point I had UltraCDC at hands and published an ISC-licensed implementation.</p><div id=implemented-go-ringbuffer class=anchor></div><h1 class="relative group">Implemented <code>go-ringbuffer</code>
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implemented-go-ringbuffer aria-label=Anchor>#</a></span></h1><p><strong>A general performance bottleneck in CDC algorithms is that you are looking for cut points in a stream of bytes for which you have to read-ahead a certain amount</strong>.
Once you find a cut point in between the beginning of the buffer and the end of your read-ahead,
you end up with left-over bytes that should be the beginning of your next chunk.
A naive approach would be to move these left-over bytes at the beginning of the buffer,
but this means that at each iteration of the <code>Next()</code> method you read the left-over bytes twice and copy them once.
An alternative would be to leave them where they are and allocate more memory behind to serve the next chunk,
which may or may not be possible and which may or may not impose a copy.</p><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gpt-4/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gpt-4:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm">Buffer talk! Imagine you&rsquo;re reading a book but can peek a few pages ahead. That&rsquo;s kind of what a read-ahead buffer does with data. Tweaking how you handle that peeking can make a world of difference.</div></div></div></div><p>There are several ways to tackle this, each with pros and cons,
and an article on its own would be needed to discuss the topic.
However,
in an effort to squeeze performances further,
I had the intuition that if I could replace the <code>bufio.Reader</code> with a ringbuffer
it would boost performances by avoiding data shifting and buffer resizes.</p><p>A ring buffer is a buffer of fixed length which maintains cursors for the beginning and the end of data within that buffer,
wrapping around the actual data end so that it may reach the end of buffer and continue at the beginning of the buffer as long as it doesn&rsquo;t overlap with the beginning cursor again.
I won&rsquo;t explain much more,
<a href=https://en.wikipedia.org/wiki/Circular_buffer target=_blank>this Wikipedia article which I didn&rsquo;t read</a> probably does a better job at explaining it than me :-)</p><img src=https://upload.wikimedia.org/wikipedia/commons/f/fd/Circular_Buffer_Animation.gif><p>My assumption was that since a chunker will not return more than the maximum size of a chunk,
then a ringbuffer that&rsquo;s the size of a maximum chunk can provide the guarantees I need without reallocations and without shifting.
If the ringbuffer is filled with MaxSize bytes,
the cutpoint is guaranteed to be somewhere between the beginning cursor and MaxSize,
when they are consumed it moves the cursor to the cutpoint and the ringbuffer can be refilled with as many bytes as were read starting from after the left-over bytes.
This avoids any shifting,
guarantees that there are no reallocations,
and basically seems optimal on paper.
Furthermore,
you can control I/O pressure easily,
for example by assigning a ringbuffer size of 2 (or 3, or 4) * MaxSize,
ensuring that there are two chunks of read-ahead and reducing the frequency of having to refill the buffer and hitting the underlying <code>Reader</code>.</p><p>The ringbuffer could be made to look like a <code>Reader</code>,
so that it could be swapped wherever I needed easily,
and so I implemented <code>go-ringbuffer</code> which provided the semantic I needed&mldr;
which proved to be one of the greatest idea I had ever had.</p><p>Nope.
Actually,
it turned out that my intuition was buillshit.
The performances dropped faster than the price of a Bored Ape NFT.
Performances are far better with <code>bufio</code> and whatever it does than with the refilling required by my ringbuffer.
I have hypothesis that could explain why,
but I didn&rsquo;t bother confirming yet because they seemed obvious to me in retrospect and I didn&rsquo;t want to waste more time on this.</p><p>The ringbuffer implementation can still prove useful,
just not for this specific use-case.</p><div id=merged-go-fastcdc-and-go-ultracdc-into-go-cdc-chunkers-and-switched-plakar-to-it class=anchor></div><h1 class="relative group">Merged <code>go-fastcdc</code> and <code>go-ultracdc</code> into <code>go-cdc-chunkers</code> and switched <code>plakar</code> to it
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#merged-go-fastcdc-and-go-ultracdc-into-go-cdc-chunkers-and-switched-plakar-to-it aria-label=Anchor>#</a></span></h1><p>Given that I already had two CDC implementations,
both following the same interface,
I decided to merge them into a common <code>go-cdc-chunkers</code> project which is ISC-licensed.</p><p>This will allow me to reduce my workload by maintaining a single project,
while making it easier to experiment with new CDC chunkers and malking sure that general optimizations apply to all my implementations.</p><a target=_blank href=https://github.com/PlakarLabs/go-cdc-chunkers class=cursor-pointer><div class="w-full md:w-auto pt-3 p-5 border border-neutral-200 dark:border-neutral-700 border rounded-md backdrop-blur shadow-2xl"><div class="flex items-center"><span class="text-2xl text-neutral-800 dark:text-neutral" style=margin-right:10px><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><div class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">PlakarLabs/go-cdc-chunkers</div></div><p class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">A Golang package that implements CDC chunkers with a generic interface</p><div class="m-0 mt-2 flex items-center"><span class="mr-1 inline-block h-3 w-3 rounded-full" style=background-color:#00add8></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">Go</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M287.9.0C297.1.0 305.5 5.25 309.5 13.52L378.1 154.8l153.3 22.7C540.4 178.8 547.8 185.1 550.7 193.7 553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4l26.3 155.5C461.4 492.9 457.7 502.1 450.2 507.4 442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9 150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4 118.2 502.1 114.5 492.9 115.1 483.9l27.1-155.5L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7 28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8 266.3 13.52C270.4 5.249 278.7.0 287.9.0zm0 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9 184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7l105.2-56.2C283.7 383.7 292.2 383.7 299.2 387.5l105.2 56.2-20.2-119.6C382.9 316.4 385.5 308.5 391 303l85.9-85.1-118.3-17.4C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg></span></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M80 104c13.3.0 24-10.7 24-24S93.3 56 80 56 56 66.7 56 80s10.7 24 24 24zm80-24c0 32.8-19.7 61-48 73.3V192c0 17.7 14.3 32 32 32H304c17.7.0 32-14.3 32-32V153.3C307.7 141 288 112.8 288 80c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V192c0 53-43 96-96 96H256v70.7c28.3 12.3 48 40.5 48 73.3.0 44.2-35.8 80-80 80s-80-35.8-80-80c0-32.8 19.7-61 48-73.3V288H144c-53 0-96-43-96-96V153.3C19.7 141 0 112.8.0 80 0 35.8 35.8.0 80 0s80 35.8 80 80zm208 24c13.3.0 24-10.7 24-24s-10.7-24-24-24-24 10.7-24 24 10.7 24 24 24zM248 432c0-13.3-10.7-24-24-24s-24 10.7-24 24 10.7 24 24 24 24-10.7 24-24z"/></svg></span></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div></div></div></a><p>Now that I had <code>go-cdc-chunkers</code> available which would allow me to experiment with different CDC algorithms and settings,
I switched <code>plakar</code> to using it as a dependency rather than <code>go-fastcdc</code>.
It defaults to the FastCDC implementation,
but I no longer have to swap dependencies and imports all around whenever I want to test something.</p><div id=made-compression-and-hashing-algorithm-configurable class=anchor></div><h1 class="relative group">Made compression and hashing algorithm configurable
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#made-compression-and-hashing-algorithm-configurable aria-label=Anchor>#</a></span></h1><p>By default,
<code>plakar</code> compresses data and indexes before they are sent to the repository.
This makes sense since CDC deduplication is a kind of compression,
and I can&rsquo;t see a reason why you&rsquo;d want to CDC deduplicate but not compress.</p><p>I chose <code>gzip</code> as the compression method primarily because during development it was easy to <code>gzcat</code> a chunk in the repository and make sure3 it was as expected:
most modern systems comes with several tools that manipulate <code>gzip</code> files easily (<code>zcat</code>, <code>zless</code>, &mldr;).
But as I started working on various optimizations,
I profiled <code>plakar</code> and realised that <code>gzip</code> was much heavier than I originally assumed.
I gave a test to <code>lz4</code> which is a good trade-off,
and which improved the profile considerably&mldr;
so I decided to make the compression algorithm selectable at the repository level and use <code>lz4</code> by default now that I no longer spend so much time inspecting chunks manually.</p><p>Right now,
only <code>gzip</code> and <code>lz4</code> are available,
but the plumbing to allow future improvements is there now.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> create <span style=color:#ff79c6>-</span>compression gzip
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span>
</span></span></code></pre></div><p>Since had I already made compression configurable,
I decided to do the same with the hashing algorithm since <code>plakar</code> relies HEAVILY on hashing.</p><p>At this point,
it was not so much about efficiency and performances,
but more about getting the plumbing right so if I had to change the algorithm tomorrow due to a security weakness in <code>sha256</code> it wouldn&rsquo;t require a huge refactor.
I decided to implement a Hashing layer,
whose algorithm is selected at the repository level,
and adapted the code to rely on that method rather than calling <code>sha256</code> directly when needed.</p><p>To validate my test,
I created a repository configured to use <code>blake3</code> rather than <code>sha256</code> and validated that it works.
This is an easy case because I selected a 32-bytes digest for both,
but it&rsquo;s a first step towards the direction of not hardcoding a method.
As of now,
the index layer expects digests to be 32-bytes long,
and it would require a bit of work to dynamically pick a specific index structure based on the digest length.
It&rsquo;s very likely an hour of work or so,
I just don&rsquo;t have an incentive to spend that hour now,
particularly because I&rsquo;m doing other things with the index at the moment and don&rsquo;t want two simultaneous projects on the same layer.</p><p>So now,
you can technically switch a repository to use <code>blake3</code> which is faster and more efficient on resources,
even though at the moment I prefer to keep <code>sha256</code> the default as I have had no look at the current state of crypto in a while and can&rsquo;t take a proper decision on this by myself at the moment.</p><div id=initial-support-for-a-plakar-config class=anchor></div><h1 class="relative group">Initial support for a <code>plakar config</code>
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-support-for-a-plakar-config aria-label=Anchor>#</a></span></h1><p>A problem with <code>plakar</code> currently is that it doesn&rsquo;t support a configuration file,
so there&rsquo;s no way to keep the command line short.</p><p>For example,
I have a repository on my NAS,
and if I want to push to it then my command line is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> on ssh:<span style=color:#f1fa8c>//gi</span>lles<span style=color:#8be9fd;font-style:italic>@nas</span><span style=color:#ff79c6>.</span>poolp<span style=color:#ff79c6>.</span>org<span style=color:#f1fa8c>/var/</span>backups<span style=color:#f1fa8c>/plakar push /</span>home<span style=color:#ff79c6>/</span>gilles
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span>
</span></span></code></pre></div><p>If I want to synchronize this with another repository,
I&rsquo;d need to provide the two URLS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> on ssh:<span style=color:#f1fa8c>//gi</span>lles<span style=color:#8be9fd;font-style:italic>@nas</span><span style=color:#ff79c6>.</span>poolp<span style=color:#ff79c6>.</span>org<span style=color:#f1fa8c>/var/</span>backups<span style=color:#f1fa8c>/plakar sync to ssh://gilles@offsite.poolp.org/</span>var<span style=color:#f1fa8c>/backups/</span>plakar
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span>
</span></span></code></pre></div><p>So I began basic support for an OPTIONAL configuration file,
<code>~/.plakarconfig</code>,
which is absolutely not required but allows storing informations that can be resolved by plakar.</p><p>I chose a <code>yaml</code> format and plugged a <code>config</code> subcommand,
similar to <code>git config</code>,
to populate the configuration.</p><p>For now it&rsquo;s not really used,
but I did a proof of concept to show how it could work,
allowing the setting of a name for repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> config repository nas location ssh:<span style=color:#f1fa8c>//gi</span>lles<span style=color:#8be9fd;font-style:italic>@nas</span><span style=color:#ff79c6>.</span>poolp<span style=color:#ff79c6>.</span>org<span style=color:#f1fa8c>/var/</span>backups<span style=color:#ff79c6>/</span>plakar
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> config repository offsite location ssh:<span style=color:#f1fa8c>//gi</span>lles<span style=color:#8be9fd;font-style:italic>@offsite</span><span style=color:#ff79c6>.</span>poolp<span style=color:#ff79c6>.</span>org<span style=color:#f1fa8c>/var/</span>backups<span style=color:#ff79c6>/</span>plakar
</span></span></code></pre></div><p>which would turn the previous commands into:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-t data-lang=t><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> on <span style=color:#8be9fd;font-style:italic>@nas</span> <span style=color:#8be9fd;font-style:italic>push</span> <span style=color:#f1fa8c>/home/gi</span>lles
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>%</span> <span style=color:#8be9fd;font-style:italic>plakar</span> on <span style=color:#8be9fd;font-style:italic>@nas</span> sync to <span style=color:#8be9fd;font-style:italic>@offsite</span>
</span></span></code></pre></div><p>This is just the beginning and I may change my mind a lot around how this is meant to be used,
feel free to command and share ideas.</p><p>One idea I already have is that the configuration may be read from a different backend then <code>~/.plakarconfig</code>,
allowing it to be shared from a central configuration to a set of users.
It was prepared to support this even though it&rsquo;s not in my plans at the moment.</p><div id=lots-of-work-on-the-index-format class=anchor></div><h1 class="relative group">Lots of work on the index format
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#lots-of-work-on-the-index-format aria-label=Anchor>#</a></span></h1><p>I spent a fair amount of time working in improving the index format with two goals:</p><ul><li>reducing the memory footprint as the index needs to fit in memory</li><li>while making it possible for future work to shard the index</li></ul><p>Summing up the work is hard because there&rsquo;s been a TON of experimenting and maths to estimate scaling,
as well as a LOT of braindump on my discord server,
but I&rsquo;m not finished even though I have an already clear path where I&rsquo;m going with this.</p><p>After a week of work,
I almost halved the memory required to fit the index,
and it is mostly shardable at this point.
There are many ideas that still need to go in before I&rsquo;m happy.</p><p><strong>The best features in <code>plakar</code> are really dependant on the ability of having an efficient index</strong>.
I could immediately give up on this and provide very fast backup and recovery,
by dropping the index,
but this would mean that features like file-level restore,
diff between files in different snapshots,
the snapshots browser or even search would go away.</p><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gpt-4/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gpt-4:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm">And speaking of efficient indexes, think of them as the super-smart librarians of the digital world. Without them, finding that one piece of data would be like searching for a needle in a haystack. With plakar, it&rsquo;s more like searching for an elephant in a room. Hard to miss!</div></div></div></div><p>In my bigger plan,
the index is a key element of snapshots,
and it is essential that I take proper time to make it scalable WAY BEYOND expectations both in terms of resources required to operate and access time.</p><p>At the current time,
<code>plakar</code> can backup pretty much any volume of data,
but backups > 100G already require around 1GB of RAM to create and as much to restore &mldr; with an additional overhead of deserializing the index in memory.
This is what I&rsquo;m currently working on optimizing,
because once it falls in a reasonnsable range,
we get scalable backups with a TON of nice features that are instant-time for the most part.</p><div id=refactor-snapshots-and-storage-layers class=anchor></div><h1 class="relative group">Refactor snapshots and storage layers
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#refactor-snapshots-and-storage-layers aria-label=Anchor>#</a></span></h1><p>A snapshot consists of <code>METADATA</code>, an <code>INDEX</code> and a <code>FILESYSTEM</code>.</p><p>Each one covers a specific kind of data access:
<code>METADATA</code> is for summaries,
<code>INDEX</code> is for finding the chunks necessary to reconstruct a specific object behind a filename regardless of filesystem structure,
<code>FILESYSTEM</code> is for browsing through a filesystem structure and obtaining stat info regardless of actual data.</p><p>Technically,
it could be summarised as:
if you want a summary, you&rsquo;re using the <code>METADATA</code>,
if you want to access data, you&rsquo;re using the <code>INDEX</code>,
if you want to browse files and see how they are related one to another, you&rsquo;re using the <code>FILESYSTEM</code>.
So when you list all your snapshots,
you actually access their <code>METADATA</code>,
when you call <code>plakar ls</code> on a specific snapshot you access its <code>FILESYSTEM</code>,
and when you call <code>plakar cat</code> on a specific file you access the <code>INDEX</code>.</p><p>This wasn&rsquo;t entirely true because the <code>INDEX</code> contained the three of them before I did a split,
and there were leftovers from the move.
So a first refactor was to manage to make the <code>INDEX</code> completely unaware of the filesystem structure,
removing anything unnecessary to shrink it,
while also making sure that I could reconstruct a file from a pathname using the <code>INDEX</code> only without ever loading the <code>FILESYSTEM</code>&mldr;
and without replicating all pathnames from the <code>FILESYSTEM</code> in the index.</p><p>The second issue is that the snapshot object in the snapshot layer assumed the loading of <code>METADATA</code>, <code>INDEX</code> and <code>FILESYSTEM</code>,
so whenever loading a snapshot to perform a command like <code>plakar cat</code> or <code>plakar ls</code>,
there would be an unnecessary overhead in memory consumption but also in terms of time necessary to load this info and deserialize in memory.</p><p>Most notably,
<code>plakar cat</code> relied on <code>snapshot.NewReader(pathname string)</code> which exposes a reader that fetches chunks as they&rsquo;re accessed,
but given that it&rsquo;s exposed from snapshot,
<code>plakar cat</code> requires the loading of <code>METADATA</code>, <code>INDEX</code> and <code>FILESYSTEM</code> when all it needs is in <code>INDEX</code>.
There was no easy fix,
a refactor was needed so that the <code>Reader</code> is a storage reader taking an index in parameter,
allowing to obtain a <code>Reader</code> from the storage as long as you have an index regardless if you have a snapshot.</p><p>To achieve this required doing a LOT of other simplications in the snapshot and storage layers,
which was&mldr; tricky&mldr; but ultimately it works:
the code is simpler and it paves the road for better performances.</p><p>I updated <code>plakar ls</code> and <code>plakar cat</code> so the first one can work with a <code>FILESYSTEM</code> without loading the <code>INDEX</code>,
and the second can work with an <code>INDEX</code> without loading a <code>FILESYSTEM</code>,
this reduces memory requirements and is essentially a proof of concept that <code>plakar</code> now allows finer granularity on what it needs to peek into a backup depending on the operation it does.</p><p>I still need to adapt all commands,
which will take a little while,
but it&rsquo;s a transparent change:
commands work the same, they just become faster and more memory efficient when they get converted to use the proper API calls.</p><div id=whats-next- class=anchor></div><h1 class="relative group">What&rsquo;s next ?
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#whats-next- aria-label=Anchor>#</a></span></h1><p>Quite obviously my main area of work at the moment is the <code>INDEX</code> as I have many plans for it,
some I&rsquo;m willing to disclose,
other I want to keep private for the time being.</p><p>I&rsquo;m currently assessing the idea of creating a company around <code>plakar</code>,
providing an ISC-licensed opensource version that covers most users needs and which would be fairly similar to what <code>plakar</code> showcases currently,
and a premium-licensed version for the corporate world with a ton of feature no one needs unless they work with teams and manage >TB of data.</p><p>Lots of documentation is being written,
targeting potential investors,
but also allowing me to clear my mind and write down the costs, strategies and related stuff.</p><p>Stay tuned !</p></br></br></div><script>var oid="views_posts/2023-09_01/index.md",oid_likes="likes_posts/2023-09_01/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">You reached the end of this article,
<b>CONGRATULATIONS</b> !<br><br><b>Please ❤️</b> consider <b>sharing on social networks</b> to increase its visibility.<br><br>You can also help by
<b>commenting the article</u></b>,
if only to let me know if you liked it or not !</span></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;title=Plakar:%20a%20TON%20of%20changes" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;text=Plakar:%20a%20TON%20of%20changes" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;resubmit=true&amp;title=Plakar:%20a%20TON%20of%20changes" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;description=Plakar:%20a%20TON%20of%20changes" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;quote=Plakar:%20a%20TON%20of%20changes" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;subject=Plakar:%20a%20TON%20of%20changes" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;resubmit=true&amp;title=Plakar:%20a%20TON%20of%20changes" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/posts/2023-10-07/plakar-a-ton-of-changes/&amp;resubmit=true&amp;title=Plakar:%20a%20TON%20of%20changes" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div id=comments><script src=https://giscus.app/client.js data-repo=poolpOrg/poolp.org data-repo-id="MDEwOlJlcG9zaXRvcnkxMjYxODk2MjA=" data-category=Articles data-category-id=DIC_kwDOB4WANM4B-Zf1 data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/2023-08-06/plakar-vfs-importer-interface/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Plakar: vfs importer interface</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-08-06 00:44:00 +0200 +0200">6 August 2023</time></span></span></a></span>
<span></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">Copyright © Gilles Chehade - poolp.org
-
<u><a href=/legal/>Legal notice</a></u></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://poolp.org style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=poolporg data-description="Support me on Buy me a coffee!" data-message="Support me !" data-color=#FFDD00 data-position=left data-x_margin=18 data-y_margin=18></script><div class=discord-button onclick='document.querySelector(".discord-dialog").className="discord-dialog discord-dialog--active"'><svg class="discord-button__icon" viewBox="0 0 24 24"><path d="M22 24l-5.25-5L17.38 21H4.5A2.5 2.5.0 012 18.5V3.5A2.5 2.5.0 014.5 1h15A2.5 2.5.0 0122 3.5V24M12 6.8c-2.68.0-4.56 1.15-4.56 1.15 1.03-.92 2.83-1.45 2.83-1.45l-.17-.17C8.41 6.36 6.88 7.53 6.88 7.53c-1.72 3.59-1.61 6.69-1.61 6.69 1.4 1.81 3.48 1.68 3.48 1.68L9.46 15c-1.25-.27-2.04-1.38-2.04-1.38S9.3 14.9 12 14.9s4.58-1.28 4.58-1.28S15.79 14.73 14.54 15L15.25 15.9S17.33 16.03 18.73 14.22C18.73 14.22 18.84 11.12 17.12 7.53c0 0-1.53-1.17-3.22-1.2l-.17.17s1.8.53 2.83 1.45c0 0-1.88-1.15-4.56-1.15M9.93 10.59c.65.0 1.18.57 1.17 1.27C11.1 12.55 10.58 13.13 9.93 13.13 9.29 13.13 8.77 12.55 8.77 11.86 8.77 11.16 9.28 10.59 9.93 10.59m4.17.0c.65.0 1.17.57 1.17 1.27C15.27 12.55 14.75 13.13 14.1 13.13 13.46 13.13 12.94 12.55 12.94 11.86 12.94 11.16 13.45 10.59 14.1 10.59z"/></svg></div><div class=discord-dialog><div class=discord-dialog__header><a href=https://discordapp.com><svg class="discord-dialog__logo" viewBox="0 0 532 130"><path d="M53.2 20.3H20v37.6l22.1 20V41.4H54c7.5.0 11.2 3.7 11.2 9.5v27.9c0 5.8-3.5 9.7-11.2 9.7H20v21.2h33.2c17.8.1 34.5-8.8 34.5-29.4V50.2c0-20.8-16.7-29.9-34.5-29.9zM227.3 80.4V49.6c0-11.1 19.8-13.7 25.8-2.5l18.3-7.5C264.3 23.7 251.1 19 240.2 19c-17.8.0-35.4 10.4-35.4 30.6v30.8c0 20.3 17.6 30.6 35 30.6 11.2.0 24.6-5.6 32-20.1l-19.6-9.1C247.4 94.2 227.3 91.2 227.3 80.4zM166.7 53.8c-6.9-1.5-11.5-4-11.8-8.3.4-10.4 16.3-10.7 25.6-.8l14.7-11.4C186 22 175.6 19 164.8 19c-16.3.0-32.1 9.2-32.1 26.8.0 17.1 13 26.2 27.3 28.4 7.3 1 15.4 3.9 15.2 9-.6 9.6-20.2 9.1-29.1-1.8L132 94.8c8.3 10.7 19.6 16.2 30.2 16.2 16.3.0 34.4-9.5 35.1-26.8C198.3 62.2 182.5 56.7 166.7 53.8zM99.8 109.7h22.4V20.3H99.8v89.4zM477.5 20.3h-33.2v37.6l22.1 20V41.4h11.8c7.5.0 11.2 3.7 11.2 9.5v27.9c0 5.8-3.5 9.7-11.2 9.7h-34v21.2h33.2c17.8.1 34.5-8.8 34.5-29.4V50.2C512 29.4 495.3 20.3 477.5 20.3zM314.6 19c-18.4.0-36.7 10.1-36.7 30.7v30.6c0 20.5 18.4 30.7 36.9 30.7 18.4.0 36.7-10.2 36.7-30.7V49.7C351.5 29.2 333 19 314.6 19zM329 80.3c0 6.4-7.2 9.7-14.3 9.7-7.2.0-14.4-3.2-14.4-9.7V49.7c0-6.6 7-10.1 14-10.1 7.3.0 14.7 3.2 14.7 10.1V80.3zM431.8 49.7c-.5-21-14.7-29.4-33-29.4h-35.5v89.5H386V81.3h4l20.6 28.4h28L414.4 79C425.2 75.6 431.8 66.3 431.8 49.7zM399.2 61.8H386V41.4h13.2c14.2.0 14.2 20.4.0 20.4z"/></svg></a></div><div class=discord-dialog__close-button onclick='document.querySelector(".discord-dialog").className="discord-dialog"'><svg viewBox="0 0 24 24"><path fill="#000" d="M13.46 12 19 17.54V19H17.54L12 13.46 6.46 19H5V17.54L10.54 12 5 6.46V5H6.46L12 10.54 17.54 5H19V6.46L13.46 12z"/></svg></div><div class=discord-dialog__container><div class=discord-dialog__guild>You're invited to join my Discord server</div>This is a chat server where I hang out, discuss my projects and sometimes screencast as I work on them.<br><br>Feel free to hop in, talk about your own projects, share your thoughts:
<b>this is a virtual coworking room for anyone to join</b>.</div><div class=discord-dialog__footer><a href=https://discord.gg/YC6j4rbvSk class=discord-dialog__btn>Join the server now</a></div></div></html>